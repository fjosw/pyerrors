<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.3.0"/>
    <title>pyerrors.correlators API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../pyerrors.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;pyerrors</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#Corr">Corr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Corr.__init__">Corr</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.gamma_method">gamma_method</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.projected">projected</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.item">item</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.plottable">plottable</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.symmetric">symmetric</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.anti_symmetric">anti_symmetric</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.is_matrix_symmetric">is_matrix_symmetric</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.matrix_symmetric">matrix_symmetric</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.GEVP">GEVP</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.Eigenvalue">Eigenvalue</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.Hankel">Hankel</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.roll">roll</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.reverse">reverse</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.thin">thin</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.correlate">correlate</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.reweight">reweight</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.T_symmetry">T_symmetry</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.deriv">deriv</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.second_deriv">second_deriv</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.m_eff">m_eff</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.fit">fit</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.plateau">plateau</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.set_prange">set_prange</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.show">show</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.spaghetti_plot">spaghetti_plot</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.dump">dump</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.print">print</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.sqrt">sqrt</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.log">log</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.exp">exp</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.sin">sin</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.cos">cos</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.tan">tan</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.sinh">sinh</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.cosh">cosh</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.tanh">tanh</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.arcsin">arcsin</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.arccos">arccos</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.arctan">arctan</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.arcsinh">arcsinh</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.arccosh">arccosh</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.arctanh">arctanh</a>
                        </li>
                        <li>
                                <a class="function" href="#Corr.prune">prune</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../pyerrors.html">pyerrors</a><wbr>.correlators    </h1>

                
                        <input id="mod-correlators-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-correlators-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">import</span> <span class="nn">warnings</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">permutations</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">import</span> <span class="nn">autograd.numpy</span> <span class="k">as</span> <span class="nn">anp</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a><span class="kn">import</span> <span class="nn">scipy.linalg</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="kn">from</span> <span class="nn">.obs</span> <span class="kn">import</span> <span class="n">Obs</span><span class="p">,</span> <span class="n">reweight</span><span class="p">,</span> <span class="n">correlate</span><span class="p">,</span> <span class="n">CObs</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="kn">from</span> <span class="nn">.misc</span> <span class="kn">import</span> <span class="n">dump_object</span><span class="p">,</span> <span class="n">_assert_equal_properties</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">from</span> <span class="nn">.fits</span> <span class="kn">import</span> <span class="n">least_squares</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">.roots</span> <span class="kn">import</span> <span class="n">find_root</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="k">class</span> <span class="nc">Corr</span><span class="p">:</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>    <span class="sd">&quot;&quot;&quot;The class for a correlator (time dependent sequence of pe.Obs).</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="sd">    Everything, this class does, can be achieved using lists or arrays of Obs.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="sd">    But it is simply more convenient to have a dedicated object for correlators.</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="sd">    One often wants to add or multiply correlators of the same length at every timeslice and it is inconvenient</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="sd">    to iterate over all timeslices for every operation. This is especially true, when dealing with matrices.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="sd">    The correlator can have two types of content: An Obs at every timeslice OR a GEVP</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="sd">    matrix at every timeslice. Other dependency (eg. spatial) are not supported.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_input</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">prange</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a>        <span class="sd">&quot;&quot;&quot; Initialize a Corr object.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">        Parameters</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">        ----------</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">        data_input : list or array</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">            list of Obs or list of arrays of Obs or array of Corrs</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">        padding : list, optional</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">            List with two entries where the first labels the padding</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">            at the front of the correlator and the second the padding</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">            at the back.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">        prange : list, optional</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">            List containing the first and last timeslice of the plateau</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">            region indentified for this correlator.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_input</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>            <span class="c1"># This only works, if the array fulfills the conditions below</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Incompatible array shape&quot;</span><span class="p">)</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Corr</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;If the input is an array, its elements must be of type pe.Corr&quot;</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only construct matrix correlator from single valued correlators&quot;</span><span class="p">)</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;All input Correlators must be defined over the same timeslices.&quot;</span><span class="p">)</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">data_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>            <span class="n">input_as_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>                <span class="k">if</span> <span class="nb">any</span><span class="p">([(</span><span class="n">item</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([(</span><span class="n">item</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input ill-defined at different timeslices. Conversion leads to data loss!&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>                    <span class="n">input_as_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>                    <span class="n">array_at_timeslace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>                            <span class="n">array_at_timeslace</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_input</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>                    <span class="n">input_as_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array_at_timeslace</span><span class="p">)</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>            <span class="n">data_input</span> <span class="o">=</span> <span class="n">input_as_list</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_input</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]):</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>                <span class="n">_assert_equal_properties</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">item</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">))</span> <span class="ow">or</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]):</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>                <span class="n">_assert_equal_properties</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data_input</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">item</span><span class="p">])</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>            <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]):</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">data_input</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>                <span class="n">noNull</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)]</span>  <span class="c1"># To check if the matrices are correct for all undefined elements</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Smearing matrices are not NxN&quot;</span><span class="p">)</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">noNull</span><span class="p">])):</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Items in data_input are not of identical shape.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">noNull</span><span class="p">))</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;data_input contains item of wrong type&quot;</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Data input was not given as list or correct array&quot;</span><span class="p">)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>        <span class="c1"># An undefined timeslice is represented by the None object</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prange</span> <span class="o">=</span> <span class="n">prange</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>        <span class="sd">&quot;&quot;&quot;Return the content of timeslice idx&quot;&quot;&quot;</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>    <span class="nd">@property</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>    <span class="k">def</span> <span class="nf">reweighted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>        <span class="n">bool_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">reweighted</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]])</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">bool_array</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">bool_array</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Reweighting status of correlator corrupted.&quot;</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>    <span class="k">def</span> <span class="nf">gamma_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>        <span class="sd">&quot;&quot;&quot;Apply the gamma method to the content of the Corr.&quot;&quot;&quot;</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>                    <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>                            <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>    <span class="k">def</span> <span class="nf">projected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_l</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>        <span class="sd">&quot;&quot;&quot;We need to project the Correlator with a Vector to get a single value at each timeslice.</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        The method can use one or two vectors.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        If two are specified it returns v1@G@v2 (the order might be very important.)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">        By default it will return the lowest source, which usually means unsmeared-unsmeared (0,0), but it does not have to</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Trying to project a Corr, that already has N=1.&quot;</span><span class="p">)</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>        <span class="k">if</span> <span class="n">vector_l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>            <span class="n">vector_l</span><span class="p">,</span> <span class="n">vector_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.</span><span class="p">])</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">vector_r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>            <span class="n">vector_r</span> <span class="o">=</span> <span class="n">vector_l</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_l</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_r</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector_l</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Length of vector list must be equal to T&quot;</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>            <span class="n">vector_r</span> <span class="o">=</span> <span class="p">[</span><span class="n">vector_r</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_r</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_l</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector_r</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Length of vector list must be equal to T&quot;</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>            <span class="n">vector_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">vector_l</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_l</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">vector_l</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">vector_r</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,):</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Vectors are of wrong shape!&quot;</span><span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>                <span class="n">vector_l</span><span class="p">,</span> <span class="n">vector_r</span> <span class="o">=</span> <span class="n">vector_l</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">vector_l</span> <span class="o">@</span> <span class="n">vector_l</span><span class="p">)),</span> <span class="n">vector_r</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vector_r</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">vector_l</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">item</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>            <span class="c1"># There are no checks here yet. There are so many possible scenarios, where this can go wrong.</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>                    <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">])),</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">or</span> <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)]</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>    <span class="k">def</span> <span class="nf">item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>        <span class="sd">&quot;&quot;&quot;Picks the element [i,j] from every matrix and returns a correlator containing one Obs per timeslice.</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a><span class="sd">        Parameters</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">        ----------</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">        i : int</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">            First index to be picked.</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">        j : int</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">            Second index to be picked.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Trying to pick item from projected Corr&quot;</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>    <span class="k">def</span> <span class="nf">plottable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>        <span class="sd">&quot;&quot;&quot;Outputs the correlator in a plotable format.</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">        Outputs three lists containing the timeslice index, the value on each</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">        timeslice and the error on each timeslice.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only make Corr[N=1] plottable&quot;</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>        <span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>        <span class="n">y_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>        <span class="n">y_err_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="k">return</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">y_err_list</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="k">def</span> <span class="nf">symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>        <span class="sd">&quot;&quot;&quot; Symmetrize the correlator around x0=0.&quot;&quot;&quot;</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;symmetric cannot be safely applied to multi-dimensional correlators.&#39;</span><span class="p">)</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can not symmetrize odd T&quot;</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Correlator does not seem to be symmetric around x0=0.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]))</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Corr could not be symmetrized: No redundant values&quot;</span><span class="p">)</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>    <span class="k">def</span> <span class="nf">anti_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>        <span class="sd">&quot;&quot;&quot;Anti-symmetrize the correlator around x0=0.&quot;&quot;&quot;</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;anti_symmetric cannot be safely applied to multi-dimensional correlators.&#39;</span><span class="p">)</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can not symmetrize odd T&quot;</span><span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>        <span class="n">test</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>        <span class="n">test</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">is_zero_within_error</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]):</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Correlator does not seem to be anti-symmetric around x0=0.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]))</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Corr could not be symmetrized: No redundant values&quot;</span><span class="p">)</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>    <span class="k">def</span> <span class="nf">is_matrix_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>        <span class="sd">&quot;&quot;&quot;Checks whether a correlator matrices is symmetric on every timeslice.&quot;&quot;&quot;</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only works for correlator matrices.&quot;</span><span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>                <span class="k">continue</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]:</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>                        <span class="k">continue</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>                    <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]):</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>    <span class="k">def</span> <span class="nf">matrix_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>        <span class="sd">&quot;&quot;&quot;Symmetrizes the correlator matrices on every timeslice.&quot;&quot;&quot;</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Trying to symmetrize a correlator matrix, that already has N=1.&quot;</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_matrix_symmetric</span><span class="p">():</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>            <span class="k">return</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="bp">self</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>            <span class="n">transposed</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">)</span> <span class="k">else</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">G</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>            <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">transposed</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>    <span class="k">def</span> <span class="nf">GEVP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;Eigenvalue&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Solve the generalized eigenvalue problem on the correlator matrix and returns the corresponding eigenvectors.</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">        The eigenvectors are sorted according to the descending eigenvalues, the zeroth eigenvector(s) correspond to the</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        largest eigenvalue(s). The eigenvector(s) for the individual states can be accessed via slicing</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">        ```python</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">        C.GEVP(t0=2)[0]  # Ground state vector(s)</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">        C.GEVP(t0=2)[:3]  # Vectors for the lowest three states</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">        ```</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        Parameters</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">        ----------</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">        t0 : int</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a><span class="sd">            The time t0 for the right hand side of the GEVP according to $G(t)v_i=\lambda_i G(t_0)v_i$</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">        ts : int</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">            fixed time $G(t_s)v_i=\lambda_i G(t_0)v_i$ if sort=None.</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">            If sort=&quot;Eigenvector&quot; it gives a reference point for the sorting method.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">        sort : string</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">            If this argument is set, a list of self.T vectors per state is returned. If it is set to None, only one vector is returned.</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a><span class="sd">            - &quot;Eigenvalue&quot;: The eigenvector is chosen according to which eigenvalue it belongs individually on every timeslice.</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">            - &quot;Eigenvector&quot;: Use the method described in arXiv:2004.10472 to find the set of v(t) belonging to the state.</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">              The reference state is identified by its eigenvalue at $t=t_s$.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">        Other Parameters</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a><span class="sd">        ----------------</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a><span class="sd">        state : int</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a><span class="sd">           Returns only the vector(s) for a specified state. The lowest state is zero.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;GEVP methods only works on correlator matrices and not single correlators.&quot;</span><span class="p">)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>        <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="o">&lt;=</span> <span class="n">t0</span><span class="p">):</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ts has to be larger than t0.&quot;</span><span class="p">)</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>        <span class="k">if</span> <span class="s2">&quot;sorted_list&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument &#39;sorted_list&#39; is deprecated, use &#39;sort&#39; instead.&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>            <span class="n">sort</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sorted_list&quot;</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_matrix_symmetric</span><span class="p">():</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>            <span class="n">symmetric_corr</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>            <span class="n">symmetric_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_symmetric</span><span class="p">()</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>        <span class="k">if</span> <span class="n">sort</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ts is required if sort=None.&quot;</span><span class="p">)</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">ts</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Corr not defined at t0/ts.&quot;</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>            <span class="n">G0</span><span class="p">,</span> <span class="n">Gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">)</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>                    <span class="n">G0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">t0</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>                    <span class="n">Gt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">ts</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>            <span class="n">reordered_vecs</span> <span class="o">=</span> <span class="n">_GEVP_solver</span><span class="p">(</span><span class="n">Gt</span><span class="p">,</span> <span class="n">G0</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="k">elif</span> <span class="n">sort</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Eigenvalue&quot;</span><span class="p">,</span> <span class="s2">&quot;Eigenvector&quot;</span><span class="p">]:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>            <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;Eigenvalue&quot;</span> <span class="ow">and</span> <span class="n">ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;ts has no effect when sorting by eigenvalue is chosen.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="n">all_vecs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>                    <span class="n">G0</span><span class="p">,</span> <span class="n">Gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>                            <span class="n">G0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">t0</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>                            <span class="n">Gt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>                    <span class="n">all_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_GEVP_solver</span><span class="p">(</span><span class="n">Gt</span><span class="p">,</span> <span class="n">G0</span><span class="p">))</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>                    <span class="n">all_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>            <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;Eigenvector&quot;</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ts is required for the Eigenvector sorting method.&quot;</span><span class="p">)</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>                <span class="n">all_vecs</span> <span class="o">=</span> <span class="n">_sort_vectors</span><span class="p">(</span><span class="n">all_vecs</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>            <span class="n">reordered_vecs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">v</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vecs</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unkown value for &#39;sort&#39;.&quot;</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>        <span class="k">if</span> <span class="s2">&quot;state&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>            <span class="k">return</span> <span class="n">reordered_vecs</span><span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)]</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>            <span class="k">return</span> <span class="n">reordered_vecs</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>    <span class="k">def</span> <span class="nf">Eigenvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;Eigenvalue&quot;</span><span class="p">):</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>        <span class="sd">&quot;&quot;&quot;Determines the eigenvalue of the GEVP by solving and projecting the correlator</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a><span class="sd">        Parameters</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a><span class="sd">        ----------</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a><span class="sd">        state : int</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="sd">            The state one is interested in ordered by energy. The lowest state is zero.</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a><span class="sd">        All other parameters are identical to the ones of Corr.GEVP.</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>        <span class="n">vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GEVP</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">)[</span><span class="n">state</span><span class="p">]</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">projected</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>    <span class="k">def</span> <span class="nf">Hankel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>        <span class="sd">&quot;&quot;&quot;Constructs an NxN Hankel matrix</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">        C(t) c(t+1) ... c(t+n-1)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a><span class="sd">        C(t+1) c(t+2) ... c(t+n)</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">        .................</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">        C(t+(n-1)) c(t+n) ... c(t+2(n-1))</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a><span class="sd">        Parameters</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        ----------</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">        N : int</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">            Dimension of the Hankel matrix</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">        periodic : bool, optional</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a><span class="sd">            determines whether the matrix is extended periodically</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multi-operator Prony not implemented!&quot;</span><span class="p">)</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>            <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>            <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>                <span class="n">i</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>            <span class="k">return</span> <span class="n">i</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>                    <span class="k">if</span> <span class="n">periodic</span><span class="p">:</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>                        <span class="n">new_content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">wrap</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>                    <span class="k">elif</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>                        <span class="n">new_content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>                        <span class="n">new_content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>    <span class="k">def</span> <span class="nf">roll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>        <span class="sd">&quot;&quot;&quot;Periodically shift the correlator by dt timeslices</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">        Parameters</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a><span class="sd">        ----------</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">        dt : int</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">            number of timeslices</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">),</span> <span class="n">dt</span><span class="p">)))</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="sd">&quot;&quot;&quot;Reverse the time ordering of the Corr&quot;&quot;&quot;</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[::</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>    <span class="k">def</span> <span class="nf">thin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>        <span class="sd">&quot;&quot;&quot;Thin out a correlator to suppress correlations</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="sd">        Parameters</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a><span class="sd">        ----------</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a><span class="sd">        spacing : int</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a><span class="sd">            Keep only every &#39;spacing&#39;th entry of the correlator</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a><span class="sd">        offset : int</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="sd">            Offset the equal spacing</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span> <span class="o">%</span> <span class="n">spacing</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>    <span class="k">def</span> <span class="nf">correlate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partner</span><span class="p">):</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>        <span class="sd">&quot;&quot;&quot;Correlate the correlator with another correlator or Obs</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a><span class="sd">        Parameters</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">        ----------</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">        partner : Obs or Corr</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">            partner to correlate the correlator with.</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a><span class="sd">            Can either be an Obs which is correlated with all entries of the</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">            correlator or a Corr of same length.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only one-dimensional correlators can be safely correlated.&quot;</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>        <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">t_slice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>            <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_slice</span><span class="p">):</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>                    <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x0</span><span class="p">]):</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>                        <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>                        <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">correlate</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">t_slice</span><span class="p">]))</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">Obs</span><span class="p">):</span>  <span class="c1"># Should this include CObs?</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>                    <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">correlate</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">t_slice</span><span class="p">]))</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only correlate with an Obs or a Corr.&quot;</span><span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>    <span class="k">def</span> <span class="nf">reweight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>        <span class="sd">&quot;&quot;&quot;Reweight the correlator.</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="sd">        Parameters</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">        ----------</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="sd">        weight : Obs</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a><span class="sd">            Reweighting factor. An Observable that has to be defined on a superset of the</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="sd">            configurations in obs[i].idl for all i.</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="sd">        all_configs : bool</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">            if True, the reweighted observables are normalized by the average of</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="sd">            the reweighting factor on all configurations in weight.idl and not</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a><span class="sd">            on the configurations in obs[i].idl.</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Reweighting only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>        <span class="k">for</span> <span class="n">t_slice</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>            <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_slice</span><span class="p">):</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reweight</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">t_slice</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)))</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>    <span class="k">def</span> <span class="nf">T_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partner</span><span class="p">,</span> <span class="n">parity</span><span class="o">=+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>        <span class="sd">&quot;&quot;&quot;Return the time symmetry average of the correlator and its partner</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a><span class="sd">        Parameters</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">        ----------</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="sd">        partner : Corr</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="sd">            Time symmetry partner of the Corr</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">        partity : int</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a><span class="sd">            Parity quantum number of the correlator, can be +1 or -1</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;T_symmetry only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;T partner has to be a Corr object.&quot;</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>        <span class="k">if</span> <span class="n">parity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Parity has to be +1 or -1.&quot;</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>        <span class="n">T_partner</span> <span class="o">=</span> <span class="n">parity</span> <span class="o">*</span> <span class="n">partner</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>        <span class="n">t_slices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>        <span class="n">test</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span> <span class="o">-</span> <span class="n">T_partner</span><span class="p">)</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>        <span class="n">test</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>        <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">t_slice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>            <span class="k">if</span> <span class="n">t_slice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">t_slice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_zero_within_error</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>                    <span class="n">t_slices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="k">if</span> <span class="n">t_slices</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;T symmetry partners do not agree within 5 sigma on time slices &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t_slices</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">+</span> <span class="n">T_partner</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>    <span class="k">def</span> <span class="nf">deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;symmetric&quot;</span><span class="p">):</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="sd">&quot;&quot;&quot;Return the first derivative of the correlator with respect to x0.</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a><span class="sd">        Parameters</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a><span class="sd">        ----------</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a><span class="sd">        variant : str</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a><span class="sd">            decides which definition of the finite differences derivative is used.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a><span class="sd">            Available choice: symmetric, forward, backward, improved, log, default: symmetric</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;deriv only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>        <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;symmetric&quot;</span><span class="p">:</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Derivative is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;improved&quot;</span><span class="p">:</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Derivative is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Log is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>            <span class="n">logcorr</span> <span class="o">=</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">logcorr</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="s1">&#39;symmetric&#39;</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown variant.&quot;</span><span class="p">)</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>    <span class="k">def</span> <span class="nf">second_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;symmetric&quot;</span><span class="p">):</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>        <span class="sd">&quot;&quot;&quot;Return the second derivative of the correlator with respect to x0.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a><span class="sd">        Parameters</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">        ----------</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">        variant : str</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">            decides which definition of the finite differences derivative is used.</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a><span class="sd">            Available choice: symmetric, improved, log, default: symmetric</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;second_deriv only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>        <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;symmetric&quot;</span><span class="p">:</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;improved&quot;</span><span class="p">:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]))</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Log is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>            <span class="n">logcorr</span> <span class="o">=</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="n">logcorr</span><span class="o">.</span><span class="n">second_deriv</span><span class="p">(</span><span class="s1">&#39;symmetric&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">logcorr</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="s1">&#39;symmetric&#39;</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown variant.&quot;</span><span class="p">)</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>    <span class="k">def</span> <span class="nf">m_eff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>        <span class="sd">&quot;&quot;&quot;Returns the effective mass of the correlator as correlator object</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">        Parameters</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">        ----------</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">        variant : str</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">            log : uses the standard effective mass log(C(t) / C(t+1))</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a><span class="sd">            cosh, periodic : Use periodicitiy of the correlator by solving C(t) / C(t+1) = cosh(m * (t - T/2)) / cosh(m * (t + 1 - T/2)) for m.</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a><span class="sd">            sinh : Use anti-periodicitiy of the correlator by solving C(t) / C(t+1) = sinh(m * (t - T/2)) / sinh(m * (t + 1 - T/2)) for m.</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a><span class="sd">            See, e.g., arXiv:1205.5380</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a><span class="sd">            arccosh : Uses the explicit form of the symmetrized correlator (not recommended)</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a><span class="sd">            logsym: uses the symmetric effective mass log(C(t-1) / C(t+1))/2</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a><span class="sd">        guess : float</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a><span class="sd">            guess for the root finder, only relevant for the root variant</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Correlator must be projected before getting m_eff&#39;</span><span class="p">)</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>        <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;m_eff is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;logsym&#39;</span><span class="p">:</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;m_eff is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">,</span> <span class="s1">&#39;sinh&#39;</span><span class="p">]:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>            <span class="k">if</span> <span class="n">variant</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">]:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>                <span class="n">func</span> <span class="o">=</span> <span class="n">anp</span><span class="o">.</span><span class="n">cosh</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>                <span class="n">func</span> <span class="o">=</span> <span class="n">anp</span><span class="o">.</span><span class="n">sinh</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>            <span class="k">def</span> <span class="nf">root_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">d</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>                <span class="c1"># Fill the two timeslices in the middle of the lattice with their predecessors</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>                <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;sinh&#39;</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newcontent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">find_root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">root_function</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="n">guess</span><span class="p">)))</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;m_eff is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;arccosh&#39;</span><span class="p">:</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;m_eff is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccosh</span><span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown variant.&#39;</span><span class="p">)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">fitrange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Fits function to the data</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a><span class="sd">        Parameters</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a><span class="sd">        ----------</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a><span class="sd">        function : obj</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a><span class="sd">            function to fit to the data. See fits.least_squares for details.</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="sd">        fitrange : list</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="sd">            Two element list containing the timeslices on which the fit is supposed to start and stop.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">            Caution: This range is inclusive as opposed to standard python indexing.</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">            `fitrange=[4, 6]` corresponds to the three entries 4, 5 and 6.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">            If not specified, self.prange or all timeslices are used.</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a><span class="sd">        silent : bool</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">            Decides whether output is printed to the standard output.</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator must be projected before fitting&quot;</span><span class="p">)</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>        <span class="k">if</span> <span class="n">fitrange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">:</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>                <span class="n">fitrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>                <span class="n">fitrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitrange</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;fitrange has to be a list with two elements&quot;</span><span class="p">)</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;fitrange has to have exactly two elements [fit_start, fit_stop]&quot;</span><span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>        <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fitrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fitrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>        <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fitrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fitrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="n">silent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>    <span class="k">def</span> <span class="nf">plateau</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plateau_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="n">auto_gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>        <span class="sd">&quot;&quot;&quot; Extract a plateau value from a Corr object</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">        Parameters</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">        ----------</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">        plateau_range : list</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">            list with two entries, indicating the first and the last timeslice</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a><span class="sd">            of the plateau region.</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">        method : str</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">            method to extract the plateau.</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">                &#39;fit&#39; fits a constant to the plateau region</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">                &#39;avg&#39;, &#39;average&#39; or &#39;mean&#39; just average over the given timeslices.</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">        auto_gamma : bool</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a><span class="sd">            apply gamma_method with default parameters to the Corr. Defaults to None</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plateau_range</span><span class="p">:</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">:</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>                <span class="n">plateau_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;no plateau range provided&quot;</span><span class="p">)</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator must be projected before getting a plateau.&quot;</span><span class="p">)</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">plateau_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plateau_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])):</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;plateau is undefined at all timeslices in plateaurange.&quot;</span><span class="p">)</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>        <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fit&quot;</span><span class="p">:</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="k">def</span> <span class="nf">const_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>                <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">const_func</span><span class="p">,</span> <span class="n">plateau_range</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">]:</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">plateau_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">plateau_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="k">return</span> <span class="n">returnvalue</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported plateau method: &quot;</span> <span class="o">+</span> <span class="n">method</span><span class="p">)</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>    <span class="k">def</span> <span class="nf">set_prange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prange</span><span class="p">):</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>        <span class="sd">&quot;&quot;&quot;Sets the attribute prange of the Corr object.&quot;&quot;&quot;</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">prange</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;prange must be a list or array with two values&quot;</span><span class="p">)</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">))):</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Start and end point must be integers&quot;</span><span class="p">)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="ow">and</span> <span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Start and end point must define a range in the interval 0,T&quot;</span><span class="p">)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prange</span> <span class="o">=</span> <span class="n">prange</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>        <span class="k">return</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plateau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fit_res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">references</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>        <span class="sd">&quot;&quot;&quot;Plots the correlator using the tag of the correlator as label if available.</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">        Parameters</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">        ----------</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">        x_range : list</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">            list of two values, determining the range of the x-axis e.g. [4, 8].</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">        comp : Corr or list of Corr</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">            Correlator or list of correlators which are plotted for comparison.</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a><span class="sd">            The tags of these correlators are used as labels if available.</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">        logscale : bool</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a><span class="sd">            Sets y-axis to logscale.</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">        plateau : Obs</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">            Plateau value to be visualized in the figure.</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a><span class="sd">        fit_res : Fit_result</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">            Fit_result object to be visualized.</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">        ylabel : str</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">            Label for the y-axis.</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">        save : str</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">            path to file in which the figure should be saved.</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a><span class="sd">        auto_gamma : bool</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">            Apply the gamma method with standard parameters to all correlators and plateau values before plotting.</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">        hide_sigma : float</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">            Hides data points from the first value on which is consistent with zero within &#39;hide_sigma&#39; standard errors.</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">        references : list</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">            List of floating point values that are displayed as horizontal lines for reference.</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a><span class="sd">        title : string</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">            Optional title of the figure.</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator must be projected before plotting&quot;</span><span class="p">)</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>        <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>        <span class="k">if</span> <span class="n">x_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>            <span class="n">x_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottable</span><span class="p">()</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="k">if</span> <span class="n">hide_sigma</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="n">hide_from</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">((</span><span class="n">hide_sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_err</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>            <span class="n">hide_from</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>        <span class="k">if</span> <span class="n">logscale</span><span class="p">:</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>            <span class="k">if</span> <span class="n">y_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>                    <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>                    <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>                    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">y_min</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">),</span> <span class="n">y_max</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)])</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>                    <span class="k">pass</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_range</span><span class="p">)</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>        <span class="k">if</span> <span class="n">comp</span><span class="p">:</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="p">(</span><span class="n">Corr</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>                <span class="k">for</span> <span class="n">corr</span> <span class="ow">in</span> <span class="n">comp</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">comp</span><span class="p">]:</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>                    <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>                        <span class="n">corr</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_err</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">plottable</span><span class="p">()</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>                    <span class="k">if</span> <span class="n">hide_sigma</span><span class="p">:</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>                        <span class="n">hide_from</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">((</span><span class="n">hide_sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_err</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>                        <span class="n">hide_from</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>                    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">corr</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">])</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;comp&#39; must be a correlator or a list of correlators.&quot;</span><span class="p">)</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="k">if</span> <span class="n">plateau</span><span class="p">:</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plateau</span><span class="p">,</span> <span class="n">Obs</span><span class="p">):</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>                <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>                    <span class="n">plateau</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">plateau</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">plateau</span><span class="p">))</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">axhspan</span><span class="p">(</span><span class="n">plateau</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">plateau</span><span class="o">.</span><span class="n">dvalue</span><span class="p">,</span> <span class="n">plateau</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">plateau</span><span class="o">.</span><span class="n">dvalue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;plateau&#39; must be an Obs&quot;</span><span class="p">)</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>        <span class="k">if</span> <span class="n">references</span><span class="p">:</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">references</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>                <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">references</span><span class="p">:</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>                    <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;references&#39; must be a list of floating pint values.&quot;</span><span class="p">)</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">:</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>        <span class="k">if</span> <span class="n">fit_res</span><span class="p">:</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>            <span class="n">x_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_samples</span><span class="p">,</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>                     <span class="n">fit_res</span><span class="o">.</span><span class="n">fit_function</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">fit_res</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">],</span> <span class="n">x_samples</span><span class="p">),</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>                     <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x_0 / a$&#39;</span><span class="p">)</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>        <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">])</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>        <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;save&#39; has to be a string.&quot;</span><span class="p">)</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>    <span class="k">def</span> <span class="nf">spaghetti_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="sd">&quot;&quot;&quot;Produces a spaghetti plot of the correlator suited to monitor exceptional configurations.</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a><span class="sd">        Parameters</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a><span class="sd">        ----------</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a><span class="sd">        logscale : bool</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a><span class="sd">            Determines whether the scale of the y-axis is logarithmic or standard.</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator needs to be projected first.&quot;</span><span class="p">)</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>        <span class="n">mc_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mc_names</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]))</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>        <span class="n">x0_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">mc_names</span><span class="p">:</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">r_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>            <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0_vals</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>            <span class="k">if</span> <span class="n">logscale</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x_0 / a$&#39;</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;json.gz&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>        <span class="sd">&quot;&quot;&quot;Dumps the Corr into a file of chosen type</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a><span class="sd">        Parameters</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a><span class="sd">        ----------</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a><span class="sd">        filename : str</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="sd">            Name of the file to be saved.</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a><span class="sd">        datatype : str</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a><span class="sd">            Format of the exported file. Supported formats include</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a><span class="sd">            &quot;json.gz&quot; and &quot;pickle&quot;</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a><span class="sd">        path : str</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a><span class="sd">            specifies a custom path for the file (default &#39;.&#39;)</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>        <span class="k">if</span> <span class="n">datatype</span> <span class="o">==</span> <span class="s2">&quot;json.gz&quot;</span><span class="p">:</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>            <span class="kn">from</span> <span class="nn">.input.json</span> <span class="kn">import</span> <span class="n">dump_to_json</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>            <span class="n">dump_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>        <span class="k">elif</span> <span class="n">datatype</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>            <span class="n">dump_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown datatype &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datatype</span><span class="p">))</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="n">print_range</span><span class="p">))</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="k">if</span> <span class="n">print_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="n">print_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>        <span class="n">content_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>        <span class="n">content_string</span> <span class="o">+=</span> <span class="s2">&quot;Corr T=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; N=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>  <span class="c1"># +&quot; filled with&quot;+ str(type(self.content[0][0])) there should be a good solution here</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>            <span class="n">content_string</span> <span class="o">+=</span> <span class="s2">&quot;Description: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>            <span class="k">return</span> <span class="n">content_string</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>        <span class="k">if</span> <span class="n">print_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>            <span class="n">print_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>        <span class="n">content_string</span> <span class="o">+=</span> <span class="s1">&#39;x0/a</span><span class="se">\t</span><span class="s1">Corr(x0/a)</span><span class="se">\n</span><span class="s1">------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sub_corr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">print_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">print_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]):</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>            <span class="k">if</span> <span class="n">sub_corr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>                <span class="n">content_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">print_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>                <span class="n">content_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">print_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">sub_corr</span><span class="p">:</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>                    <span class="n">content_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">element</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>                <span class="n">content_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>        <span class="k">return</span> <span class="n">content_string</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>    <span class="c1"># We define the basic operations, that can be performed with correlators.</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>    <span class="c1"># While */+- get defined here, they only work for Corr*Obs and not Obs*Corr.</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>    <span class="c1"># This is because Obs*Corr checks Obs.__mul__ first and does not catch an exception.</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>    <span class="c1"># One could try and tell Obs to check if the y in __mul__ is a Corr and</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Addition of Corrs with different shape&quot;</span><span class="p">)</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">or</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">CObs</span><span class="p">)):</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,):</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;operands could not be broadcast together&quot;</span><span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Corr + wrong type&quot;</span><span class="p">)</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multiplication of Corr object requires N=N or N=1 and T=T&quot;</span><span class="p">)</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">or</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">CObs</span><span class="p">)):</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,):</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>                <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;operands could not be broadcast together&quot;</span><span class="p">)</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Corr * wrong type&quot;</span><span class="p">)</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multiplication of Corr object requires N=N or N=1 and T=T&quot;</span><span class="p">)</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">or</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                    <span class="k">continue</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>                    <span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">]):</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Division returns completely undefined correlator&quot;</span><span class="p">)</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">)):</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Obs</span><span class="p">):</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>                <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Division by zero will return undefined correlator&#39;</span><span class="p">)</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">CObs</span><span class="p">):</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>                <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Division by zero will return undefined correlator&#39;</span><span class="p">)</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Division by zero will return undefined correlator&#39;</span><span class="p">)</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,):</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>                <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;operands could not be broadcast together&quot;</span><span class="p">)</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Corr / wrong type&#39;</span><span class="p">)</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">CObs</span><span class="p">)):</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span><span class="o">**</span><span class="n">y</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Type of exponent not supported&#39;</span><span class="p">)</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>    <span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>    <span class="c1"># The numpy functions:</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>    <span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>    <span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>    <span class="k">def</span> <span class="nf">_apply_func_to_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">func</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>            <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>                <span class="k">continue</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>                <span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">]):</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Operation returns undefined correlator&#39;</span><span class="p">)</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>    <span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">)</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>    <span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">)</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>    <span class="k">def</span> <span class="nf">tan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">)</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>    <span class="k">def</span> <span class="nf">sinh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">)</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>    <span class="k">def</span> <span class="nf">cosh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">)</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>    <span class="k">def</span> <span class="nf">tanh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">)</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>    <span class="k">def</span> <span class="nf">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">)</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>    <span class="k">def</span> <span class="nf">arccos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">)</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>    <span class="k">def</span> <span class="nf">arctan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">)</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>    <span class="k">def</span> <span class="nf">arcsinh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">)</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>    <span class="k">def</span> <span class="nf">arccosh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccosh</span><span class="p">)</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>    <span class="k">def</span> <span class="nf">arctanh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">)</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>    <span class="c1"># Right hand side operations (require tweak in main module to work)</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">y</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span> <span class="o">+</span> <span class="n">y</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">y</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>    <span class="nd">@property</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>    <span class="k">def</span> <span class="nf">real</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>        <span class="k">def</span> <span class="nf">return_real</span><span class="p">(</span><span class="n">obs_OR_cobs</span><span class="p">):</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs_OR_cobs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">):</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>                <span class="k">return</span> <span class="n">obs_OR_cobs</span><span class="o">.</span><span class="n">real</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>                <span class="k">return</span> <span class="n">obs_OR_cobs</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">return_real</span><span class="p">)</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>    <span class="nd">@property</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>    <span class="k">def</span> <span class="nf">imag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>        <span class="k">def</span> <span class="nf">return_imag</span><span class="p">(</span><span class="n">obs_OR_cobs</span><span class="p">):</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs_OR_cobs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">):</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>                <span class="k">return</span> <span class="n">obs_OR_cobs</span><span class="o">.</span><span class="n">imag</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>                <span class="k">return</span> <span class="n">obs_OR_cobs</span> <span class="o">*</span> <span class="mi">0</span>  <span class="c1"># So it stays the right type</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">return_imag</span><span class="p">)</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>    <span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ntrunc</span><span class="p">,</span> <span class="n">tproj</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">t0proj</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">basematrix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Project large correlation matrix to lowest states</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">        This method can be used to reduce the size of an (N x N) correlation matrix</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">        to (Ntrunc x Ntrunc) by solving a GEVP at very early times where the noise</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="sd">        is still small.</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a><span class="sd">        Parameters</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="sd">        ----------</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a><span class="sd">        Ntrunc: int</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="sd">            Rank of the target matrix.</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a><span class="sd">        tproj: int</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a><span class="sd">            Time where the eigenvectors are evaluated, corresponds to ts in the GEVP method.</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="sd">            The default value is 3.</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a><span class="sd">        t0proj: int</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a><span class="sd">            Time where the correlation matrix is inverted. Choosing t0proj=1 is strongly</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a><span class="sd">            discouraged for O(a) improved theories, since the correctness of the procedure</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="sd">            cannot be granted in this case. The default value is 2.</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a><span class="sd">        basematrix : Corr</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a><span class="sd">            Correlation matrix that is used to determine the eigenvectors of the</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a><span class="sd">            lowest states based on a GEVP. basematrix is taken to be the Corr itself if</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a><span class="sd">            is is not specified.</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="sd">        Notes</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a><span class="sd">        -----</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a><span class="sd">        We have the basematrix $C(t)$ and the target matrix $G(t)$. We start by solving</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">        the GEVP $$C(t) v_n(t, t_0) = \lambda_n(t, t_0) C(t_0) v_n(t, t_0)$$ where $t \equiv t_\mathrm{proj}$</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">        and $t_0 \equiv t_{0, \mathrm{proj}}$. The target matrix is projected onto the subspace of the</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">        resulting eigenvectors $v_n, n=1,\dots,N_\mathrm{trunc}$ via</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a><span class="sd">        $$G^\prime_{i, j}(t) = (v_i, G(t) v_j)$$. This allows to reduce the size of a large</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">        correlation matrix and to remove some noise that is added by irrelevant operators.</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">        This may allow to use the GEVP on $G(t)$ at late times such that the theoretically motivated</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a><span class="sd">        bound $t_0 \leq t/2$ holds, since the condition number of $G(t)$ is decreased, compared to $C(t)$.</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Method cannot be applied to one-dimensional correlators.&#39;</span><span class="p">)</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>        <span class="k">if</span> <span class="n">basematrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>            <span class="n">basematrix</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>        <span class="k">if</span> <span class="n">Ntrunc</span> <span class="o">&gt;=</span> <span class="n">basematrix</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Cannot truncate using Ntrunc &lt;= </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basematrix</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>        <span class="k">if</span> <span class="n">basematrix</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;basematrix and targetmatrix have to be of the same size.&#39;</span><span class="p">)</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>        <span class="n">evecs</span> <span class="o">=</span> <span class="n">basematrix</span><span class="o">.</span><span class="n">GEVP</span><span class="p">(</span><span class="n">t0proj</span><span class="p">,</span> <span class="n">tproj</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">)[:</span><span class="n">Ntrunc</span><span class="p">]</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>        <span class="n">tmpmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Ntrunc</span><span class="p">,</span> <span class="n">Ntrunc</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>        <span class="n">rmat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basematrix</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ntrunc</span><span class="p">):</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ntrunc</span><span class="p">):</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>                    <span class="n">tmpmat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">evecs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">evecs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>            <span class="n">rmat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmpmat</span><span class="p">))</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">rmat</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)]</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="k">def</span> <span class="nf">_sort_vectors</span><span class="p">(</span><span class="n">vec_set</span><span class="p">,</span> <span class="n">ts</span><span class="p">):</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>    <span class="sd">&quot;&quot;&quot;Helper function used to find a set of Eigenvectors consistent over all timeslices&quot;&quot;&quot;</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>    <span class="n">reference_sorting</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vec_set</span><span class="p">[</span><span class="n">ts</span><span class="p">])</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>    <span class="n">N</span> <span class="o">=</span> <span class="n">reference_sorting</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>    <span class="n">sorted_vec_set</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vec_set</span><span class="p">)):</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>        <span class="k">if</span> <span class="n">vec_set</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>            <span class="n">sorted_vec_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">t</span> <span class="o">==</span> <span class="n">ts</span><span class="p">:</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>            <span class="n">perms</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">)],</span> <span class="n">N</span><span class="p">)]</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="n">best_score</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>            <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">:</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>                <span class="n">current_score</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>                    <span class="n">new_sorting</span> <span class="o">=</span> <span class="n">reference_sorting</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>                    <span class="n">new_sorting</span><span class="p">[</span><span class="n">perm</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vec_set</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>                    <span class="n">current_score</span> <span class="o">*=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">new_sorting</span><span class="p">))</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>                <span class="k">if</span> <span class="n">current_score</span> <span class="o">&gt;</span> <span class="n">best_score</span><span class="p">:</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>                    <span class="n">best_score</span> <span class="o">=</span> <span class="n">current_score</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>                    <span class="n">best_perm</span> <span class="o">=</span> <span class="n">perm</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>            <span class="n">sorted_vec_set</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">vec_set</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">best_perm</span><span class="p">])</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>            <span class="n">sorted_vec_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vec_set</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>    <span class="k">return</span> <span class="n">sorted_vec_set</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="k">def</span> <span class="nf">_check_for_none</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>    <span class="sd">&quot;&quot;&quot;Checks if entry for correlator corr is None&quot;&quot;&quot;</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())))</span> <span class="o">&lt;</span> <span class="n">corr</span><span class="o">.</span><span class="n">N</span> <span class="o">**</span> <span class="mi">2</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a><span class="k">def</span> <span class="nf">_GEVP_solver</span><span class="p">(</span><span class="n">Gt</span><span class="p">,</span> <span class="n">G0</span><span class="p">):</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>    <span class="sd">&quot;&quot;&quot;Helper function for solving the GEVP and sorting the eigenvectors.</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="sd">    The helper function assumes that both provided matrices are symmetric and</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="sd">    only processes the lower triangular part of both matrices. In case the matrices</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="sd">    are not symmetric the upper triangular parts are effectively discarded.&quot;&quot;&quot;</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>    <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">Gt</span><span class="p">,</span> <span class="n">G0</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="Corr">
                            <input id="Corr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Corr</span>:

                <label class="view-source-button" for="Corr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr-14"><a href="#Corr-14"><span class="linenos">  14</span></a><span class="k">class</span> <span class="nc">Corr</span><span class="p">:</span>
</span><span id="Corr-15"><a href="#Corr-15"><span class="linenos">  15</span></a>    <span class="sd">&quot;&quot;&quot;The class for a correlator (time dependent sequence of pe.Obs).</span>
</span><span id="Corr-16"><a href="#Corr-16"><span class="linenos">  16</span></a>
</span><span id="Corr-17"><a href="#Corr-17"><span class="linenos">  17</span></a><span class="sd">    Everything, this class does, can be achieved using lists or arrays of Obs.</span>
</span><span id="Corr-18"><a href="#Corr-18"><span class="linenos">  18</span></a><span class="sd">    But it is simply more convenient to have a dedicated object for correlators.</span>
</span><span id="Corr-19"><a href="#Corr-19"><span class="linenos">  19</span></a><span class="sd">    One often wants to add or multiply correlators of the same length at every timeslice and it is inconvenient</span>
</span><span id="Corr-20"><a href="#Corr-20"><span class="linenos">  20</span></a><span class="sd">    to iterate over all timeslices for every operation. This is especially true, when dealing with matrices.</span>
</span><span id="Corr-21"><a href="#Corr-21"><span class="linenos">  21</span></a>
</span><span id="Corr-22"><a href="#Corr-22"><span class="linenos">  22</span></a><span class="sd">    The correlator can have two types of content: An Obs at every timeslice OR a GEVP</span>
</span><span id="Corr-23"><a href="#Corr-23"><span class="linenos">  23</span></a><span class="sd">    matrix at every timeslice. Other dependency (eg. spatial) are not supported.</span>
</span><span id="Corr-24"><a href="#Corr-24"><span class="linenos">  24</span></a>
</span><span id="Corr-25"><a href="#Corr-25"><span class="linenos">  25</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Corr-26"><a href="#Corr-26"><span class="linenos">  26</span></a>
</span><span id="Corr-27"><a href="#Corr-27"><span class="linenos">  27</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_input</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">prange</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-28"><a href="#Corr-28"><span class="linenos">  28</span></a>        <span class="sd">&quot;&quot;&quot; Initialize a Corr object.</span>
</span><span id="Corr-29"><a href="#Corr-29"><span class="linenos">  29</span></a>
</span><span id="Corr-30"><a href="#Corr-30"><span class="linenos">  30</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-31"><a href="#Corr-31"><span class="linenos">  31</span></a><span class="sd">        ----------</span>
</span><span id="Corr-32"><a href="#Corr-32"><span class="linenos">  32</span></a><span class="sd">        data_input : list or array</span>
</span><span id="Corr-33"><a href="#Corr-33"><span class="linenos">  33</span></a><span class="sd">            list of Obs or list of arrays of Obs or array of Corrs</span>
</span><span id="Corr-34"><a href="#Corr-34"><span class="linenos">  34</span></a><span class="sd">        padding : list, optional</span>
</span><span id="Corr-35"><a href="#Corr-35"><span class="linenos">  35</span></a><span class="sd">            List with two entries where the first labels the padding</span>
</span><span id="Corr-36"><a href="#Corr-36"><span class="linenos">  36</span></a><span class="sd">            at the front of the correlator and the second the padding</span>
</span><span id="Corr-37"><a href="#Corr-37"><span class="linenos">  37</span></a><span class="sd">            at the back.</span>
</span><span id="Corr-38"><a href="#Corr-38"><span class="linenos">  38</span></a><span class="sd">        prange : list, optional</span>
</span><span id="Corr-39"><a href="#Corr-39"><span class="linenos">  39</span></a><span class="sd">            List containing the first and last timeslice of the plateau</span>
</span><span id="Corr-40"><a href="#Corr-40"><span class="linenos">  40</span></a><span class="sd">            region indentified for this correlator.</span>
</span><span id="Corr-41"><a href="#Corr-41"><span class="linenos">  41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-42"><a href="#Corr-42"><span class="linenos">  42</span></a>
</span><span id="Corr-43"><a href="#Corr-43"><span class="linenos">  43</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_input</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Corr-44"><a href="#Corr-44"><span class="linenos">  44</span></a>
</span><span id="Corr-45"><a href="#Corr-45"><span class="linenos">  45</span></a>            <span class="c1"># This only works, if the array fulfills the conditions below</span>
</span><span id="Corr-46"><a href="#Corr-46"><span class="linenos">  46</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Corr-47"><a href="#Corr-47"><span class="linenos">  47</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Incompatible array shape&quot;</span><span class="p">)</span>
</span><span id="Corr-48"><a href="#Corr-48"><span class="linenos">  48</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Corr</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="Corr-49"><a href="#Corr-49"><span class="linenos">  49</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;If the input is an array, its elements must be of type pe.Corr&quot;</span><span class="p">)</span>
</span><span id="Corr-50"><a href="#Corr-50"><span class="linenos">  50</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="Corr-51"><a href="#Corr-51"><span class="linenos">  51</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only construct matrix correlator from single valued correlators&quot;</span><span class="p">)</span>
</span><span id="Corr-52"><a href="#Corr-52"><span class="linenos">  52</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-53"><a href="#Corr-53"><span class="linenos">  53</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;All input Correlators must be defined over the same timeslices.&quot;</span><span class="p">)</span>
</span><span id="Corr-54"><a href="#Corr-54"><span class="linenos">  54</span></a>
</span><span id="Corr-55"><a href="#Corr-55"><span class="linenos">  55</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">data_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr-56"><a href="#Corr-56"><span class="linenos">  56</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr-57"><a href="#Corr-57"><span class="linenos">  57</span></a>            <span class="n">input_as_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-58"><a href="#Corr-58"><span class="linenos">  58</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-59"><a href="#Corr-59"><span class="linenos">  59</span></a>                <span class="k">if</span> <span class="nb">any</span><span class="p">([(</span><span class="n">item</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="Corr-60"><a href="#Corr-60"><span class="linenos">  60</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([(</span><span class="n">item</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="Corr-61"><a href="#Corr-61"><span class="linenos">  61</span></a>                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input ill-defined at different timeslices. Conversion leads to data loss!&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr-62"><a href="#Corr-62"><span class="linenos">  62</span></a>                    <span class="n">input_as_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-63"><a href="#Corr-63"><span class="linenos">  63</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-64"><a href="#Corr-64"><span class="linenos">  64</span></a>                    <span class="n">array_at_timeslace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
</span><span id="Corr-65"><a href="#Corr-65"><span class="linenos">  65</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-66"><a href="#Corr-66"><span class="linenos">  66</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-67"><a href="#Corr-67"><span class="linenos">  67</span></a>                            <span class="n">array_at_timeslace</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_input</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
</span><span id="Corr-68"><a href="#Corr-68"><span class="linenos">  68</span></a>                    <span class="n">input_as_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array_at_timeslace</span><span class="p">)</span>
</span><span id="Corr-69"><a href="#Corr-69"><span class="linenos">  69</span></a>            <span class="n">data_input</span> <span class="o">=</span> <span class="n">input_as_list</span>
</span><span id="Corr-70"><a href="#Corr-70"><span class="linenos">  70</span></a>
</span><span id="Corr-71"><a href="#Corr-71"><span class="linenos">  71</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_input</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr-72"><a href="#Corr-72"><span class="linenos">  72</span></a>
</span><span id="Corr-73"><a href="#Corr-73"><span class="linenos">  73</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]):</span>
</span><span id="Corr-74"><a href="#Corr-74"><span class="linenos">  74</span></a>                <span class="n">_assert_equal_properties</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>
</span><span id="Corr-75"><a href="#Corr-75"><span class="linenos">  75</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">item</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]</span>
</span><span id="Corr-76"><a href="#Corr-76"><span class="linenos">  76</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">))</span> <span class="ow">or</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]):</span>
</span><span id="Corr-77"><a href="#Corr-77"><span class="linenos">  77</span></a>                <span class="n">_assert_equal_properties</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data_input</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="Corr-78"><a href="#Corr-78"><span class="linenos">  78</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">item</span><span class="p">])</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]</span>
</span><span id="Corr-79"><a href="#Corr-79"><span class="linenos">  79</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Corr-80"><a href="#Corr-80"><span class="linenos">  80</span></a>
</span><span id="Corr-81"><a href="#Corr-81"><span class="linenos">  81</span></a>            <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]):</span>
</span><span id="Corr-82"><a href="#Corr-82"><span class="linenos">  82</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">data_input</span>
</span><span id="Corr-83"><a href="#Corr-83"><span class="linenos">  83</span></a>                <span class="n">noNull</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)]</span>  <span class="c1"># To check if the matrices are correct for all undefined elements</span>
</span><span id="Corr-84"><a href="#Corr-84"><span class="linenos">  84</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr-85"><a href="#Corr-85"><span class="linenos">  85</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Corr-86"><a href="#Corr-86"><span class="linenos">  86</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Smearing matrices are not NxN&quot;</span><span class="p">)</span>
</span><span id="Corr-87"><a href="#Corr-87"><span class="linenos">  87</span></a>                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">noNull</span><span class="p">])):</span>
</span><span id="Corr-88"><a href="#Corr-88"><span class="linenos">  88</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Items in data_input are not of identical shape.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">noNull</span><span class="p">))</span>
</span><span id="Corr-89"><a href="#Corr-89"><span class="linenos">  89</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-90"><a href="#Corr-90"><span class="linenos">  90</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;data_input contains item of wrong type&quot;</span><span class="p">)</span>
</span><span id="Corr-91"><a href="#Corr-91"><span class="linenos">  91</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-92"><a href="#Corr-92"><span class="linenos">  92</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Data input was not given as list or correct array&quot;</span><span class="p">)</span>
</span><span id="Corr-93"><a href="#Corr-93"><span class="linenos">  93</span></a>
</span><span id="Corr-94"><a href="#Corr-94"><span class="linenos">  94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr-95"><a href="#Corr-95"><span class="linenos">  95</span></a>
</span><span id="Corr-96"><a href="#Corr-96"><span class="linenos">  96</span></a>        <span class="c1"># An undefined timeslice is represented by the None object</span>
</span><span id="Corr-97"><a href="#Corr-97"><span class="linenos">  97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Corr-98"><a href="#Corr-98"><span class="linenos">  98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span id="Corr-99"><a href="#Corr-99"><span class="linenos">  99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prange</span> <span class="o">=</span> <span class="n">prange</span>
</span><span id="Corr-100"><a href="#Corr-100"><span class="linenos"> 100</span></a>
</span><span id="Corr-101"><a href="#Corr-101"><span class="linenos"> 101</span></a>    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
</span><span id="Corr-102"><a href="#Corr-102"><span class="linenos"> 102</span></a>        <span class="sd">&quot;&quot;&quot;Return the content of timeslice idx&quot;&quot;&quot;</span>
</span><span id="Corr-103"><a href="#Corr-103"><span class="linenos"> 103</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-104"><a href="#Corr-104"><span class="linenos"> 104</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="Corr-105"><a href="#Corr-105"><span class="linenos"> 105</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-106"><a href="#Corr-106"><span class="linenos"> 106</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr-107"><a href="#Corr-107"><span class="linenos"> 107</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-108"><a href="#Corr-108"><span class="linenos"> 108</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="Corr-109"><a href="#Corr-109"><span class="linenos"> 109</span></a>
</span><span id="Corr-110"><a href="#Corr-110"><span class="linenos"> 110</span></a>    <span class="nd">@property</span>
</span><span id="Corr-111"><a href="#Corr-111"><span class="linenos"> 111</span></a>    <span class="k">def</span> <span class="nf">reweighted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-112"><a href="#Corr-112"><span class="linenos"> 112</span></a>        <span class="n">bool_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">reweighted</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]])</span>
</span><span id="Corr-113"><a href="#Corr-113"><span class="linenos"> 113</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">bool_array</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr-114"><a href="#Corr-114"><span class="linenos"> 114</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="Corr-115"><a href="#Corr-115"><span class="linenos"> 115</span></a>        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">bool_array</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr-116"><a href="#Corr-116"><span class="linenos"> 116</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Corr-117"><a href="#Corr-117"><span class="linenos"> 117</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-118"><a href="#Corr-118"><span class="linenos"> 118</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Reweighting status of correlator corrupted.&quot;</span><span class="p">)</span>
</span><span id="Corr-119"><a href="#Corr-119"><span class="linenos"> 119</span></a>
</span><span id="Corr-120"><a href="#Corr-120"><span class="linenos"> 120</span></a>    <span class="k">def</span> <span class="nf">gamma_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr-121"><a href="#Corr-121"><span class="linenos"> 121</span></a>        <span class="sd">&quot;&quot;&quot;Apply the gamma method to the content of the Corr.&quot;&quot;&quot;</span>
</span><span id="Corr-122"><a href="#Corr-122"><span class="linenos"> 122</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="Corr-123"><a href="#Corr-123"><span class="linenos"> 123</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-124"><a href="#Corr-124"><span class="linenos"> 124</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-125"><a href="#Corr-125"><span class="linenos"> 125</span></a>                    <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Corr-126"><a href="#Corr-126"><span class="linenos"> 126</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-127"><a href="#Corr-127"><span class="linenos"> 127</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-128"><a href="#Corr-128"><span class="linenos"> 128</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-129"><a href="#Corr-129"><span class="linenos"> 129</span></a>                            <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Corr-130"><a href="#Corr-130"><span class="linenos"> 130</span></a>
</span><span id="Corr-131"><a href="#Corr-131"><span class="linenos"> 131</span></a>    <span class="k">def</span> <span class="nf">projected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_l</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Corr-132"><a href="#Corr-132"><span class="linenos"> 132</span></a>        <span class="sd">&quot;&quot;&quot;We need to project the Correlator with a Vector to get a single value at each timeslice.</span>
</span><span id="Corr-133"><a href="#Corr-133"><span class="linenos"> 133</span></a>
</span><span id="Corr-134"><a href="#Corr-134"><span class="linenos"> 134</span></a><span class="sd">        The method can use one or two vectors.</span>
</span><span id="Corr-135"><a href="#Corr-135"><span class="linenos"> 135</span></a><span class="sd">        If two are specified it returns v1@G@v2 (the order might be very important.)</span>
</span><span id="Corr-136"><a href="#Corr-136"><span class="linenos"> 136</span></a><span class="sd">        By default it will return the lowest source, which usually means unsmeared-unsmeared (0,0), but it does not have to</span>
</span><span id="Corr-137"><a href="#Corr-137"><span class="linenos"> 137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-138"><a href="#Corr-138"><span class="linenos"> 138</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-139"><a href="#Corr-139"><span class="linenos"> 139</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Trying to project a Corr, that already has N=1.&quot;</span><span class="p">)</span>
</span><span id="Corr-140"><a href="#Corr-140"><span class="linenos"> 140</span></a>
</span><span id="Corr-141"><a href="#Corr-141"><span class="linenos"> 141</span></a>        <span class="k">if</span> <span class="n">vector_l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-142"><a href="#Corr-142"><span class="linenos"> 142</span></a>            <span class="n">vector_l</span><span class="p">,</span> <span class="n">vector_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.</span><span class="p">])</span>
</span><span id="Corr-143"><a href="#Corr-143"><span class="linenos"> 143</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">vector_r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-144"><a href="#Corr-144"><span class="linenos"> 144</span></a>            <span class="n">vector_r</span> <span class="o">=</span> <span class="n">vector_l</span>
</span><span id="Corr-145"><a href="#Corr-145"><span class="linenos"> 145</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_l</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_r</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr-146"><a href="#Corr-146"><span class="linenos"> 146</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector_l</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="Corr-147"><a href="#Corr-147"><span class="linenos"> 147</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Length of vector list must be equal to T&quot;</span><span class="p">)</span>
</span><span id="Corr-148"><a href="#Corr-148"><span class="linenos"> 148</span></a>            <span class="n">vector_r</span> <span class="o">=</span> <span class="p">[</span><span class="n">vector_r</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr-149"><a href="#Corr-149"><span class="linenos"> 149</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_r</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_l</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr-150"><a href="#Corr-150"><span class="linenos"> 150</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector_r</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="Corr-151"><a href="#Corr-151"><span class="linenos"> 151</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Length of vector list must be equal to T&quot;</span><span class="p">)</span>
</span><span id="Corr-152"><a href="#Corr-152"><span class="linenos"> 152</span></a>            <span class="n">vector_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">vector_l</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr-153"><a href="#Corr-153"><span class="linenos"> 153</span></a>
</span><span id="Corr-154"><a href="#Corr-154"><span class="linenos"> 154</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_l</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr-155"><a href="#Corr-155"><span class="linenos"> 155</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">vector_l</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">vector_r</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,):</span>
</span><span id="Corr-156"><a href="#Corr-156"><span class="linenos"> 156</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Vectors are of wrong shape!&quot;</span><span class="p">)</span>
</span><span id="Corr-157"><a href="#Corr-157"><span class="linenos"> 157</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="Corr-158"><a href="#Corr-158"><span class="linenos"> 158</span></a>                <span class="n">vector_l</span><span class="p">,</span> <span class="n">vector_r</span> <span class="o">=</span> <span class="n">vector_l</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">vector_l</span> <span class="o">@</span> <span class="n">vector_l</span><span class="p">)),</span> <span class="n">vector_r</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vector_r</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">)</span>
</span><span id="Corr-159"><a href="#Corr-159"><span class="linenos"> 159</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">vector_l</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">item</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr-160"><a href="#Corr-160"><span class="linenos"> 160</span></a>
</span><span id="Corr-161"><a href="#Corr-161"><span class="linenos"> 161</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-162"><a href="#Corr-162"><span class="linenos"> 162</span></a>            <span class="c1"># There are no checks here yet. There are so many possible scenarios, where this can go wrong.</span>
</span><span id="Corr-163"><a href="#Corr-163"><span class="linenos"> 163</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="Corr-164"><a href="#Corr-164"><span class="linenos"> 164</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-165"><a href="#Corr-165"><span class="linenos"> 165</span></a>                    <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">])),</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="Corr-166"><a href="#Corr-166"><span class="linenos"> 166</span></a>
</span><span id="Corr-167"><a href="#Corr-167"><span class="linenos"> 167</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">or</span> <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)]</span>
</span><span id="Corr-168"><a href="#Corr-168"><span class="linenos"> 168</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr-169"><a href="#Corr-169"><span class="linenos"> 169</span></a>
</span><span id="Corr-170"><a href="#Corr-170"><span class="linenos"> 170</span></a>    <span class="k">def</span> <span class="nf">item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
</span><span id="Corr-171"><a href="#Corr-171"><span class="linenos"> 171</span></a>        <span class="sd">&quot;&quot;&quot;Picks the element [i,j] from every matrix and returns a correlator containing one Obs per timeslice.</span>
</span><span id="Corr-172"><a href="#Corr-172"><span class="linenos"> 172</span></a>
</span><span id="Corr-173"><a href="#Corr-173"><span class="linenos"> 173</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-174"><a href="#Corr-174"><span class="linenos"> 174</span></a><span class="sd">        ----------</span>
</span><span id="Corr-175"><a href="#Corr-175"><span class="linenos"> 175</span></a><span class="sd">        i : int</span>
</span><span id="Corr-176"><a href="#Corr-176"><span class="linenos"> 176</span></a><span class="sd">            First index to be picked.</span>
</span><span id="Corr-177"><a href="#Corr-177"><span class="linenos"> 177</span></a><span class="sd">        j : int</span>
</span><span id="Corr-178"><a href="#Corr-178"><span class="linenos"> 178</span></a><span class="sd">            Second index to be picked.</span>
</span><span id="Corr-179"><a href="#Corr-179"><span class="linenos"> 179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-180"><a href="#Corr-180"><span class="linenos"> 180</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-181"><a href="#Corr-181"><span class="linenos"> 181</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Trying to pick item from projected Corr&quot;</span><span class="p">)</span>
</span><span id="Corr-182"><a href="#Corr-182"><span class="linenos"> 182</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr-183"><a href="#Corr-183"><span class="linenos"> 183</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr-184"><a href="#Corr-184"><span class="linenos"> 184</span></a>
</span><span id="Corr-185"><a href="#Corr-185"><span class="linenos"> 185</span></a>    <span class="k">def</span> <span class="nf">plottable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-186"><a href="#Corr-186"><span class="linenos"> 186</span></a>        <span class="sd">&quot;&quot;&quot;Outputs the correlator in a plotable format.</span>
</span><span id="Corr-187"><a href="#Corr-187"><span class="linenos"> 187</span></a>
</span><span id="Corr-188"><a href="#Corr-188"><span class="linenos"> 188</span></a><span class="sd">        Outputs three lists containing the timeslice index, the value on each</span>
</span><span id="Corr-189"><a href="#Corr-189"><span class="linenos"> 189</span></a><span class="sd">        timeslice and the error on each timeslice.</span>
</span><span id="Corr-190"><a href="#Corr-190"><span class="linenos"> 190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-191"><a href="#Corr-191"><span class="linenos"> 191</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-192"><a href="#Corr-192"><span class="linenos"> 192</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only make Corr[N=1] plottable&quot;</span><span class="p">)</span>
</span><span id="Corr-193"><a href="#Corr-193"><span class="linenos"> 193</span></a>        <span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr-194"><a href="#Corr-194"><span class="linenos"> 194</span></a>        <span class="n">y_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr-195"><a href="#Corr-195"><span class="linenos"> 195</span></a>        <span class="n">y_err_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr-196"><a href="#Corr-196"><span class="linenos"> 196</span></a>
</span><span id="Corr-197"><a href="#Corr-197"><span class="linenos"> 197</span></a>        <span class="k">return</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">y_err_list</span>
</span><span id="Corr-198"><a href="#Corr-198"><span class="linenos"> 198</span></a>
</span><span id="Corr-199"><a href="#Corr-199"><span class="linenos"> 199</span></a>    <span class="k">def</span> <span class="nf">symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-200"><a href="#Corr-200"><span class="linenos"> 200</span></a>        <span class="sd">&quot;&quot;&quot; Symmetrize the correlator around x0=0.&quot;&quot;&quot;</span>
</span><span id="Corr-201"><a href="#Corr-201"><span class="linenos"> 201</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-202"><a href="#Corr-202"><span class="linenos"> 202</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;symmetric cannot be safely applied to multi-dimensional correlators.&#39;</span><span class="p">)</span>
</span><span id="Corr-203"><a href="#Corr-203"><span class="linenos"> 203</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr-204"><a href="#Corr-204"><span class="linenos"> 204</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can not symmetrize odd T&quot;</span><span class="p">)</span>
</span><span id="Corr-205"><a href="#Corr-205"><span class="linenos"> 205</span></a>
</span><span id="Corr-206"><a href="#Corr-206"><span class="linenos"> 206</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr-207"><a href="#Corr-207"><span class="linenos"> 207</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Correlator does not seem to be symmetric around x0=0.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr-208"><a href="#Corr-208"><span class="linenos"> 208</span></a>
</span><span id="Corr-209"><a href="#Corr-209"><span class="linenos"> 209</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Corr-210"><a href="#Corr-210"><span class="linenos"> 210</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-211"><a href="#Corr-211"><span class="linenos"> 211</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-212"><a href="#Corr-212"><span class="linenos"> 212</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-213"><a href="#Corr-213"><span class="linenos"> 213</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-214"><a href="#Corr-214"><span class="linenos"> 214</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]))</span>
</span><span id="Corr-215"><a href="#Corr-215"><span class="linenos"> 215</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-216"><a href="#Corr-216"><span class="linenos"> 216</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Corr could not be symmetrized: No redundant values&quot;</span><span class="p">)</span>
</span><span id="Corr-217"><a href="#Corr-217"><span class="linenos"> 217</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-218"><a href="#Corr-218"><span class="linenos"> 218</span></a>
</span><span id="Corr-219"><a href="#Corr-219"><span class="linenos"> 219</span></a>    <span class="k">def</span> <span class="nf">anti_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-220"><a href="#Corr-220"><span class="linenos"> 220</span></a>        <span class="sd">&quot;&quot;&quot;Anti-symmetrize the correlator around x0=0.&quot;&quot;&quot;</span>
</span><span id="Corr-221"><a href="#Corr-221"><span class="linenos"> 221</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-222"><a href="#Corr-222"><span class="linenos"> 222</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;anti_symmetric cannot be safely applied to multi-dimensional correlators.&#39;</span><span class="p">)</span>
</span><span id="Corr-223"><a href="#Corr-223"><span class="linenos"> 223</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr-224"><a href="#Corr-224"><span class="linenos"> 224</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can not symmetrize odd T&quot;</span><span class="p">)</span>
</span><span id="Corr-225"><a href="#Corr-225"><span class="linenos"> 225</span></a>
</span><span id="Corr-226"><a href="#Corr-226"><span class="linenos"> 226</span></a>        <span class="n">test</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span>
</span><span id="Corr-227"><a href="#Corr-227"><span class="linenos"> 227</span></a>        <span class="n">test</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr-228"><a href="#Corr-228"><span class="linenos"> 228</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">is_zero_within_error</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]):</span>
</span><span id="Corr-229"><a href="#Corr-229"><span class="linenos"> 229</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Correlator does not seem to be anti-symmetric around x0=0.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr-230"><a href="#Corr-230"><span class="linenos"> 230</span></a>
</span><span id="Corr-231"><a href="#Corr-231"><span class="linenos"> 231</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Corr-232"><a href="#Corr-232"><span class="linenos"> 232</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-233"><a href="#Corr-233"><span class="linenos"> 233</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-234"><a href="#Corr-234"><span class="linenos"> 234</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-235"><a href="#Corr-235"><span class="linenos"> 235</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-236"><a href="#Corr-236"><span class="linenos"> 236</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]))</span>
</span><span id="Corr-237"><a href="#Corr-237"><span class="linenos"> 237</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-238"><a href="#Corr-238"><span class="linenos"> 238</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Corr could not be symmetrized: No redundant values&quot;</span><span class="p">)</span>
</span><span id="Corr-239"><a href="#Corr-239"><span class="linenos"> 239</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-240"><a href="#Corr-240"><span class="linenos"> 240</span></a>
</span><span id="Corr-241"><a href="#Corr-241"><span class="linenos"> 241</span></a>    <span class="k">def</span> <span class="nf">is_matrix_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-242"><a href="#Corr-242"><span class="linenos"> 242</span></a>        <span class="sd">&quot;&quot;&quot;Checks whether a correlator matrices is symmetric on every timeslice.&quot;&quot;&quot;</span>
</span><span id="Corr-243"><a href="#Corr-243"><span class="linenos"> 243</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-244"><a href="#Corr-244"><span class="linenos"> 244</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only works for correlator matrices.&quot;</span><span class="p">)</span>
</span><span id="Corr-245"><a href="#Corr-245"><span class="linenos"> 245</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-246"><a href="#Corr-246"><span class="linenos"> 246</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-247"><a href="#Corr-247"><span class="linenos"> 247</span></a>                <span class="k">continue</span>
</span><span id="Corr-248"><a href="#Corr-248"><span class="linenos"> 248</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-249"><a href="#Corr-249"><span class="linenos"> 249</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-250"><a href="#Corr-250"><span class="linenos"> 250</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]:</span>
</span><span id="Corr-251"><a href="#Corr-251"><span class="linenos"> 251</span></a>                        <span class="k">continue</span>
</span><span id="Corr-252"><a href="#Corr-252"><span class="linenos"> 252</span></a>                    <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]):</span>
</span><span id="Corr-253"><a href="#Corr-253"><span class="linenos"> 253</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Corr-254"><a href="#Corr-254"><span class="linenos"> 254</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="Corr-255"><a href="#Corr-255"><span class="linenos"> 255</span></a>
</span><span id="Corr-256"><a href="#Corr-256"><span class="linenos"> 256</span></a>    <span class="k">def</span> <span class="nf">matrix_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-257"><a href="#Corr-257"><span class="linenos"> 257</span></a>        <span class="sd">&quot;&quot;&quot;Symmetrizes the correlator matrices on every timeslice.&quot;&quot;&quot;</span>
</span><span id="Corr-258"><a href="#Corr-258"><span class="linenos"> 258</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-259"><a href="#Corr-259"><span class="linenos"> 259</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Trying to symmetrize a correlator matrix, that already has N=1.&quot;</span><span class="p">)</span>
</span><span id="Corr-260"><a href="#Corr-260"><span class="linenos"> 260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_matrix_symmetric</span><span class="p">():</span>
</span><span id="Corr-261"><a href="#Corr-261"><span class="linenos"> 261</span></a>            <span class="k">return</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="bp">self</span>
</span><span id="Corr-262"><a href="#Corr-262"><span class="linenos"> 262</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-263"><a href="#Corr-263"><span class="linenos"> 263</span></a>            <span class="n">transposed</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">)</span> <span class="k">else</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">G</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr-264"><a href="#Corr-264"><span class="linenos"> 264</span></a>            <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">transposed</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">)</span>
</span><span id="Corr-265"><a href="#Corr-265"><span class="linenos"> 265</span></a>
</span><span id="Corr-266"><a href="#Corr-266"><span class="linenos"> 266</span></a>    <span class="k">def</span> <span class="nf">GEVP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;Eigenvalue&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr-267"><a href="#Corr-267"><span class="linenos"> 267</span></a>        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Solve the generalized eigenvalue problem on the correlator matrix and returns the corresponding eigenvectors.</span>
</span><span id="Corr-268"><a href="#Corr-268"><span class="linenos"> 268</span></a>
</span><span id="Corr-269"><a href="#Corr-269"><span class="linenos"> 269</span></a><span class="sd">        The eigenvectors are sorted according to the descending eigenvalues, the zeroth eigenvector(s) correspond to the</span>
</span><span id="Corr-270"><a href="#Corr-270"><span class="linenos"> 270</span></a><span class="sd">        largest eigenvalue(s). The eigenvector(s) for the individual states can be accessed via slicing</span>
</span><span id="Corr-271"><a href="#Corr-271"><span class="linenos"> 271</span></a><span class="sd">        ```python</span>
</span><span id="Corr-272"><a href="#Corr-272"><span class="linenos"> 272</span></a><span class="sd">        C.GEVP(t0=2)[0]  # Ground state vector(s)</span>
</span><span id="Corr-273"><a href="#Corr-273"><span class="linenos"> 273</span></a><span class="sd">        C.GEVP(t0=2)[:3]  # Vectors for the lowest three states</span>
</span><span id="Corr-274"><a href="#Corr-274"><span class="linenos"> 274</span></a><span class="sd">        ```</span>
</span><span id="Corr-275"><a href="#Corr-275"><span class="linenos"> 275</span></a>
</span><span id="Corr-276"><a href="#Corr-276"><span class="linenos"> 276</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-277"><a href="#Corr-277"><span class="linenos"> 277</span></a><span class="sd">        ----------</span>
</span><span id="Corr-278"><a href="#Corr-278"><span class="linenos"> 278</span></a><span class="sd">        t0 : int</span>
</span><span id="Corr-279"><a href="#Corr-279"><span class="linenos"> 279</span></a><span class="sd">            The time t0 for the right hand side of the GEVP according to $G(t)v_i=\lambda_i G(t_0)v_i$</span>
</span><span id="Corr-280"><a href="#Corr-280"><span class="linenos"> 280</span></a><span class="sd">        ts : int</span>
</span><span id="Corr-281"><a href="#Corr-281"><span class="linenos"> 281</span></a><span class="sd">            fixed time $G(t_s)v_i=\lambda_i G(t_0)v_i$ if sort=None.</span>
</span><span id="Corr-282"><a href="#Corr-282"><span class="linenos"> 282</span></a><span class="sd">            If sort=&quot;Eigenvector&quot; it gives a reference point for the sorting method.</span>
</span><span id="Corr-283"><a href="#Corr-283"><span class="linenos"> 283</span></a><span class="sd">        sort : string</span>
</span><span id="Corr-284"><a href="#Corr-284"><span class="linenos"> 284</span></a><span class="sd">            If this argument is set, a list of self.T vectors per state is returned. If it is set to None, only one vector is returned.</span>
</span><span id="Corr-285"><a href="#Corr-285"><span class="linenos"> 285</span></a><span class="sd">            - &quot;Eigenvalue&quot;: The eigenvector is chosen according to which eigenvalue it belongs individually on every timeslice.</span>
</span><span id="Corr-286"><a href="#Corr-286"><span class="linenos"> 286</span></a><span class="sd">            - &quot;Eigenvector&quot;: Use the method described in arXiv:2004.10472 to find the set of v(t) belonging to the state.</span>
</span><span id="Corr-287"><a href="#Corr-287"><span class="linenos"> 287</span></a><span class="sd">              The reference state is identified by its eigenvalue at $t=t_s$.</span>
</span><span id="Corr-288"><a href="#Corr-288"><span class="linenos"> 288</span></a>
</span><span id="Corr-289"><a href="#Corr-289"><span class="linenos"> 289</span></a><span class="sd">        Other Parameters</span>
</span><span id="Corr-290"><a href="#Corr-290"><span class="linenos"> 290</span></a><span class="sd">        ----------------</span>
</span><span id="Corr-291"><a href="#Corr-291"><span class="linenos"> 291</span></a><span class="sd">        state : int</span>
</span><span id="Corr-292"><a href="#Corr-292"><span class="linenos"> 292</span></a><span class="sd">           Returns only the vector(s) for a specified state. The lowest state is zero.</span>
</span><span id="Corr-293"><a href="#Corr-293"><span class="linenos"> 293</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Corr-294"><a href="#Corr-294"><span class="linenos"> 294</span></a>
</span><span id="Corr-295"><a href="#Corr-295"><span class="linenos"> 295</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-296"><a href="#Corr-296"><span class="linenos"> 296</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;GEVP methods only works on correlator matrices and not single correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr-297"><a href="#Corr-297"><span class="linenos"> 297</span></a>        <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-298"><a href="#Corr-298"><span class="linenos"> 298</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="o">&lt;=</span> <span class="n">t0</span><span class="p">):</span>
</span><span id="Corr-299"><a href="#Corr-299"><span class="linenos"> 299</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ts has to be larger than t0.&quot;</span><span class="p">)</span>
</span><span id="Corr-300"><a href="#Corr-300"><span class="linenos"> 300</span></a>
</span><span id="Corr-301"><a href="#Corr-301"><span class="linenos"> 301</span></a>        <span class="k">if</span> <span class="s2">&quot;sorted_list&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Corr-302"><a href="#Corr-302"><span class="linenos"> 302</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument &#39;sorted_list&#39; is deprecated, use &#39;sort&#39; instead.&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="Corr-303"><a href="#Corr-303"><span class="linenos"> 303</span></a>            <span class="n">sort</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sorted_list&quot;</span><span class="p">)</span>
</span><span id="Corr-304"><a href="#Corr-304"><span class="linenos"> 304</span></a>
</span><span id="Corr-305"><a href="#Corr-305"><span class="linenos"> 305</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_matrix_symmetric</span><span class="p">():</span>
</span><span id="Corr-306"><a href="#Corr-306"><span class="linenos"> 306</span></a>            <span class="n">symmetric_corr</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Corr-307"><a href="#Corr-307"><span class="linenos"> 307</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-308"><a href="#Corr-308"><span class="linenos"> 308</span></a>            <span class="n">symmetric_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_symmetric</span><span class="p">()</span>
</span><span id="Corr-309"><a href="#Corr-309"><span class="linenos"> 309</span></a>
</span><span id="Corr-310"><a href="#Corr-310"><span class="linenos"> 310</span></a>        <span class="k">if</span> <span class="n">sort</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-311"><a href="#Corr-311"><span class="linenos"> 311</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-312"><a href="#Corr-312"><span class="linenos"> 312</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ts is required if sort=None.&quot;</span><span class="p">)</span>
</span><span id="Corr-313"><a href="#Corr-313"><span class="linenos"> 313</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">ts</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-314"><a href="#Corr-314"><span class="linenos"> 314</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Corr not defined at t0/ts.&quot;</span><span class="p">)</span>
</span><span id="Corr-315"><a href="#Corr-315"><span class="linenos"> 315</span></a>            <span class="n">G0</span><span class="p">,</span> <span class="n">Gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">)</span>
</span><span id="Corr-316"><a href="#Corr-316"><span class="linenos"> 316</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-317"><a href="#Corr-317"><span class="linenos"> 317</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-318"><a href="#Corr-318"><span class="linenos"> 318</span></a>                    <span class="n">G0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">t0</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="Corr-319"><a href="#Corr-319"><span class="linenos"> 319</span></a>                    <span class="n">Gt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">ts</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="Corr-320"><a href="#Corr-320"><span class="linenos"> 320</span></a>
</span><span id="Corr-321"><a href="#Corr-321"><span class="linenos"> 321</span></a>            <span class="n">reordered_vecs</span> <span class="o">=</span> <span class="n">_GEVP_solver</span><span class="p">(</span><span class="n">Gt</span><span class="p">,</span> <span class="n">G0</span><span class="p">)</span>
</span><span id="Corr-322"><a href="#Corr-322"><span class="linenos"> 322</span></a>
</span><span id="Corr-323"><a href="#Corr-323"><span class="linenos"> 323</span></a>        <span class="k">elif</span> <span class="n">sort</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Eigenvalue&quot;</span><span class="p">,</span> <span class="s2">&quot;Eigenvector&quot;</span><span class="p">]:</span>
</span><span id="Corr-324"><a href="#Corr-324"><span class="linenos"> 324</span></a>            <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;Eigenvalue&quot;</span> <span class="ow">and</span> <span class="n">ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-325"><a href="#Corr-325"><span class="linenos"> 325</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;ts has no effect when sorting by eigenvalue is chosen.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr-326"><a href="#Corr-326"><span class="linenos"> 326</span></a>            <span class="n">all_vecs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Corr-327"><a href="#Corr-327"><span class="linenos"> 327</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-328"><a href="#Corr-328"><span class="linenos"> 328</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Corr-329"><a href="#Corr-329"><span class="linenos"> 329</span></a>                    <span class="n">G0</span><span class="p">,</span> <span class="n">Gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">)</span>
</span><span id="Corr-330"><a href="#Corr-330"><span class="linenos"> 330</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-331"><a href="#Corr-331"><span class="linenos"> 331</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-332"><a href="#Corr-332"><span class="linenos"> 332</span></a>                            <span class="n">G0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">t0</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="Corr-333"><a href="#Corr-333"><span class="linenos"> 333</span></a>                            <span class="n">Gt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="Corr-334"><a href="#Corr-334"><span class="linenos"> 334</span></a>
</span><span id="Corr-335"><a href="#Corr-335"><span class="linenos"> 335</span></a>                    <span class="n">all_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_GEVP_solver</span><span class="p">(</span><span class="n">Gt</span><span class="p">,</span> <span class="n">G0</span><span class="p">))</span>
</span><span id="Corr-336"><a href="#Corr-336"><span class="linenos"> 336</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="Corr-337"><a href="#Corr-337"><span class="linenos"> 337</span></a>                    <span class="n">all_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-338"><a href="#Corr-338"><span class="linenos"> 338</span></a>            <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;Eigenvector&quot;</span><span class="p">:</span>
</span><span id="Corr-339"><a href="#Corr-339"><span class="linenos"> 339</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-340"><a href="#Corr-340"><span class="linenos"> 340</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ts is required for the Eigenvector sorting method.&quot;</span><span class="p">)</span>
</span><span id="Corr-341"><a href="#Corr-341"><span class="linenos"> 341</span></a>                <span class="n">all_vecs</span> <span class="o">=</span> <span class="n">_sort_vectors</span><span class="p">(</span><span class="n">all_vecs</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</span><span id="Corr-342"><a href="#Corr-342"><span class="linenos"> 342</span></a>
</span><span id="Corr-343"><a href="#Corr-343"><span class="linenos"> 343</span></a>            <span class="n">reordered_vecs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">v</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vecs</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="Corr-344"><a href="#Corr-344"><span class="linenos"> 344</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-345"><a href="#Corr-345"><span class="linenos"> 345</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unkown value for &#39;sort&#39;.&quot;</span><span class="p">)</span>
</span><span id="Corr-346"><a href="#Corr-346"><span class="linenos"> 346</span></a>
</span><span id="Corr-347"><a href="#Corr-347"><span class="linenos"> 347</span></a>        <span class="k">if</span> <span class="s2">&quot;state&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Corr-348"><a href="#Corr-348"><span class="linenos"> 348</span></a>            <span class="k">return</span> <span class="n">reordered_vecs</span><span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)]</span>
</span><span id="Corr-349"><a href="#Corr-349"><span class="linenos"> 349</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-350"><a href="#Corr-350"><span class="linenos"> 350</span></a>            <span class="k">return</span> <span class="n">reordered_vecs</span>
</span><span id="Corr-351"><a href="#Corr-351"><span class="linenos"> 351</span></a>
</span><span id="Corr-352"><a href="#Corr-352"><span class="linenos"> 352</span></a>    <span class="k">def</span> <span class="nf">Eigenvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;Eigenvalue&quot;</span><span class="p">):</span>
</span><span id="Corr-353"><a href="#Corr-353"><span class="linenos"> 353</span></a>        <span class="sd">&quot;&quot;&quot;Determines the eigenvalue of the GEVP by solving and projecting the correlator</span>
</span><span id="Corr-354"><a href="#Corr-354"><span class="linenos"> 354</span></a>
</span><span id="Corr-355"><a href="#Corr-355"><span class="linenos"> 355</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-356"><a href="#Corr-356"><span class="linenos"> 356</span></a><span class="sd">        ----------</span>
</span><span id="Corr-357"><a href="#Corr-357"><span class="linenos"> 357</span></a><span class="sd">        state : int</span>
</span><span id="Corr-358"><a href="#Corr-358"><span class="linenos"> 358</span></a><span class="sd">            The state one is interested in ordered by energy. The lowest state is zero.</span>
</span><span id="Corr-359"><a href="#Corr-359"><span class="linenos"> 359</span></a>
</span><span id="Corr-360"><a href="#Corr-360"><span class="linenos"> 360</span></a><span class="sd">        All other parameters are identical to the ones of Corr.GEVP.</span>
</span><span id="Corr-361"><a href="#Corr-361"><span class="linenos"> 361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-362"><a href="#Corr-362"><span class="linenos"> 362</span></a>        <span class="n">vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GEVP</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">)[</span><span class="n">state</span><span class="p">]</span>
</span><span id="Corr-363"><a href="#Corr-363"><span class="linenos"> 363</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">projected</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
</span><span id="Corr-364"><a href="#Corr-364"><span class="linenos"> 364</span></a>
</span><span id="Corr-365"><a href="#Corr-365"><span class="linenos"> 365</span></a>    <span class="k">def</span> <span class="nf">Hankel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Corr-366"><a href="#Corr-366"><span class="linenos"> 366</span></a>        <span class="sd">&quot;&quot;&quot;Constructs an NxN Hankel matrix</span>
</span><span id="Corr-367"><a href="#Corr-367"><span class="linenos"> 367</span></a>
</span><span id="Corr-368"><a href="#Corr-368"><span class="linenos"> 368</span></a><span class="sd">        C(t) c(t+1) ... c(t+n-1)</span>
</span><span id="Corr-369"><a href="#Corr-369"><span class="linenos"> 369</span></a><span class="sd">        C(t+1) c(t+2) ... c(t+n)</span>
</span><span id="Corr-370"><a href="#Corr-370"><span class="linenos"> 370</span></a><span class="sd">        .................</span>
</span><span id="Corr-371"><a href="#Corr-371"><span class="linenos"> 371</span></a><span class="sd">        C(t+(n-1)) c(t+n) ... c(t+2(n-1))</span>
</span><span id="Corr-372"><a href="#Corr-372"><span class="linenos"> 372</span></a>
</span><span id="Corr-373"><a href="#Corr-373"><span class="linenos"> 373</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-374"><a href="#Corr-374"><span class="linenos"> 374</span></a><span class="sd">        ----------</span>
</span><span id="Corr-375"><a href="#Corr-375"><span class="linenos"> 375</span></a><span class="sd">        N : int</span>
</span><span id="Corr-376"><a href="#Corr-376"><span class="linenos"> 376</span></a><span class="sd">            Dimension of the Hankel matrix</span>
</span><span id="Corr-377"><a href="#Corr-377"><span class="linenos"> 377</span></a><span class="sd">        periodic : bool, optional</span>
</span><span id="Corr-378"><a href="#Corr-378"><span class="linenos"> 378</span></a><span class="sd">            determines whether the matrix is extended periodically</span>
</span><span id="Corr-379"><a href="#Corr-379"><span class="linenos"> 379</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-380"><a href="#Corr-380"><span class="linenos"> 380</span></a>
</span><span id="Corr-381"><a href="#Corr-381"><span class="linenos"> 381</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-382"><a href="#Corr-382"><span class="linenos"> 382</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multi-operator Prony not implemented!&quot;</span><span class="p">)</span>
</span><span id="Corr-383"><a href="#Corr-383"><span class="linenos"> 383</span></a>
</span><span id="Corr-384"><a href="#Corr-384"><span class="linenos"> 384</span></a>        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
</span><span id="Corr-385"><a href="#Corr-385"><span class="linenos"> 385</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-386"><a href="#Corr-386"><span class="linenos"> 386</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-387"><a href="#Corr-387"><span class="linenos"> 387</span></a>            <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Corr-388"><a href="#Corr-388"><span class="linenos"> 388</span></a>
</span><span id="Corr-389"><a href="#Corr-389"><span class="linenos"> 389</span></a>        <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="Corr-390"><a href="#Corr-390"><span class="linenos"> 390</span></a>            <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="Corr-391"><a href="#Corr-391"><span class="linenos"> 391</span></a>                <span class="n">i</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr-392"><a href="#Corr-392"><span class="linenos"> 392</span></a>            <span class="k">return</span> <span class="n">i</span>
</span><span id="Corr-393"><a href="#Corr-393"><span class="linenos"> 393</span></a>
</span><span id="Corr-394"><a href="#Corr-394"><span class="linenos"> 394</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-395"><a href="#Corr-395"><span class="linenos"> 395</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-396"><a href="#Corr-396"><span class="linenos"> 396</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr-397"><a href="#Corr-397"><span class="linenos"> 397</span></a>                    <span class="k">if</span> <span class="n">periodic</span><span class="p">:</span>
</span><span id="Corr-398"><a href="#Corr-398"><span class="linenos"> 398</span></a>                        <span class="n">new_content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">wrap</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr-399"><a href="#Corr-399"><span class="linenos"> 399</span></a>                    <span class="k">elif</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="Corr-400"><a href="#Corr-400"><span class="linenos"> 400</span></a>                        <span class="n">new_content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr-401"><a href="#Corr-401"><span class="linenos"> 401</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-402"><a href="#Corr-402"><span class="linenos"> 402</span></a>                        <span class="n">new_content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr-403"><a href="#Corr-403"><span class="linenos"> 403</span></a>
</span><span id="Corr-404"><a href="#Corr-404"><span class="linenos"> 404</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span><span id="Corr-405"><a href="#Corr-405"><span class="linenos"> 405</span></a>
</span><span id="Corr-406"><a href="#Corr-406"><span class="linenos"> 406</span></a>    <span class="k">def</span> <span class="nf">roll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
</span><span id="Corr-407"><a href="#Corr-407"><span class="linenos"> 407</span></a>        <span class="sd">&quot;&quot;&quot;Periodically shift the correlator by dt timeslices</span>
</span><span id="Corr-408"><a href="#Corr-408"><span class="linenos"> 408</span></a>
</span><span id="Corr-409"><a href="#Corr-409"><span class="linenos"> 409</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-410"><a href="#Corr-410"><span class="linenos"> 410</span></a><span class="sd">        ----------</span>
</span><span id="Corr-411"><a href="#Corr-411"><span class="linenos"> 411</span></a><span class="sd">        dt : int</span>
</span><span id="Corr-412"><a href="#Corr-412"><span class="linenos"> 412</span></a><span class="sd">            number of timeslices</span>
</span><span id="Corr-413"><a href="#Corr-413"><span class="linenos"> 413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-414"><a href="#Corr-414"><span class="linenos"> 414</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">),</span> <span class="n">dt</span><span class="p">)))</span>
</span><span id="Corr-415"><a href="#Corr-415"><span class="linenos"> 415</span></a>
</span><span id="Corr-416"><a href="#Corr-416"><span class="linenos"> 416</span></a>    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-417"><a href="#Corr-417"><span class="linenos"> 417</span></a>        <span class="sd">&quot;&quot;&quot;Reverse the time ordering of the Corr&quot;&quot;&quot;</span>
</span><span id="Corr-418"><a href="#Corr-418"><span class="linenos"> 418</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[::</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Corr-419"><a href="#Corr-419"><span class="linenos"> 419</span></a>
</span><span id="Corr-420"><a href="#Corr-420"><span class="linenos"> 420</span></a>    <span class="k">def</span> <span class="nf">thin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="Corr-421"><a href="#Corr-421"><span class="linenos"> 421</span></a>        <span class="sd">&quot;&quot;&quot;Thin out a correlator to suppress correlations</span>
</span><span id="Corr-422"><a href="#Corr-422"><span class="linenos"> 422</span></a>
</span><span id="Corr-423"><a href="#Corr-423"><span class="linenos"> 423</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-424"><a href="#Corr-424"><span class="linenos"> 424</span></a><span class="sd">        ----------</span>
</span><span id="Corr-425"><a href="#Corr-425"><span class="linenos"> 425</span></a><span class="sd">        spacing : int</span>
</span><span id="Corr-426"><a href="#Corr-426"><span class="linenos"> 426</span></a><span class="sd">            Keep only every &#39;spacing&#39;th entry of the correlator</span>
</span><span id="Corr-427"><a href="#Corr-427"><span class="linenos"> 427</span></a><span class="sd">        offset : int</span>
</span><span id="Corr-428"><a href="#Corr-428"><span class="linenos"> 428</span></a><span class="sd">            Offset the equal spacing</span>
</span><span id="Corr-429"><a href="#Corr-429"><span class="linenos"> 429</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-430"><a href="#Corr-430"><span class="linenos"> 430</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-431"><a href="#Corr-431"><span class="linenos"> 431</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-432"><a href="#Corr-432"><span class="linenos"> 432</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span> <span class="o">%</span> <span class="n">spacing</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr-433"><a href="#Corr-433"><span class="linenos"> 433</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-434"><a href="#Corr-434"><span class="linenos"> 434</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-435"><a href="#Corr-435"><span class="linenos"> 435</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="Corr-436"><a href="#Corr-436"><span class="linenos"> 436</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span><span id="Corr-437"><a href="#Corr-437"><span class="linenos"> 437</span></a>
</span><span id="Corr-438"><a href="#Corr-438"><span class="linenos"> 438</span></a>    <span class="k">def</span> <span class="nf">correlate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partner</span><span class="p">):</span>
</span><span id="Corr-439"><a href="#Corr-439"><span class="linenos"> 439</span></a>        <span class="sd">&quot;&quot;&quot;Correlate the correlator with another correlator or Obs</span>
</span><span id="Corr-440"><a href="#Corr-440"><span class="linenos"> 440</span></a>
</span><span id="Corr-441"><a href="#Corr-441"><span class="linenos"> 441</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-442"><a href="#Corr-442"><span class="linenos"> 442</span></a><span class="sd">        ----------</span>
</span><span id="Corr-443"><a href="#Corr-443"><span class="linenos"> 443</span></a><span class="sd">        partner : Obs or Corr</span>
</span><span id="Corr-444"><a href="#Corr-444"><span class="linenos"> 444</span></a><span class="sd">            partner to correlate the correlator with.</span>
</span><span id="Corr-445"><a href="#Corr-445"><span class="linenos"> 445</span></a><span class="sd">            Can either be an Obs which is correlated with all entries of the</span>
</span><span id="Corr-446"><a href="#Corr-446"><span class="linenos"> 446</span></a><span class="sd">            correlator or a Corr of same length.</span>
</span><span id="Corr-447"><a href="#Corr-447"><span class="linenos"> 447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-448"><a href="#Corr-448"><span class="linenos"> 448</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-449"><a href="#Corr-449"><span class="linenos"> 449</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only one-dimensional correlators can be safely correlated.&quot;</span><span class="p">)</span>
</span><span id="Corr-450"><a href="#Corr-450"><span class="linenos"> 450</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-451"><a href="#Corr-451"><span class="linenos"> 451</span></a>        <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">t_slice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
</span><span id="Corr-452"><a href="#Corr-452"><span class="linenos"> 452</span></a>            <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_slice</span><span class="p">):</span>
</span><span id="Corr-453"><a href="#Corr-453"><span class="linenos"> 453</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-454"><a href="#Corr-454"><span class="linenos"> 454</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-455"><a href="#Corr-455"><span class="linenos"> 455</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="Corr-456"><a href="#Corr-456"><span class="linenos"> 456</span></a>                    <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x0</span><span class="p">]):</span>
</span><span id="Corr-457"><a href="#Corr-457"><span class="linenos"> 457</span></a>                        <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-458"><a href="#Corr-458"><span class="linenos"> 458</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-459"><a href="#Corr-459"><span class="linenos"> 459</span></a>                        <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">correlate</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">t_slice</span><span class="p">]))</span>
</span><span id="Corr-460"><a href="#Corr-460"><span class="linenos"> 460</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">Obs</span><span class="p">):</span>  <span class="c1"># Should this include CObs?</span>
</span><span id="Corr-461"><a href="#Corr-461"><span class="linenos"> 461</span></a>                    <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">correlate</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">t_slice</span><span class="p">]))</span>
</span><span id="Corr-462"><a href="#Corr-462"><span class="linenos"> 462</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-463"><a href="#Corr-463"><span class="linenos"> 463</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only correlate with an Obs or a Corr.&quot;</span><span class="p">)</span>
</span><span id="Corr-464"><a href="#Corr-464"><span class="linenos"> 464</span></a>
</span><span id="Corr-465"><a href="#Corr-465"><span class="linenos"> 465</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span><span id="Corr-466"><a href="#Corr-466"><span class="linenos"> 466</span></a>
</span><span id="Corr-467"><a href="#Corr-467"><span class="linenos"> 467</span></a>    <span class="k">def</span> <span class="nf">reweight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr-468"><a href="#Corr-468"><span class="linenos"> 468</span></a>        <span class="sd">&quot;&quot;&quot;Reweight the correlator.</span>
</span><span id="Corr-469"><a href="#Corr-469"><span class="linenos"> 469</span></a>
</span><span id="Corr-470"><a href="#Corr-470"><span class="linenos"> 470</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-471"><a href="#Corr-471"><span class="linenos"> 471</span></a><span class="sd">        ----------</span>
</span><span id="Corr-472"><a href="#Corr-472"><span class="linenos"> 472</span></a><span class="sd">        weight : Obs</span>
</span><span id="Corr-473"><a href="#Corr-473"><span class="linenos"> 473</span></a><span class="sd">            Reweighting factor. An Observable that has to be defined on a superset of the</span>
</span><span id="Corr-474"><a href="#Corr-474"><span class="linenos"> 474</span></a><span class="sd">            configurations in obs[i].idl for all i.</span>
</span><span id="Corr-475"><a href="#Corr-475"><span class="linenos"> 475</span></a><span class="sd">        all_configs : bool</span>
</span><span id="Corr-476"><a href="#Corr-476"><span class="linenos"> 476</span></a><span class="sd">            if True, the reweighted observables are normalized by the average of</span>
</span><span id="Corr-477"><a href="#Corr-477"><span class="linenos"> 477</span></a><span class="sd">            the reweighting factor on all configurations in weight.idl and not</span>
</span><span id="Corr-478"><a href="#Corr-478"><span class="linenos"> 478</span></a><span class="sd">            on the configurations in obs[i].idl.</span>
</span><span id="Corr-479"><a href="#Corr-479"><span class="linenos"> 479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-480"><a href="#Corr-480"><span class="linenos"> 480</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-481"><a href="#Corr-481"><span class="linenos"> 481</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Reweighting only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr-482"><a href="#Corr-482"><span class="linenos"> 482</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-483"><a href="#Corr-483"><span class="linenos"> 483</span></a>        <span class="k">for</span> <span class="n">t_slice</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="Corr-484"><a href="#Corr-484"><span class="linenos"> 484</span></a>            <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_slice</span><span class="p">):</span>
</span><span id="Corr-485"><a href="#Corr-485"><span class="linenos"> 485</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-486"><a href="#Corr-486"><span class="linenos"> 486</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-487"><a href="#Corr-487"><span class="linenos"> 487</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reweight</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">t_slice</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)))</span>
</span><span id="Corr-488"><a href="#Corr-488"><span class="linenos"> 488</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span><span id="Corr-489"><a href="#Corr-489"><span class="linenos"> 489</span></a>
</span><span id="Corr-490"><a href="#Corr-490"><span class="linenos"> 490</span></a>    <span class="k">def</span> <span class="nf">T_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partner</span><span class="p">,</span> <span class="n">parity</span><span class="o">=+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Corr-491"><a href="#Corr-491"><span class="linenos"> 491</span></a>        <span class="sd">&quot;&quot;&quot;Return the time symmetry average of the correlator and its partner</span>
</span><span id="Corr-492"><a href="#Corr-492"><span class="linenos"> 492</span></a>
</span><span id="Corr-493"><a href="#Corr-493"><span class="linenos"> 493</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-494"><a href="#Corr-494"><span class="linenos"> 494</span></a><span class="sd">        ----------</span>
</span><span id="Corr-495"><a href="#Corr-495"><span class="linenos"> 495</span></a><span class="sd">        partner : Corr</span>
</span><span id="Corr-496"><a href="#Corr-496"><span class="linenos"> 496</span></a><span class="sd">            Time symmetry partner of the Corr</span>
</span><span id="Corr-497"><a href="#Corr-497"><span class="linenos"> 497</span></a><span class="sd">        partity : int</span>
</span><span id="Corr-498"><a href="#Corr-498"><span class="linenos"> 498</span></a><span class="sd">            Parity quantum number of the correlator, can be +1 or -1</span>
</span><span id="Corr-499"><a href="#Corr-499"><span class="linenos"> 499</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-500"><a href="#Corr-500"><span class="linenos"> 500</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-501"><a href="#Corr-501"><span class="linenos"> 501</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;T_symmetry only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr-502"><a href="#Corr-502"><span class="linenos"> 502</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="Corr-503"><a href="#Corr-503"><span class="linenos"> 503</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;T partner has to be a Corr object.&quot;</span><span class="p">)</span>
</span><span id="Corr-504"><a href="#Corr-504"><span class="linenos"> 504</span></a>        <span class="k">if</span> <span class="n">parity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Corr-505"><a href="#Corr-505"><span class="linenos"> 505</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Parity has to be +1 or -1.&quot;</span><span class="p">)</span>
</span><span id="Corr-506"><a href="#Corr-506"><span class="linenos"> 506</span></a>        <span class="n">T_partner</span> <span class="o">=</span> <span class="n">parity</span> <span class="o">*</span> <span class="n">partner</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="Corr-507"><a href="#Corr-507"><span class="linenos"> 507</span></a>
</span><span id="Corr-508"><a href="#Corr-508"><span class="linenos"> 508</span></a>        <span class="n">t_slices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-509"><a href="#Corr-509"><span class="linenos"> 509</span></a>        <span class="n">test</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span> <span class="o">-</span> <span class="n">T_partner</span><span class="p">)</span>
</span><span id="Corr-510"><a href="#Corr-510"><span class="linenos"> 510</span></a>        <span class="n">test</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr-511"><a href="#Corr-511"><span class="linenos"> 511</span></a>        <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">t_slice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
</span><span id="Corr-512"><a href="#Corr-512"><span class="linenos"> 512</span></a>            <span class="k">if</span> <span class="n">t_slice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-513"><a href="#Corr-513"><span class="linenos"> 513</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">t_slice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_zero_within_error</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="Corr-514"><a href="#Corr-514"><span class="linenos"> 514</span></a>                    <span class="n">t_slices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
</span><span id="Corr-515"><a href="#Corr-515"><span class="linenos"> 515</span></a>        <span class="k">if</span> <span class="n">t_slices</span><span class="p">:</span>
</span><span id="Corr-516"><a href="#Corr-516"><span class="linenos"> 516</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;T symmetry partners do not agree within 5 sigma on time slices &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t_slices</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr-517"><a href="#Corr-517"><span class="linenos"> 517</span></a>
</span><span id="Corr-518"><a href="#Corr-518"><span class="linenos"> 518</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">+</span> <span class="n">T_partner</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Corr-519"><a href="#Corr-519"><span class="linenos"> 519</span></a>
</span><span id="Corr-520"><a href="#Corr-520"><span class="linenos"> 520</span></a>    <span class="k">def</span> <span class="nf">deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;symmetric&quot;</span><span class="p">):</span>
</span><span id="Corr-521"><a href="#Corr-521"><span class="linenos"> 521</span></a>        <span class="sd">&quot;&quot;&quot;Return the first derivative of the correlator with respect to x0.</span>
</span><span id="Corr-522"><a href="#Corr-522"><span class="linenos"> 522</span></a>
</span><span id="Corr-523"><a href="#Corr-523"><span class="linenos"> 523</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-524"><a href="#Corr-524"><span class="linenos"> 524</span></a><span class="sd">        ----------</span>
</span><span id="Corr-525"><a href="#Corr-525"><span class="linenos"> 525</span></a><span class="sd">        variant : str</span>
</span><span id="Corr-526"><a href="#Corr-526"><span class="linenos"> 526</span></a><span class="sd">            decides which definition of the finite differences derivative is used.</span>
</span><span id="Corr-527"><a href="#Corr-527"><span class="linenos"> 527</span></a><span class="sd">            Available choice: symmetric, forward, backward, improved, log, default: symmetric</span>
</span><span id="Corr-528"><a href="#Corr-528"><span class="linenos"> 528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-529"><a href="#Corr-529"><span class="linenos"> 529</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-530"><a href="#Corr-530"><span class="linenos"> 530</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;deriv only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr-531"><a href="#Corr-531"><span class="linenos"> 531</span></a>        <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;symmetric&quot;</span><span class="p">:</span>
</span><span id="Corr-532"><a href="#Corr-532"><span class="linenos"> 532</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-533"><a href="#Corr-533"><span class="linenos"> 533</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr-534"><a href="#Corr-534"><span class="linenos"> 534</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-535"><a href="#Corr-535"><span class="linenos"> 535</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-536"><a href="#Corr-536"><span class="linenos"> 536</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-537"><a href="#Corr-537"><span class="linenos"> 537</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Corr-538"><a href="#Corr-538"><span class="linenos"> 538</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-539"><a href="#Corr-539"><span class="linenos"> 539</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Derivative is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr-540"><a href="#Corr-540"><span class="linenos"> 540</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr-541"><a href="#Corr-541"><span class="linenos"> 541</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
</span><span id="Corr-542"><a href="#Corr-542"><span class="linenos"> 542</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-543"><a href="#Corr-543"><span class="linenos"> 543</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr-544"><a href="#Corr-544"><span class="linenos"> 544</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-545"><a href="#Corr-545"><span class="linenos"> 545</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-546"><a href="#Corr-546"><span class="linenos"> 546</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-547"><a href="#Corr-547"><span class="linenos"> 547</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="Corr-548"><a href="#Corr-548"><span class="linenos"> 548</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-549"><a href="#Corr-549"><span class="linenos"> 549</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr-550"><a href="#Corr-550"><span class="linenos"> 550</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr-551"><a href="#Corr-551"><span class="linenos"> 551</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
</span><span id="Corr-552"><a href="#Corr-552"><span class="linenos"> 552</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-553"><a href="#Corr-553"><span class="linenos"> 553</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-554"><a href="#Corr-554"><span class="linenos"> 554</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-555"><a href="#Corr-555"><span class="linenos"> 555</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-556"><a href="#Corr-556"><span class="linenos"> 556</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-557"><a href="#Corr-557"><span class="linenos"> 557</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr-558"><a href="#Corr-558"><span class="linenos"> 558</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-559"><a href="#Corr-559"><span class="linenos"> 559</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr-560"><a href="#Corr-560"><span class="linenos"> 560</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="Corr-561"><a href="#Corr-561"><span class="linenos"> 561</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;improved&quot;</span><span class="p">:</span>
</span><span id="Corr-562"><a href="#Corr-562"><span class="linenos"> 562</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-563"><a href="#Corr-563"><span class="linenos"> 563</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="Corr-564"><a href="#Corr-564"><span class="linenos"> 564</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-565"><a href="#Corr-565"><span class="linenos"> 565</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-566"><a href="#Corr-566"><span class="linenos"> 566</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-567"><a href="#Corr-567"><span class="linenos"> 567</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
</span><span id="Corr-568"><a href="#Corr-568"><span class="linenos"> 568</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-569"><a href="#Corr-569"><span class="linenos"> 569</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Derivative is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr-570"><a href="#Corr-570"><span class="linenos"> 570</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Corr-571"><a href="#Corr-571"><span class="linenos"> 571</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
</span><span id="Corr-572"><a href="#Corr-572"><span class="linenos"> 572</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-573"><a href="#Corr-573"><span class="linenos"> 573</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-574"><a href="#Corr-574"><span class="linenos"> 574</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr-575"><a href="#Corr-575"><span class="linenos"> 575</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-576"><a href="#Corr-576"><span class="linenos"> 576</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-577"><a href="#Corr-577"><span class="linenos"> 577</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
</span><span id="Corr-578"><a href="#Corr-578"><span class="linenos"> 578</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-579"><a href="#Corr-579"><span class="linenos"> 579</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Log is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr-580"><a href="#Corr-580"><span class="linenos"> 580</span></a>            <span class="n">logcorr</span> <span class="o">=</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr-581"><a href="#Corr-581"><span class="linenos"> 581</span></a>            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">logcorr</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="s1">&#39;symmetric&#39;</span><span class="p">)</span>
</span><span id="Corr-582"><a href="#Corr-582"><span class="linenos"> 582</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-583"><a href="#Corr-583"><span class="linenos"> 583</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown variant.&quot;</span><span class="p">)</span>
</span><span id="Corr-584"><a href="#Corr-584"><span class="linenos"> 584</span></a>
</span><span id="Corr-585"><a href="#Corr-585"><span class="linenos"> 585</span></a>    <span class="k">def</span> <span class="nf">second_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;symmetric&quot;</span><span class="p">):</span>
</span><span id="Corr-586"><a href="#Corr-586"><span class="linenos"> 586</span></a>        <span class="sd">&quot;&quot;&quot;Return the second derivative of the correlator with respect to x0.</span>
</span><span id="Corr-587"><a href="#Corr-587"><span class="linenos"> 587</span></a>
</span><span id="Corr-588"><a href="#Corr-588"><span class="linenos"> 588</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-589"><a href="#Corr-589"><span class="linenos"> 589</span></a><span class="sd">        ----------</span>
</span><span id="Corr-590"><a href="#Corr-590"><span class="linenos"> 590</span></a><span class="sd">        variant : str</span>
</span><span id="Corr-591"><a href="#Corr-591"><span class="linenos"> 591</span></a><span class="sd">            decides which definition of the finite differences derivative is used.</span>
</span><span id="Corr-592"><a href="#Corr-592"><span class="linenos"> 592</span></a><span class="sd">            Available choice: symmetric, improved, log, default: symmetric</span>
</span><span id="Corr-593"><a href="#Corr-593"><span class="linenos"> 593</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-594"><a href="#Corr-594"><span class="linenos"> 594</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-595"><a href="#Corr-595"><span class="linenos"> 595</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;second_deriv only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr-596"><a href="#Corr-596"><span class="linenos"> 596</span></a>        <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;symmetric&quot;</span><span class="p">:</span>
</span><span id="Corr-597"><a href="#Corr-597"><span class="linenos"> 597</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-598"><a href="#Corr-598"><span class="linenos"> 598</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr-599"><a href="#Corr-599"><span class="linenos"> 599</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-600"><a href="#Corr-600"><span class="linenos"> 600</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-601"><a href="#Corr-601"><span class="linenos"> 601</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-602"><a href="#Corr-602"><span class="linenos"> 602</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Corr-603"><a href="#Corr-603"><span class="linenos"> 603</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-604"><a href="#Corr-604"><span class="linenos"> 604</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr-605"><a href="#Corr-605"><span class="linenos"> 605</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr-606"><a href="#Corr-606"><span class="linenos"> 606</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;improved&quot;</span><span class="p">:</span>
</span><span id="Corr-607"><a href="#Corr-607"><span class="linenos"> 607</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-608"><a href="#Corr-608"><span class="linenos"> 608</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="Corr-609"><a href="#Corr-609"><span class="linenos"> 609</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-610"><a href="#Corr-610"><span class="linenos"> 610</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-611"><a href="#Corr-611"><span class="linenos"> 611</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-612"><a href="#Corr-612"><span class="linenos"> 612</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]))</span>
</span><span id="Corr-613"><a href="#Corr-613"><span class="linenos"> 613</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-614"><a href="#Corr-614"><span class="linenos"> 614</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr-615"><a href="#Corr-615"><span class="linenos"> 615</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Corr-616"><a href="#Corr-616"><span class="linenos"> 616</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
</span><span id="Corr-617"><a href="#Corr-617"><span class="linenos"> 617</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-618"><a href="#Corr-618"><span class="linenos"> 618</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-619"><a href="#Corr-619"><span class="linenos"> 619</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr-620"><a href="#Corr-620"><span class="linenos"> 620</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-621"><a href="#Corr-621"><span class="linenos"> 621</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-622"><a href="#Corr-622"><span class="linenos"> 622</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
</span><span id="Corr-623"><a href="#Corr-623"><span class="linenos"> 623</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-624"><a href="#Corr-624"><span class="linenos"> 624</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Log is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr-625"><a href="#Corr-625"><span class="linenos"> 625</span></a>            <span class="n">logcorr</span> <span class="o">=</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr-626"><a href="#Corr-626"><span class="linenos"> 626</span></a>            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="n">logcorr</span><span class="o">.</span><span class="n">second_deriv</span><span class="p">(</span><span class="s1">&#39;symmetric&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">logcorr</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="s1">&#39;symmetric&#39;</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Corr-627"><a href="#Corr-627"><span class="linenos"> 627</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-628"><a href="#Corr-628"><span class="linenos"> 628</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown variant.&quot;</span><span class="p">)</span>
</span><span id="Corr-629"><a href="#Corr-629"><span class="linenos"> 629</span></a>
</span><span id="Corr-630"><a href="#Corr-630"><span class="linenos"> 630</span></a>    <span class="k">def</span> <span class="nf">m_eff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="Corr-631"><a href="#Corr-631"><span class="linenos"> 631</span></a>        <span class="sd">&quot;&quot;&quot;Returns the effective mass of the correlator as correlator object</span>
</span><span id="Corr-632"><a href="#Corr-632"><span class="linenos"> 632</span></a>
</span><span id="Corr-633"><a href="#Corr-633"><span class="linenos"> 633</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-634"><a href="#Corr-634"><span class="linenos"> 634</span></a><span class="sd">        ----------</span>
</span><span id="Corr-635"><a href="#Corr-635"><span class="linenos"> 635</span></a><span class="sd">        variant : str</span>
</span><span id="Corr-636"><a href="#Corr-636"><span class="linenos"> 636</span></a><span class="sd">            log : uses the standard effective mass log(C(t) / C(t+1))</span>
</span><span id="Corr-637"><a href="#Corr-637"><span class="linenos"> 637</span></a><span class="sd">            cosh, periodic : Use periodicitiy of the correlator by solving C(t) / C(t+1) = cosh(m * (t - T/2)) / cosh(m * (t + 1 - T/2)) for m.</span>
</span><span id="Corr-638"><a href="#Corr-638"><span class="linenos"> 638</span></a><span class="sd">            sinh : Use anti-periodicitiy of the correlator by solving C(t) / C(t+1) = sinh(m * (t - T/2)) / sinh(m * (t + 1 - T/2)) for m.</span>
</span><span id="Corr-639"><a href="#Corr-639"><span class="linenos"> 639</span></a><span class="sd">            See, e.g., arXiv:1205.5380</span>
</span><span id="Corr-640"><a href="#Corr-640"><span class="linenos"> 640</span></a><span class="sd">            arccosh : Uses the explicit form of the symmetrized correlator (not recommended)</span>
</span><span id="Corr-641"><a href="#Corr-641"><span class="linenos"> 641</span></a><span class="sd">            logsym: uses the symmetric effective mass log(C(t-1) / C(t+1))/2</span>
</span><span id="Corr-642"><a href="#Corr-642"><span class="linenos"> 642</span></a><span class="sd">        guess : float</span>
</span><span id="Corr-643"><a href="#Corr-643"><span class="linenos"> 643</span></a><span class="sd">            guess for the root finder, only relevant for the root variant</span>
</span><span id="Corr-644"><a href="#Corr-644"><span class="linenos"> 644</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-645"><a href="#Corr-645"><span class="linenos"> 645</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-646"><a href="#Corr-646"><span class="linenos"> 646</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Correlator must be projected before getting m_eff&#39;</span><span class="p">)</span>
</span><span id="Corr-647"><a href="#Corr-647"><span class="linenos"> 647</span></a>        <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
</span><span id="Corr-648"><a href="#Corr-648"><span class="linenos"> 648</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-649"><a href="#Corr-649"><span class="linenos"> 649</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr-650"><a href="#Corr-650"><span class="linenos"> 650</span></a>                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr-651"><a href="#Corr-651"><span class="linenos"> 651</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-652"><a href="#Corr-652"><span class="linenos"> 652</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr-653"><a href="#Corr-653"><span class="linenos"> 653</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-654"><a href="#Corr-654"><span class="linenos"> 654</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-655"><a href="#Corr-655"><span class="linenos"> 655</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr-656"><a href="#Corr-656"><span class="linenos"> 656</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-657"><a href="#Corr-657"><span class="linenos"> 657</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;m_eff is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr-658"><a href="#Corr-658"><span class="linenos"> 658</span></a>
</span><span id="Corr-659"><a href="#Corr-659"><span class="linenos"> 659</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Corr-660"><a href="#Corr-660"><span class="linenos"> 660</span></a>
</span><span id="Corr-661"><a href="#Corr-661"><span class="linenos"> 661</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;logsym&#39;</span><span class="p">:</span>
</span><span id="Corr-662"><a href="#Corr-662"><span class="linenos"> 662</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-663"><a href="#Corr-663"><span class="linenos"> 663</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr-664"><a href="#Corr-664"><span class="linenos"> 664</span></a>                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr-665"><a href="#Corr-665"><span class="linenos"> 665</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-666"><a href="#Corr-666"><span class="linenos"> 666</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr-667"><a href="#Corr-667"><span class="linenos"> 667</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-668"><a href="#Corr-668"><span class="linenos"> 668</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-669"><a href="#Corr-669"><span class="linenos"> 669</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr-670"><a href="#Corr-670"><span class="linenos"> 670</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-671"><a href="#Corr-671"><span class="linenos"> 671</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;m_eff is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr-672"><a href="#Corr-672"><span class="linenos"> 672</span></a>
</span><span id="Corr-673"><a href="#Corr-673"><span class="linenos"> 673</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Corr-674"><a href="#Corr-674"><span class="linenos"> 674</span></a>
</span><span id="Corr-675"><a href="#Corr-675"><span class="linenos"> 675</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">,</span> <span class="s1">&#39;sinh&#39;</span><span class="p">]:</span>
</span><span id="Corr-676"><a href="#Corr-676"><span class="linenos"> 676</span></a>            <span class="k">if</span> <span class="n">variant</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">]:</span>
</span><span id="Corr-677"><a href="#Corr-677"><span class="linenos"> 677</span></a>                <span class="n">func</span> <span class="o">=</span> <span class="n">anp</span><span class="o">.</span><span class="n">cosh</span>
</span><span id="Corr-678"><a href="#Corr-678"><span class="linenos"> 678</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-679"><a href="#Corr-679"><span class="linenos"> 679</span></a>                <span class="n">func</span> <span class="o">=</span> <span class="n">anp</span><span class="o">.</span><span class="n">sinh</span>
</span><span id="Corr-680"><a href="#Corr-680"><span class="linenos"> 680</span></a>
</span><span id="Corr-681"><a href="#Corr-681"><span class="linenos"> 681</span></a>            <span class="k">def</span> <span class="nf">root_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="Corr-682"><a href="#Corr-682"><span class="linenos"> 682</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">d</span>
</span><span id="Corr-683"><a href="#Corr-683"><span class="linenos"> 683</span></a>
</span><span id="Corr-684"><a href="#Corr-684"><span class="linenos"> 684</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-685"><a href="#Corr-685"><span class="linenos"> 685</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr-686"><a href="#Corr-686"><span class="linenos"> 686</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr-687"><a href="#Corr-687"><span class="linenos"> 687</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-688"><a href="#Corr-688"><span class="linenos"> 688</span></a>                <span class="c1"># Fill the two timeslices in the middle of the lattice with their predecessors</span>
</span><span id="Corr-689"><a href="#Corr-689"><span class="linenos"> 689</span></a>                <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;sinh&#39;</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="Corr-690"><a href="#Corr-690"><span class="linenos"> 690</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newcontent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Corr-691"><a href="#Corr-691"><span class="linenos"> 691</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr-692"><a href="#Corr-692"><span class="linenos"> 692</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-693"><a href="#Corr-693"><span class="linenos"> 693</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-694"><a href="#Corr-694"><span class="linenos"> 694</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">find_root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">root_function</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="n">guess</span><span class="p">)))</span>
</span><span id="Corr-695"><a href="#Corr-695"><span class="linenos"> 695</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-696"><a href="#Corr-696"><span class="linenos"> 696</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;m_eff is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr-697"><a href="#Corr-697"><span class="linenos"> 697</span></a>
</span><span id="Corr-698"><a href="#Corr-698"><span class="linenos"> 698</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr-699"><a href="#Corr-699"><span class="linenos"> 699</span></a>
</span><span id="Corr-700"><a href="#Corr-700"><span class="linenos"> 700</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;arccosh&#39;</span><span class="p">:</span>
</span><span id="Corr-701"><a href="#Corr-701"><span class="linenos"> 701</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-702"><a href="#Corr-702"><span class="linenos"> 702</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr-703"><a href="#Corr-703"><span class="linenos"> 703</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr-704"><a href="#Corr-704"><span class="linenos"> 704</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-705"><a href="#Corr-705"><span class="linenos"> 705</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-706"><a href="#Corr-706"><span class="linenos"> 706</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
</span><span id="Corr-707"><a href="#Corr-707"><span class="linenos"> 707</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr-708"><a href="#Corr-708"><span class="linenos"> 708</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;m_eff is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr-709"><a href="#Corr-709"><span class="linenos"> 709</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccosh</span><span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Corr-710"><a href="#Corr-710"><span class="linenos"> 710</span></a>
</span><span id="Corr-711"><a href="#Corr-711"><span class="linenos"> 711</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-712"><a href="#Corr-712"><span class="linenos"> 712</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown variant.&#39;</span><span class="p">)</span>
</span><span id="Corr-713"><a href="#Corr-713"><span class="linenos"> 713</span></a>
</span><span id="Corr-714"><a href="#Corr-714"><span class="linenos"> 714</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">fitrange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr-715"><a href="#Corr-715"><span class="linenos"> 715</span></a>        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Fits function to the data</span>
</span><span id="Corr-716"><a href="#Corr-716"><span class="linenos"> 716</span></a>
</span><span id="Corr-717"><a href="#Corr-717"><span class="linenos"> 717</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-718"><a href="#Corr-718"><span class="linenos"> 718</span></a><span class="sd">        ----------</span>
</span><span id="Corr-719"><a href="#Corr-719"><span class="linenos"> 719</span></a><span class="sd">        function : obj</span>
</span><span id="Corr-720"><a href="#Corr-720"><span class="linenos"> 720</span></a><span class="sd">            function to fit to the data. See fits.least_squares for details.</span>
</span><span id="Corr-721"><a href="#Corr-721"><span class="linenos"> 721</span></a><span class="sd">        fitrange : list</span>
</span><span id="Corr-722"><a href="#Corr-722"><span class="linenos"> 722</span></a><span class="sd">            Two element list containing the timeslices on which the fit is supposed to start and stop.</span>
</span><span id="Corr-723"><a href="#Corr-723"><span class="linenos"> 723</span></a><span class="sd">            Caution: This range is inclusive as opposed to standard python indexing.</span>
</span><span id="Corr-724"><a href="#Corr-724"><span class="linenos"> 724</span></a><span class="sd">            `fitrange=[4, 6]` corresponds to the three entries 4, 5 and 6.</span>
</span><span id="Corr-725"><a href="#Corr-725"><span class="linenos"> 725</span></a><span class="sd">            If not specified, self.prange or all timeslices are used.</span>
</span><span id="Corr-726"><a href="#Corr-726"><span class="linenos"> 726</span></a><span class="sd">        silent : bool</span>
</span><span id="Corr-727"><a href="#Corr-727"><span class="linenos"> 727</span></a><span class="sd">            Decides whether output is printed to the standard output.</span>
</span><span id="Corr-728"><a href="#Corr-728"><span class="linenos"> 728</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Corr-729"><a href="#Corr-729"><span class="linenos"> 729</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-730"><a href="#Corr-730"><span class="linenos"> 730</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator must be projected before fitting&quot;</span><span class="p">)</span>
</span><span id="Corr-731"><a href="#Corr-731"><span class="linenos"> 731</span></a>
</span><span id="Corr-732"><a href="#Corr-732"><span class="linenos"> 732</span></a>        <span class="k">if</span> <span class="n">fitrange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-733"><a href="#Corr-733"><span class="linenos"> 733</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">:</span>
</span><span id="Corr-734"><a href="#Corr-734"><span class="linenos"> 734</span></a>                <span class="n">fitrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span>
</span><span id="Corr-735"><a href="#Corr-735"><span class="linenos"> 735</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-736"><a href="#Corr-736"><span class="linenos"> 736</span></a>                <span class="n">fitrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Corr-737"><a href="#Corr-737"><span class="linenos"> 737</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-738"><a href="#Corr-738"><span class="linenos"> 738</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitrange</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr-739"><a href="#Corr-739"><span class="linenos"> 739</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;fitrange has to be a list with two elements&quot;</span><span class="p">)</span>
</span><span id="Corr-740"><a href="#Corr-740"><span class="linenos"> 740</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Corr-741"><a href="#Corr-741"><span class="linenos"> 741</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;fitrange has to have exactly two elements [fit_start, fit_stop]&quot;</span><span class="p">)</span>
</span><span id="Corr-742"><a href="#Corr-742"><span class="linenos"> 742</span></a>
</span><span id="Corr-743"><a href="#Corr-743"><span class="linenos"> 743</span></a>        <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fitrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fitrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr-744"><a href="#Corr-744"><span class="linenos"> 744</span></a>        <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fitrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fitrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr-745"><a href="#Corr-745"><span class="linenos"> 745</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="n">silent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Corr-746"><a href="#Corr-746"><span class="linenos"> 746</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Corr-747"><a href="#Corr-747"><span class="linenos"> 747</span></a>
</span><span id="Corr-748"><a href="#Corr-748"><span class="linenos"> 748</span></a>    <span class="k">def</span> <span class="nf">plateau</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plateau_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="n">auto_gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Corr-749"><a href="#Corr-749"><span class="linenos"> 749</span></a>        <span class="sd">&quot;&quot;&quot; Extract a plateau value from a Corr object</span>
</span><span id="Corr-750"><a href="#Corr-750"><span class="linenos"> 750</span></a>
</span><span id="Corr-751"><a href="#Corr-751"><span class="linenos"> 751</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-752"><a href="#Corr-752"><span class="linenos"> 752</span></a><span class="sd">        ----------</span>
</span><span id="Corr-753"><a href="#Corr-753"><span class="linenos"> 753</span></a><span class="sd">        plateau_range : list</span>
</span><span id="Corr-754"><a href="#Corr-754"><span class="linenos"> 754</span></a><span class="sd">            list with two entries, indicating the first and the last timeslice</span>
</span><span id="Corr-755"><a href="#Corr-755"><span class="linenos"> 755</span></a><span class="sd">            of the plateau region.</span>
</span><span id="Corr-756"><a href="#Corr-756"><span class="linenos"> 756</span></a><span class="sd">        method : str</span>
</span><span id="Corr-757"><a href="#Corr-757"><span class="linenos"> 757</span></a><span class="sd">            method to extract the plateau.</span>
</span><span id="Corr-758"><a href="#Corr-758"><span class="linenos"> 758</span></a><span class="sd">                &#39;fit&#39; fits a constant to the plateau region</span>
</span><span id="Corr-759"><a href="#Corr-759"><span class="linenos"> 759</span></a><span class="sd">                &#39;avg&#39;, &#39;average&#39; or &#39;mean&#39; just average over the given timeslices.</span>
</span><span id="Corr-760"><a href="#Corr-760"><span class="linenos"> 760</span></a><span class="sd">        auto_gamma : bool</span>
</span><span id="Corr-761"><a href="#Corr-761"><span class="linenos"> 761</span></a><span class="sd">            apply gamma_method with default parameters to the Corr. Defaults to None</span>
</span><span id="Corr-762"><a href="#Corr-762"><span class="linenos"> 762</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-763"><a href="#Corr-763"><span class="linenos"> 763</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plateau_range</span><span class="p">:</span>
</span><span id="Corr-764"><a href="#Corr-764"><span class="linenos"> 764</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">:</span>
</span><span id="Corr-765"><a href="#Corr-765"><span class="linenos"> 765</span></a>                <span class="n">plateau_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span>
</span><span id="Corr-766"><a href="#Corr-766"><span class="linenos"> 766</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-767"><a href="#Corr-767"><span class="linenos"> 767</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;no plateau range provided&quot;</span><span class="p">)</span>
</span><span id="Corr-768"><a href="#Corr-768"><span class="linenos"> 768</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-769"><a href="#Corr-769"><span class="linenos"> 769</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator must be projected before getting a plateau.&quot;</span><span class="p">)</span>
</span><span id="Corr-770"><a href="#Corr-770"><span class="linenos"> 770</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">plateau_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plateau_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])):</span>
</span><span id="Corr-771"><a href="#Corr-771"><span class="linenos"> 771</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;plateau is undefined at all timeslices in plateaurange.&quot;</span><span class="p">)</span>
</span><span id="Corr-772"><a href="#Corr-772"><span class="linenos"> 772</span></a>        <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="Corr-773"><a href="#Corr-773"><span class="linenos"> 773</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr-774"><a href="#Corr-774"><span class="linenos"> 774</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fit&quot;</span><span class="p">:</span>
</span><span id="Corr-775"><a href="#Corr-775"><span class="linenos"> 775</span></a>            <span class="k">def</span> <span class="nf">const_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="Corr-776"><a href="#Corr-776"><span class="linenos"> 776</span></a>                <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr-777"><a href="#Corr-777"><span class="linenos"> 777</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">const_func</span><span class="p">,</span> <span class="n">plateau_range</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr-778"><a href="#Corr-778"><span class="linenos"> 778</span></a>        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">]:</span>
</span><span id="Corr-779"><a href="#Corr-779"><span class="linenos"> 779</span></a>            <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">plateau_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">plateau_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="Corr-780"><a href="#Corr-780"><span class="linenos"> 780</span></a>            <span class="k">return</span> <span class="n">returnvalue</span>
</span><span id="Corr-781"><a href="#Corr-781"><span class="linenos"> 781</span></a>
</span><span id="Corr-782"><a href="#Corr-782"><span class="linenos"> 782</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-783"><a href="#Corr-783"><span class="linenos"> 783</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported plateau method: &quot;</span> <span class="o">+</span> <span class="n">method</span><span class="p">)</span>
</span><span id="Corr-784"><a href="#Corr-784"><span class="linenos"> 784</span></a>
</span><span id="Corr-785"><a href="#Corr-785"><span class="linenos"> 785</span></a>    <span class="k">def</span> <span class="nf">set_prange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prange</span><span class="p">):</span>
</span><span id="Corr-786"><a href="#Corr-786"><span class="linenos"> 786</span></a>        <span class="sd">&quot;&quot;&quot;Sets the attribute prange of the Corr object.&quot;&quot;&quot;</span>
</span><span id="Corr-787"><a href="#Corr-787"><span class="linenos"> 787</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">prange</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Corr-788"><a href="#Corr-788"><span class="linenos"> 788</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;prange must be a list or array with two values&quot;</span><span class="p">)</span>
</span><span id="Corr-789"><a href="#Corr-789"><span class="linenos"> 789</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">))):</span>
</span><span id="Corr-790"><a href="#Corr-790"><span class="linenos"> 790</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Start and end point must be integers&quot;</span><span class="p">)</span>
</span><span id="Corr-791"><a href="#Corr-791"><span class="linenos"> 791</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="ow">and</span> <span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Corr-792"><a href="#Corr-792"><span class="linenos"> 792</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Start and end point must define a range in the interval 0,T&quot;</span><span class="p">)</span>
</span><span id="Corr-793"><a href="#Corr-793"><span class="linenos"> 793</span></a>
</span><span id="Corr-794"><a href="#Corr-794"><span class="linenos"> 794</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prange</span> <span class="o">=</span> <span class="n">prange</span>
</span><span id="Corr-795"><a href="#Corr-795"><span class="linenos"> 795</span></a>        <span class="k">return</span>
</span><span id="Corr-796"><a href="#Corr-796"><span class="linenos"> 796</span></a>
</span><span id="Corr-797"><a href="#Corr-797"><span class="linenos"> 797</span></a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plateau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fit_res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">references</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-798"><a href="#Corr-798"><span class="linenos"> 798</span></a>        <span class="sd">&quot;&quot;&quot;Plots the correlator using the tag of the correlator as label if available.</span>
</span><span id="Corr-799"><a href="#Corr-799"><span class="linenos"> 799</span></a>
</span><span id="Corr-800"><a href="#Corr-800"><span class="linenos"> 800</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-801"><a href="#Corr-801"><span class="linenos"> 801</span></a><span class="sd">        ----------</span>
</span><span id="Corr-802"><a href="#Corr-802"><span class="linenos"> 802</span></a><span class="sd">        x_range : list</span>
</span><span id="Corr-803"><a href="#Corr-803"><span class="linenos"> 803</span></a><span class="sd">            list of two values, determining the range of the x-axis e.g. [4, 8].</span>
</span><span id="Corr-804"><a href="#Corr-804"><span class="linenos"> 804</span></a><span class="sd">        comp : Corr or list of Corr</span>
</span><span id="Corr-805"><a href="#Corr-805"><span class="linenos"> 805</span></a><span class="sd">            Correlator or list of correlators which are plotted for comparison.</span>
</span><span id="Corr-806"><a href="#Corr-806"><span class="linenos"> 806</span></a><span class="sd">            The tags of these correlators are used as labels if available.</span>
</span><span id="Corr-807"><a href="#Corr-807"><span class="linenos"> 807</span></a><span class="sd">        logscale : bool</span>
</span><span id="Corr-808"><a href="#Corr-808"><span class="linenos"> 808</span></a><span class="sd">            Sets y-axis to logscale.</span>
</span><span id="Corr-809"><a href="#Corr-809"><span class="linenos"> 809</span></a><span class="sd">        plateau : Obs</span>
</span><span id="Corr-810"><a href="#Corr-810"><span class="linenos"> 810</span></a><span class="sd">            Plateau value to be visualized in the figure.</span>
</span><span id="Corr-811"><a href="#Corr-811"><span class="linenos"> 811</span></a><span class="sd">        fit_res : Fit_result</span>
</span><span id="Corr-812"><a href="#Corr-812"><span class="linenos"> 812</span></a><span class="sd">            Fit_result object to be visualized.</span>
</span><span id="Corr-813"><a href="#Corr-813"><span class="linenos"> 813</span></a><span class="sd">        ylabel : str</span>
</span><span id="Corr-814"><a href="#Corr-814"><span class="linenos"> 814</span></a><span class="sd">            Label for the y-axis.</span>
</span><span id="Corr-815"><a href="#Corr-815"><span class="linenos"> 815</span></a><span class="sd">        save : str</span>
</span><span id="Corr-816"><a href="#Corr-816"><span class="linenos"> 816</span></a><span class="sd">            path to file in which the figure should be saved.</span>
</span><span id="Corr-817"><a href="#Corr-817"><span class="linenos"> 817</span></a><span class="sd">        auto_gamma : bool</span>
</span><span id="Corr-818"><a href="#Corr-818"><span class="linenos"> 818</span></a><span class="sd">            Apply the gamma method with standard parameters to all correlators and plateau values before plotting.</span>
</span><span id="Corr-819"><a href="#Corr-819"><span class="linenos"> 819</span></a><span class="sd">        hide_sigma : float</span>
</span><span id="Corr-820"><a href="#Corr-820"><span class="linenos"> 820</span></a><span class="sd">            Hides data points from the first value on which is consistent with zero within &#39;hide_sigma&#39; standard errors.</span>
</span><span id="Corr-821"><a href="#Corr-821"><span class="linenos"> 821</span></a><span class="sd">        references : list</span>
</span><span id="Corr-822"><a href="#Corr-822"><span class="linenos"> 822</span></a><span class="sd">            List of floating point values that are displayed as horizontal lines for reference.</span>
</span><span id="Corr-823"><a href="#Corr-823"><span class="linenos"> 823</span></a><span class="sd">        title : string</span>
</span><span id="Corr-824"><a href="#Corr-824"><span class="linenos"> 824</span></a><span class="sd">            Optional title of the figure.</span>
</span><span id="Corr-825"><a href="#Corr-825"><span class="linenos"> 825</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-826"><a href="#Corr-826"><span class="linenos"> 826</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-827"><a href="#Corr-827"><span class="linenos"> 827</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator must be projected before plotting&quot;</span><span class="p">)</span>
</span><span id="Corr-828"><a href="#Corr-828"><span class="linenos"> 828</span></a>
</span><span id="Corr-829"><a href="#Corr-829"><span class="linenos"> 829</span></a>        <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="Corr-830"><a href="#Corr-830"><span class="linenos"> 830</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr-831"><a href="#Corr-831"><span class="linenos"> 831</span></a>
</span><span id="Corr-832"><a href="#Corr-832"><span class="linenos"> 832</span></a>        <span class="k">if</span> <span class="n">x_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-833"><a href="#Corr-833"><span class="linenos"> 833</span></a>            <span class="n">x_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Corr-834"><a href="#Corr-834"><span class="linenos"> 834</span></a>
</span><span id="Corr-835"><a href="#Corr-835"><span class="linenos"> 835</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Corr-836"><a href="#Corr-836"><span class="linenos"> 836</span></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="Corr-837"><a href="#Corr-837"><span class="linenos"> 837</span></a>
</span><span id="Corr-838"><a href="#Corr-838"><span class="linenos"> 838</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottable</span><span class="p">()</span>
</span><span id="Corr-839"><a href="#Corr-839"><span class="linenos"> 839</span></a>        <span class="k">if</span> <span class="n">hide_sigma</span><span class="p">:</span>
</span><span id="Corr-840"><a href="#Corr-840"><span class="linenos"> 840</span></a>            <span class="n">hide_from</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">((</span><span class="n">hide_sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_err</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Corr-841"><a href="#Corr-841"><span class="linenos"> 841</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-842"><a href="#Corr-842"><span class="linenos"> 842</span></a>            <span class="n">hide_from</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr-843"><a href="#Corr-843"><span class="linenos"> 843</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
</span><span id="Corr-844"><a href="#Corr-844"><span class="linenos"> 844</span></a>        <span class="k">if</span> <span class="n">logscale</span><span class="p">:</span>
</span><span id="Corr-845"><a href="#Corr-845"><span class="linenos"> 845</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span><span id="Corr-846"><a href="#Corr-846"><span class="linenos"> 846</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-847"><a href="#Corr-847"><span class="linenos"> 847</span></a>            <span class="k">if</span> <span class="n">y_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-848"><a href="#Corr-848"><span class="linenos"> 848</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Corr-849"><a href="#Corr-849"><span class="linenos"> 849</span></a>                    <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span>
</span><span id="Corr-850"><a href="#Corr-850"><span class="linenos"> 850</span></a>                    <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span>
</span><span id="Corr-851"><a href="#Corr-851"><span class="linenos"> 851</span></a>                    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">y_min</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">),</span> <span class="n">y_max</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)])</span>
</span><span id="Corr-852"><a href="#Corr-852"><span class="linenos"> 852</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="Corr-853"><a href="#Corr-853"><span class="linenos"> 853</span></a>                    <span class="k">pass</span>
</span><span id="Corr-854"><a href="#Corr-854"><span class="linenos"> 854</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-855"><a href="#Corr-855"><span class="linenos"> 855</span></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_range</span><span class="p">)</span>
</span><span id="Corr-856"><a href="#Corr-856"><span class="linenos"> 856</span></a>        <span class="k">if</span> <span class="n">comp</span><span class="p">:</span>
</span><span id="Corr-857"><a href="#Corr-857"><span class="linenos"> 857</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="p">(</span><span class="n">Corr</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="Corr-858"><a href="#Corr-858"><span class="linenos"> 858</span></a>                <span class="k">for</span> <span class="n">corr</span> <span class="ow">in</span> <span class="n">comp</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">comp</span><span class="p">]:</span>
</span><span id="Corr-859"><a href="#Corr-859"><span class="linenos"> 859</span></a>                    <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="Corr-860"><a href="#Corr-860"><span class="linenos"> 860</span></a>                        <span class="n">corr</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr-861"><a href="#Corr-861"><span class="linenos"> 861</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_err</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">plottable</span><span class="p">()</span>
</span><span id="Corr-862"><a href="#Corr-862"><span class="linenos"> 862</span></a>                    <span class="k">if</span> <span class="n">hide_sigma</span><span class="p">:</span>
</span><span id="Corr-863"><a href="#Corr-863"><span class="linenos"> 863</span></a>                        <span class="n">hide_from</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">((</span><span class="n">hide_sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_err</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Corr-864"><a href="#Corr-864"><span class="linenos"> 864</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-865"><a href="#Corr-865"><span class="linenos"> 865</span></a>                        <span class="n">hide_from</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr-866"><a href="#Corr-866"><span class="linenos"> 866</span></a>                    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">corr</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">])</span>
</span><span id="Corr-867"><a href="#Corr-867"><span class="linenos"> 867</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-868"><a href="#Corr-868"><span class="linenos"> 868</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;comp&#39; must be a correlator or a list of correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr-869"><a href="#Corr-869"><span class="linenos"> 869</span></a>
</span><span id="Corr-870"><a href="#Corr-870"><span class="linenos"> 870</span></a>        <span class="k">if</span> <span class="n">plateau</span><span class="p">:</span>
</span><span id="Corr-871"><a href="#Corr-871"><span class="linenos"> 871</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plateau</span><span class="p">,</span> <span class="n">Obs</span><span class="p">):</span>
</span><span id="Corr-872"><a href="#Corr-872"><span class="linenos"> 872</span></a>                <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="Corr-873"><a href="#Corr-873"><span class="linenos"> 873</span></a>                    <span class="n">plateau</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr-874"><a href="#Corr-874"><span class="linenos"> 874</span></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">plateau</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">plateau</span><span class="p">))</span>
</span><span id="Corr-875"><a href="#Corr-875"><span class="linenos"> 875</span></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">axhspan</span><span class="p">(</span><span class="n">plateau</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">plateau</span><span class="o">.</span><span class="n">dvalue</span><span class="p">,</span> <span class="n">plateau</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">plateau</span><span class="o">.</span><span class="n">dvalue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="Corr-876"><a href="#Corr-876"><span class="linenos"> 876</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-877"><a href="#Corr-877"><span class="linenos"> 877</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;plateau&#39; must be an Obs&quot;</span><span class="p">)</span>
</span><span id="Corr-878"><a href="#Corr-878"><span class="linenos"> 878</span></a>
</span><span id="Corr-879"><a href="#Corr-879"><span class="linenos"> 879</span></a>        <span class="k">if</span> <span class="n">references</span><span class="p">:</span>
</span><span id="Corr-880"><a href="#Corr-880"><span class="linenos"> 880</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">references</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr-881"><a href="#Corr-881"><span class="linenos"> 881</span></a>                <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">references</span><span class="p">:</span>
</span><span id="Corr-882"><a href="#Corr-882"><span class="linenos"> 882</span></a>                    <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
</span><span id="Corr-883"><a href="#Corr-883"><span class="linenos"> 883</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-884"><a href="#Corr-884"><span class="linenos"> 884</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;references&#39; must be a list of floating pint values.&quot;</span><span class="p">)</span>
</span><span id="Corr-885"><a href="#Corr-885"><span class="linenos"> 885</span></a>
</span><span id="Corr-886"><a href="#Corr-886"><span class="linenos"> 886</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">:</span>
</span><span id="Corr-887"><a href="#Corr-887"><span class="linenos"> 887</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="Corr-888"><a href="#Corr-888"><span class="linenos"> 888</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="Corr-889"><a href="#Corr-889"><span class="linenos"> 889</span></a>
</span><span id="Corr-890"><a href="#Corr-890"><span class="linenos"> 890</span></a>        <span class="k">if</span> <span class="n">fit_res</span><span class="p">:</span>
</span><span id="Corr-891"><a href="#Corr-891"><span class="linenos"> 891</span></a>            <span class="n">x_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
</span><span id="Corr-892"><a href="#Corr-892"><span class="linenos"> 892</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_samples</span><span class="p">,</span>
</span><span id="Corr-893"><a href="#Corr-893"><span class="linenos"> 893</span></a>                     <span class="n">fit_res</span><span class="o">.</span><span class="n">fit_function</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">fit_res</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">],</span> <span class="n">x_samples</span><span class="p">),</span>
</span><span id="Corr-894"><a href="#Corr-894"><span class="linenos"> 894</span></a>                     <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Corr-895"><a href="#Corr-895"><span class="linenos"> 895</span></a>
</span><span id="Corr-896"><a href="#Corr-896"><span class="linenos"> 896</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x_0 / a$&#39;</span><span class="p">)</span>
</span><span id="Corr-897"><a href="#Corr-897"><span class="linenos"> 897</span></a>        <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
</span><span id="Corr-898"><a href="#Corr-898"><span class="linenos"> 898</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
</span><span id="Corr-899"><a href="#Corr-899"><span class="linenos"> 899</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">])</span>
</span><span id="Corr-900"><a href="#Corr-900"><span class="linenos"> 900</span></a>
</span><span id="Corr-901"><a href="#Corr-901"><span class="linenos"> 901</span></a>        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="Corr-902"><a href="#Corr-902"><span class="linenos"> 902</span></a>        <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
</span><span id="Corr-903"><a href="#Corr-903"><span class="linenos"> 903</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="Corr-904"><a href="#Corr-904"><span class="linenos"> 904</span></a>
</span><span id="Corr-905"><a href="#Corr-905"><span class="linenos"> 905</span></a>        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><span id="Corr-906"><a href="#Corr-906"><span class="linenos"> 906</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="Corr-907"><a href="#Corr-907"><span class="linenos"> 907</span></a>
</span><span id="Corr-908"><a href="#Corr-908"><span class="linenos"> 908</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="Corr-909"><a href="#Corr-909"><span class="linenos"> 909</span></a>
</span><span id="Corr-910"><a href="#Corr-910"><span class="linenos"> 910</span></a>        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="Corr-911"><a href="#Corr-911"><span class="linenos"> 911</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Corr-912"><a href="#Corr-912"><span class="linenos"> 912</span></a>                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span><span id="Corr-913"><a href="#Corr-913"><span class="linenos"> 913</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-914"><a href="#Corr-914"><span class="linenos"> 914</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;save&#39; has to be a string.&quot;</span><span class="p">)</span>
</span><span id="Corr-915"><a href="#Corr-915"><span class="linenos"> 915</span></a>
</span><span id="Corr-916"><a href="#Corr-916"><span class="linenos"> 916</span></a>    <span class="k">def</span> <span class="nf">spaghetti_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Corr-917"><a href="#Corr-917"><span class="linenos"> 917</span></a>        <span class="sd">&quot;&quot;&quot;Produces a spaghetti plot of the correlator suited to monitor exceptional configurations.</span>
</span><span id="Corr-918"><a href="#Corr-918"><span class="linenos"> 918</span></a>
</span><span id="Corr-919"><a href="#Corr-919"><span class="linenos"> 919</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-920"><a href="#Corr-920"><span class="linenos"> 920</span></a><span class="sd">        ----------</span>
</span><span id="Corr-921"><a href="#Corr-921"><span class="linenos"> 921</span></a><span class="sd">        logscale : bool</span>
</span><span id="Corr-922"><a href="#Corr-922"><span class="linenos"> 922</span></a><span class="sd">            Determines whether the scale of the y-axis is logarithmic or standard.</span>
</span><span id="Corr-923"><a href="#Corr-923"><span class="linenos"> 923</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-924"><a href="#Corr-924"><span class="linenos"> 924</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-925"><a href="#Corr-925"><span class="linenos"> 925</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator needs to be projected first.&quot;</span><span class="p">)</span>
</span><span id="Corr-926"><a href="#Corr-926"><span class="linenos"> 926</span></a>
</span><span id="Corr-927"><a href="#Corr-927"><span class="linenos"> 927</span></a>        <span class="n">mc_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mc_names</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]))</span>
</span><span id="Corr-928"><a href="#Corr-928"><span class="linenos"> 928</span></a>        <span class="n">x0_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr-929"><a href="#Corr-929"><span class="linenos"> 929</span></a>
</span><span id="Corr-930"><a href="#Corr-930"><span class="linenos"> 930</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">mc_names</span><span class="p">:</span>
</span><span id="Corr-931"><a href="#Corr-931"><span class="linenos"> 931</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">r_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr-932"><a href="#Corr-932"><span class="linenos"> 932</span></a>
</span><span id="Corr-933"><a href="#Corr-933"><span class="linenos"> 933</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Corr-934"><a href="#Corr-934"><span class="linenos"> 934</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="Corr-935"><a href="#Corr-935"><span class="linenos"> 935</span></a>            <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="Corr-936"><a href="#Corr-936"><span class="linenos"> 936</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0_vals</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Corr-937"><a href="#Corr-937"><span class="linenos"> 937</span></a>
</span><span id="Corr-938"><a href="#Corr-938"><span class="linenos"> 938</span></a>            <span class="k">if</span> <span class="n">logscale</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Corr-939"><a href="#Corr-939"><span class="linenos"> 939</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span><span id="Corr-940"><a href="#Corr-940"><span class="linenos"> 940</span></a>
</span><span id="Corr-941"><a href="#Corr-941"><span class="linenos"> 941</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x_0 / a$&#39;</span><span class="p">)</span>
</span><span id="Corr-942"><a href="#Corr-942"><span class="linenos"> 942</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Corr-943"><a href="#Corr-943"><span class="linenos"> 943</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="Corr-944"><a href="#Corr-944"><span class="linenos"> 944</span></a>
</span><span id="Corr-945"><a href="#Corr-945"><span class="linenos"> 945</span></a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;json.gz&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr-946"><a href="#Corr-946"><span class="linenos"> 946</span></a>        <span class="sd">&quot;&quot;&quot;Dumps the Corr into a file of chosen type</span>
</span><span id="Corr-947"><a href="#Corr-947"><span class="linenos"> 947</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-948"><a href="#Corr-948"><span class="linenos"> 948</span></a><span class="sd">        ----------</span>
</span><span id="Corr-949"><a href="#Corr-949"><span class="linenos"> 949</span></a><span class="sd">        filename : str</span>
</span><span id="Corr-950"><a href="#Corr-950"><span class="linenos"> 950</span></a><span class="sd">            Name of the file to be saved.</span>
</span><span id="Corr-951"><a href="#Corr-951"><span class="linenos"> 951</span></a><span class="sd">        datatype : str</span>
</span><span id="Corr-952"><a href="#Corr-952"><span class="linenos"> 952</span></a><span class="sd">            Format of the exported file. Supported formats include</span>
</span><span id="Corr-953"><a href="#Corr-953"><span class="linenos"> 953</span></a><span class="sd">            &quot;json.gz&quot; and &quot;pickle&quot;</span>
</span><span id="Corr-954"><a href="#Corr-954"><span class="linenos"> 954</span></a><span class="sd">        path : str</span>
</span><span id="Corr-955"><a href="#Corr-955"><span class="linenos"> 955</span></a><span class="sd">            specifies a custom path for the file (default &#39;.&#39;)</span>
</span><span id="Corr-956"><a href="#Corr-956"><span class="linenos"> 956</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr-957"><a href="#Corr-957"><span class="linenos"> 957</span></a>        <span class="k">if</span> <span class="n">datatype</span> <span class="o">==</span> <span class="s2">&quot;json.gz&quot;</span><span class="p">:</span>
</span><span id="Corr-958"><a href="#Corr-958"><span class="linenos"> 958</span></a>            <span class="kn">from</span> <span class="nn">.input.json</span> <span class="kn">import</span> <span class="n">dump_to_json</span>
</span><span id="Corr-959"><a href="#Corr-959"><span class="linenos"> 959</span></a>            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Corr-960"><a href="#Corr-960"><span class="linenos"> 960</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
</span><span id="Corr-961"><a href="#Corr-961"><span class="linenos"> 961</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-962"><a href="#Corr-962"><span class="linenos"> 962</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="Corr-963"><a href="#Corr-963"><span class="linenos"> 963</span></a>            <span class="n">dump_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="Corr-964"><a href="#Corr-964"><span class="linenos"> 964</span></a>        <span class="k">elif</span> <span class="n">datatype</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
</span><span id="Corr-965"><a href="#Corr-965"><span class="linenos"> 965</span></a>            <span class="n">dump_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Corr-966"><a href="#Corr-966"><span class="linenos"> 966</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-967"><a href="#Corr-967"><span class="linenos"> 967</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown datatype &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datatype</span><span class="p">))</span>
</span><span id="Corr-968"><a href="#Corr-968"><span class="linenos"> 968</span></a>
</span><span id="Corr-969"><a href="#Corr-969"><span class="linenos"> 969</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-970"><a href="#Corr-970"><span class="linenos"> 970</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="n">print_range</span><span class="p">))</span>
</span><span id="Corr-971"><a href="#Corr-971"><span class="linenos"> 971</span></a>
</span><span id="Corr-972"><a href="#Corr-972"><span class="linenos"> 972</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-973"><a href="#Corr-973"><span class="linenos"> 973</span></a>        <span class="k">if</span> <span class="n">print_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-974"><a href="#Corr-974"><span class="linenos"> 974</span></a>            <span class="n">print_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr-975"><a href="#Corr-975"><span class="linenos"> 975</span></a>
</span><span id="Corr-976"><a href="#Corr-976"><span class="linenos"> 976</span></a>        <span class="n">content_string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="Corr-977"><a href="#Corr-977"><span class="linenos"> 977</span></a>        <span class="n">content_string</span> <span class="o">+=</span> <span class="s2">&quot;Corr T=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; N=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>  <span class="c1"># +&quot; filled with&quot;+ str(type(self.content[0][0])) there should be a good solution here</span>
</span><span id="Corr-978"><a href="#Corr-978"><span class="linenos"> 978</span></a>
</span><span id="Corr-979"><a href="#Corr-979"><span class="linenos"> 979</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-980"><a href="#Corr-980"><span class="linenos"> 980</span></a>            <span class="n">content_string</span> <span class="o">+=</span> <span class="s2">&quot;Description: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="Corr-981"><a href="#Corr-981"><span class="linenos"> 981</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-982"><a href="#Corr-982"><span class="linenos"> 982</span></a>            <span class="k">return</span> <span class="n">content_string</span>
</span><span id="Corr-983"><a href="#Corr-983"><span class="linenos"> 983</span></a>
</span><span id="Corr-984"><a href="#Corr-984"><span class="linenos"> 984</span></a>        <span class="k">if</span> <span class="n">print_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Corr-985"><a href="#Corr-985"><span class="linenos"> 985</span></a>            <span class="n">print_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="Corr-986"><a href="#Corr-986"><span class="linenos"> 986</span></a>        <span class="n">content_string</span> <span class="o">+=</span> <span class="s1">&#39;x0/a</span><span class="se">\t</span><span class="s1">Corr(x0/a)</span><span class="se">\n</span><span class="s1">------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Corr-987"><a href="#Corr-987"><span class="linenos"> 987</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sub_corr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">print_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">print_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]]):</span>
</span><span id="Corr-988"><a href="#Corr-988"><span class="linenos"> 988</span></a>            <span class="k">if</span> <span class="n">sub_corr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-989"><a href="#Corr-989"><span class="linenos"> 989</span></a>                <span class="n">content_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">print_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Corr-990"><a href="#Corr-990"><span class="linenos"> 990</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-991"><a href="#Corr-991"><span class="linenos"> 991</span></a>                <span class="n">content_string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">print_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Corr-992"><a href="#Corr-992"><span class="linenos"> 992</span></a>                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">sub_corr</span><span class="p">:</span>
</span><span id="Corr-993"><a href="#Corr-993"><span class="linenos"> 993</span></a>                    <span class="n">content_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">element</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
</span><span id="Corr-994"><a href="#Corr-994"><span class="linenos"> 994</span></a>                <span class="n">content_string</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
</span><span id="Corr-995"><a href="#Corr-995"><span class="linenos"> 995</span></a>        <span class="k">return</span> <span class="n">content_string</span>
</span><span id="Corr-996"><a href="#Corr-996"><span class="linenos"> 996</span></a>
</span><span id="Corr-997"><a href="#Corr-997"><span class="linenos"> 997</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-998"><a href="#Corr-998"><span class="linenos"> 998</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
</span><span id="Corr-999"><a href="#Corr-999"><span class="linenos"> 999</span></a>
</span><span id="Corr-1000"><a href="#Corr-1000"><span class="linenos">1000</span></a>    <span class="c1"># We define the basic operations, that can be performed with correlators.</span>
</span><span id="Corr-1001"><a href="#Corr-1001"><span class="linenos">1001</span></a>    <span class="c1"># While */+- get defined here, they only work for Corr*Obs and not Obs*Corr.</span>
</span><span id="Corr-1002"><a href="#Corr-1002"><span class="linenos">1002</span></a>    <span class="c1"># This is because Obs*Corr checks Obs.__mul__ first and does not catch an exception.</span>
</span><span id="Corr-1003"><a href="#Corr-1003"><span class="linenos">1003</span></a>    <span class="c1"># One could try and tell Obs to check if the y in __mul__ is a Corr and</span>
</span><span id="Corr-1004"><a href="#Corr-1004"><span class="linenos">1004</span></a>
</span><span id="Corr-1005"><a href="#Corr-1005"><span class="linenos">1005</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="Corr-1006"><a href="#Corr-1006"><span class="linenos">1006</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="Corr-1007"><a href="#Corr-1007"><span class="linenos">1007</span></a>            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>
</span><span id="Corr-1008"><a href="#Corr-1008"><span class="linenos">1008</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Addition of Corrs with different shape&quot;</span><span class="p">)</span>
</span><span id="Corr-1009"><a href="#Corr-1009"><span class="linenos">1009</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-1010"><a href="#Corr-1010"><span class="linenos">1010</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1011"><a href="#Corr-1011"><span class="linenos">1011</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">or</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="Corr-1012"><a href="#Corr-1012"><span class="linenos">1012</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-1013"><a href="#Corr-1013"><span class="linenos">1013</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1014"><a href="#Corr-1014"><span class="linenos">1014</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="Corr-1015"><a href="#Corr-1015"><span class="linenos">1015</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr-1016"><a href="#Corr-1016"><span class="linenos">1016</span></a>
</span><span id="Corr-1017"><a href="#Corr-1017"><span class="linenos">1017</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">CObs</span><span class="p">)):</span>
</span><span id="Corr-1018"><a href="#Corr-1018"><span class="linenos">1018</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-1019"><a href="#Corr-1019"><span class="linenos">1019</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1020"><a href="#Corr-1020"><span class="linenos">1020</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="Corr-1021"><a href="#Corr-1021"><span class="linenos">1021</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-1022"><a href="#Corr-1022"><span class="linenos">1022</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1023"><a href="#Corr-1023"><span class="linenos">1023</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
</span><span id="Corr-1024"><a href="#Corr-1024"><span class="linenos">1024</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-1025"><a href="#Corr-1025"><span class="linenos">1025</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Corr-1026"><a href="#Corr-1026"><span class="linenos">1026</span></a>            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,):</span>
</span><span id="Corr-1027"><a href="#Corr-1027"><span class="linenos">1027</span></a>                <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
</span><span id="Corr-1028"><a href="#Corr-1028"><span class="linenos">1028</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1029"><a href="#Corr-1029"><span class="linenos">1029</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;operands could not be broadcast together&quot;</span><span class="p">)</span>
</span><span id="Corr-1030"><a href="#Corr-1030"><span class="linenos">1030</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1031"><a href="#Corr-1031"><span class="linenos">1031</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Corr + wrong type&quot;</span><span class="p">)</span>
</span><span id="Corr-1032"><a href="#Corr-1032"><span class="linenos">1032</span></a>
</span><span id="Corr-1033"><a href="#Corr-1033"><span class="linenos">1033</span></a>    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="Corr-1034"><a href="#Corr-1034"><span class="linenos">1034</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="Corr-1035"><a href="#Corr-1035"><span class="linenos">1035</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1036"><a href="#Corr-1036"><span class="linenos">1036</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multiplication of Corr object requires N=N or N=1 and T=T&quot;</span><span class="p">)</span>
</span><span id="Corr-1037"><a href="#Corr-1037"><span class="linenos">1037</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-1038"><a href="#Corr-1038"><span class="linenos">1038</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1039"><a href="#Corr-1039"><span class="linenos">1039</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">or</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="Corr-1040"><a href="#Corr-1040"><span class="linenos">1040</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-1041"><a href="#Corr-1041"><span class="linenos">1041</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1042"><a href="#Corr-1042"><span class="linenos">1042</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="Corr-1043"><a href="#Corr-1043"><span class="linenos">1043</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr-1044"><a href="#Corr-1044"><span class="linenos">1044</span></a>
</span><span id="Corr-1045"><a href="#Corr-1045"><span class="linenos">1045</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">CObs</span><span class="p">)):</span>
</span><span id="Corr-1046"><a href="#Corr-1046"><span class="linenos">1046</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-1047"><a href="#Corr-1047"><span class="linenos">1047</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1048"><a href="#Corr-1048"><span class="linenos">1048</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="Corr-1049"><a href="#Corr-1049"><span class="linenos">1049</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-1050"><a href="#Corr-1050"><span class="linenos">1050</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1051"><a href="#Corr-1051"><span class="linenos">1051</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
</span><span id="Corr-1052"><a href="#Corr-1052"><span class="linenos">1052</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-1053"><a href="#Corr-1053"><span class="linenos">1053</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Corr-1054"><a href="#Corr-1054"><span class="linenos">1054</span></a>            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,):</span>
</span><span id="Corr-1055"><a href="#Corr-1055"><span class="linenos">1055</span></a>                <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
</span><span id="Corr-1056"><a href="#Corr-1056"><span class="linenos">1056</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1057"><a href="#Corr-1057"><span class="linenos">1057</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;operands could not be broadcast together&quot;</span><span class="p">)</span>
</span><span id="Corr-1058"><a href="#Corr-1058"><span class="linenos">1058</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1059"><a href="#Corr-1059"><span class="linenos">1059</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Corr * wrong type&quot;</span><span class="p">)</span>
</span><span id="Corr-1060"><a href="#Corr-1060"><span class="linenos">1060</span></a>
</span><span id="Corr-1061"><a href="#Corr-1061"><span class="linenos">1061</span></a>    <span class="k">def</span> <span class="fm">__truediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="Corr-1062"><a href="#Corr-1062"><span class="linenos">1062</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="Corr-1063"><a href="#Corr-1063"><span class="linenos">1063</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">==</span> <span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1064"><a href="#Corr-1064"><span class="linenos">1064</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multiplication of Corr object requires N=N or N=1 and T=T&quot;</span><span class="p">)</span>
</span><span id="Corr-1065"><a href="#Corr-1065"><span class="linenos">1065</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-1066"><a href="#Corr-1066"><span class="linenos">1066</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1067"><a href="#Corr-1067"><span class="linenos">1067</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">or</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="Corr-1068"><a href="#Corr-1068"><span class="linenos">1068</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-1069"><a href="#Corr-1069"><span class="linenos">1069</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1070"><a href="#Corr-1070"><span class="linenos">1070</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">y</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="Corr-1071"><a href="#Corr-1071"><span class="linenos">1071</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1072"><a href="#Corr-1072"><span class="linenos">1072</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="Corr-1073"><a href="#Corr-1073"><span class="linenos">1073</span></a>                    <span class="k">continue</span>
</span><span id="Corr-1074"><a href="#Corr-1074"><span class="linenos">1074</span></a>                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
</span><span id="Corr-1075"><a href="#Corr-1075"><span class="linenos">1075</span></a>                    <span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr-1076"><a href="#Corr-1076"><span class="linenos">1076</span></a>
</span><span id="Corr-1077"><a href="#Corr-1077"><span class="linenos">1077</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">]):</span>
</span><span id="Corr-1078"><a href="#Corr-1078"><span class="linenos">1078</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Division returns completely undefined correlator&quot;</span><span class="p">)</span>
</span><span id="Corr-1079"><a href="#Corr-1079"><span class="linenos">1079</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr-1080"><a href="#Corr-1080"><span class="linenos">1080</span></a>
</span><span id="Corr-1081"><a href="#Corr-1081"><span class="linenos">1081</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">)):</span>
</span><span id="Corr-1082"><a href="#Corr-1082"><span class="linenos">1082</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">Obs</span><span class="p">):</span>
</span><span id="Corr-1083"><a href="#Corr-1083"><span class="linenos">1083</span></a>                <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr-1084"><a href="#Corr-1084"><span class="linenos">1084</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Division by zero will return undefined correlator&#39;</span><span class="p">)</span>
</span><span id="Corr-1085"><a href="#Corr-1085"><span class="linenos">1085</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">CObs</span><span class="p">):</span>
</span><span id="Corr-1086"><a href="#Corr-1086"><span class="linenos">1086</span></a>                <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">is_zero</span><span class="p">():</span>
</span><span id="Corr-1087"><a href="#Corr-1087"><span class="linenos">1087</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Division by zero will return undefined correlator&#39;</span><span class="p">)</span>
</span><span id="Corr-1088"><a href="#Corr-1088"><span class="linenos">1088</span></a>
</span><span id="Corr-1089"><a href="#Corr-1089"><span class="linenos">1089</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-1090"><a href="#Corr-1090"><span class="linenos">1090</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1091"><a href="#Corr-1091"><span class="linenos">1091</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="Corr-1092"><a href="#Corr-1092"><span class="linenos">1092</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-1093"><a href="#Corr-1093"><span class="linenos">1093</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1094"><a href="#Corr-1094"><span class="linenos">1094</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span>
</span><span id="Corr-1095"><a href="#Corr-1095"><span class="linenos">1095</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-1096"><a href="#Corr-1096"><span class="linenos">1096</span></a>
</span><span id="Corr-1097"><a href="#Corr-1097"><span class="linenos">1097</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
</span><span id="Corr-1098"><a href="#Corr-1098"><span class="linenos">1098</span></a>            <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr-1099"><a href="#Corr-1099"><span class="linenos">1099</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Division by zero will return undefined correlator&#39;</span><span class="p">)</span>
</span><span id="Corr-1100"><a href="#Corr-1100"><span class="linenos">1100</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-1101"><a href="#Corr-1101"><span class="linenos">1101</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1102"><a href="#Corr-1102"><span class="linenos">1102</span></a>                <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="Corr-1103"><a href="#Corr-1103"><span class="linenos">1103</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr-1104"><a href="#Corr-1104"><span class="linenos">1104</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1105"><a href="#Corr-1105"><span class="linenos">1105</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span>
</span><span id="Corr-1106"><a href="#Corr-1106"><span class="linenos">1106</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-1107"><a href="#Corr-1107"><span class="linenos">1107</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Corr-1108"><a href="#Corr-1108"><span class="linenos">1108</span></a>            <span class="k">if</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,):</span>
</span><span id="Corr-1109"><a href="#Corr-1109"><span class="linenos">1109</span></a>                <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="nb">list</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
</span><span id="Corr-1110"><a href="#Corr-1110"><span class="linenos">1110</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1111"><a href="#Corr-1111"><span class="linenos">1111</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;operands could not be broadcast together&quot;</span><span class="p">)</span>
</span><span id="Corr-1112"><a href="#Corr-1112"><span class="linenos">1112</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1113"><a href="#Corr-1113"><span class="linenos">1113</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Corr / wrong type&#39;</span><span class="p">)</span>
</span><span id="Corr-1114"><a href="#Corr-1114"><span class="linenos">1114</span></a>
</span><span id="Corr-1115"><a href="#Corr-1115"><span class="linenos">1115</span></a>    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1116"><a href="#Corr-1116"><span class="linenos">1116</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="o">-</span><span class="mf">1.</span> <span class="o">*</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr-1117"><a href="#Corr-1117"><span class="linenos">1117</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-1118"><a href="#Corr-1118"><span class="linenos">1118</span></a>
</span><span id="Corr-1119"><a href="#Corr-1119"><span class="linenos">1119</span></a>    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="Corr-1120"><a href="#Corr-1120"><span class="linenos">1120</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>
</span><span id="Corr-1121"><a href="#Corr-1121"><span class="linenos">1121</span></a>
</span><span id="Corr-1122"><a href="#Corr-1122"><span class="linenos">1122</span></a>    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="Corr-1123"><a href="#Corr-1123"><span class="linenos">1123</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">CObs</span><span class="p">)):</span>
</span><span id="Corr-1124"><a href="#Corr-1124"><span class="linenos">1124</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span><span class="o">**</span><span class="n">y</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr-1125"><a href="#Corr-1125"><span class="linenos">1125</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-1126"><a href="#Corr-1126"><span class="linenos">1126</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1127"><a href="#Corr-1127"><span class="linenos">1127</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Type of exponent not supported&#39;</span><span class="p">)</span>
</span><span id="Corr-1128"><a href="#Corr-1128"><span class="linenos">1128</span></a>
</span><span id="Corr-1129"><a href="#Corr-1129"><span class="linenos">1129</span></a>    <span class="k">def</span> <span class="fm">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1130"><a href="#Corr-1130"><span class="linenos">1130</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr-1131"><a href="#Corr-1131"><span class="linenos">1131</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-1132"><a href="#Corr-1132"><span class="linenos">1132</span></a>
</span><span id="Corr-1133"><a href="#Corr-1133"><span class="linenos">1133</span></a>    <span class="c1"># The numpy functions:</span>
</span><span id="Corr-1134"><a href="#Corr-1134"><span class="linenos">1134</span></a>    <span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1135"><a href="#Corr-1135"><span class="linenos">1135</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">**</span> <span class="mf">0.5</span>
</span><span id="Corr-1136"><a href="#Corr-1136"><span class="linenos">1136</span></a>
</span><span id="Corr-1137"><a href="#Corr-1137"><span class="linenos">1137</span></a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1138"><a href="#Corr-1138"><span class="linenos">1138</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr-1139"><a href="#Corr-1139"><span class="linenos">1139</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-1140"><a href="#Corr-1140"><span class="linenos">1140</span></a>
</span><span id="Corr-1141"><a href="#Corr-1141"><span class="linenos">1141</span></a>    <span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1142"><a href="#Corr-1142"><span class="linenos">1142</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr-1143"><a href="#Corr-1143"><span class="linenos">1143</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span><span id="Corr-1144"><a href="#Corr-1144"><span class="linenos">1144</span></a>
</span><span id="Corr-1145"><a href="#Corr-1145"><span class="linenos">1145</span></a>    <span class="k">def</span> <span class="nf">_apply_func_to_corr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
</span><span id="Corr-1146"><a href="#Corr-1146"><span class="linenos">1146</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">func</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr-1147"><a href="#Corr-1147"><span class="linenos">1147</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1148"><a href="#Corr-1148"><span class="linenos">1148</span></a>            <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">]):</span>
</span><span id="Corr-1149"><a href="#Corr-1149"><span class="linenos">1149</span></a>                <span class="k">continue</span>
</span><span id="Corr-1150"><a href="#Corr-1150"><span class="linenos">1150</span></a>            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
</span><span id="Corr-1151"><a href="#Corr-1151"><span class="linenos">1151</span></a>                <span class="n">newcontent</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr-1152"><a href="#Corr-1152"><span class="linenos">1152</span></a>        <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">]):</span>
</span><span id="Corr-1153"><a href="#Corr-1153"><span class="linenos">1153</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Operation returns undefined correlator&#39;</span><span class="p">)</span>
</span><span id="Corr-1154"><a href="#Corr-1154"><span class="linenos">1154</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr-1155"><a href="#Corr-1155"><span class="linenos">1155</span></a>
</span><span id="Corr-1156"><a href="#Corr-1156"><span class="linenos">1156</span></a>    <span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1157"><a href="#Corr-1157"><span class="linenos">1157</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">)</span>
</span><span id="Corr-1158"><a href="#Corr-1158"><span class="linenos">1158</span></a>
</span><span id="Corr-1159"><a href="#Corr-1159"><span class="linenos">1159</span></a>    <span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1160"><a href="#Corr-1160"><span class="linenos">1160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">)</span>
</span><span id="Corr-1161"><a href="#Corr-1161"><span class="linenos">1161</span></a>
</span><span id="Corr-1162"><a href="#Corr-1162"><span class="linenos">1162</span></a>    <span class="k">def</span> <span class="nf">tan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1163"><a href="#Corr-1163"><span class="linenos">1163</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">)</span>
</span><span id="Corr-1164"><a href="#Corr-1164"><span class="linenos">1164</span></a>
</span><span id="Corr-1165"><a href="#Corr-1165"><span class="linenos">1165</span></a>    <span class="k">def</span> <span class="nf">sinh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1166"><a href="#Corr-1166"><span class="linenos">1166</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">)</span>
</span><span id="Corr-1167"><a href="#Corr-1167"><span class="linenos">1167</span></a>
</span><span id="Corr-1168"><a href="#Corr-1168"><span class="linenos">1168</span></a>    <span class="k">def</span> <span class="nf">cosh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1169"><a href="#Corr-1169"><span class="linenos">1169</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">)</span>
</span><span id="Corr-1170"><a href="#Corr-1170"><span class="linenos">1170</span></a>
</span><span id="Corr-1171"><a href="#Corr-1171"><span class="linenos">1171</span></a>    <span class="k">def</span> <span class="nf">tanh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1172"><a href="#Corr-1172"><span class="linenos">1172</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">)</span>
</span><span id="Corr-1173"><a href="#Corr-1173"><span class="linenos">1173</span></a>
</span><span id="Corr-1174"><a href="#Corr-1174"><span class="linenos">1174</span></a>    <span class="k">def</span> <span class="nf">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1175"><a href="#Corr-1175"><span class="linenos">1175</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">)</span>
</span><span id="Corr-1176"><a href="#Corr-1176"><span class="linenos">1176</span></a>
</span><span id="Corr-1177"><a href="#Corr-1177"><span class="linenos">1177</span></a>    <span class="k">def</span> <span class="nf">arccos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1178"><a href="#Corr-1178"><span class="linenos">1178</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">)</span>
</span><span id="Corr-1179"><a href="#Corr-1179"><span class="linenos">1179</span></a>
</span><span id="Corr-1180"><a href="#Corr-1180"><span class="linenos">1180</span></a>    <span class="k">def</span> <span class="nf">arctan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1181"><a href="#Corr-1181"><span class="linenos">1181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">)</span>
</span><span id="Corr-1182"><a href="#Corr-1182"><span class="linenos">1182</span></a>
</span><span id="Corr-1183"><a href="#Corr-1183"><span class="linenos">1183</span></a>    <span class="k">def</span> <span class="nf">arcsinh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1184"><a href="#Corr-1184"><span class="linenos">1184</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">)</span>
</span><span id="Corr-1185"><a href="#Corr-1185"><span class="linenos">1185</span></a>
</span><span id="Corr-1186"><a href="#Corr-1186"><span class="linenos">1186</span></a>    <span class="k">def</span> <span class="nf">arccosh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1187"><a href="#Corr-1187"><span class="linenos">1187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccosh</span><span class="p">)</span>
</span><span id="Corr-1188"><a href="#Corr-1188"><span class="linenos">1188</span></a>
</span><span id="Corr-1189"><a href="#Corr-1189"><span class="linenos">1189</span></a>    <span class="k">def</span> <span class="nf">arctanh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1190"><a href="#Corr-1190"><span class="linenos">1190</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">)</span>
</span><span id="Corr-1191"><a href="#Corr-1191"><span class="linenos">1191</span></a>
</span><span id="Corr-1192"><a href="#Corr-1192"><span class="linenos">1192</span></a>    <span class="c1"># Right hand side operations (require tweak in main module to work)</span>
</span><span id="Corr-1193"><a href="#Corr-1193"><span class="linenos">1193</span></a>    <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="Corr-1194"><a href="#Corr-1194"><span class="linenos">1194</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">y</span>
</span><span id="Corr-1195"><a href="#Corr-1195"><span class="linenos">1195</span></a>
</span><span id="Corr-1196"><a href="#Corr-1196"><span class="linenos">1196</span></a>    <span class="k">def</span> <span class="fm">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="Corr-1197"><a href="#Corr-1197"><span class="linenos">1197</span></a>        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span> <span class="o">+</span> <span class="n">y</span>
</span><span id="Corr-1198"><a href="#Corr-1198"><span class="linenos">1198</span></a>
</span><span id="Corr-1199"><a href="#Corr-1199"><span class="linenos">1199</span></a>    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="Corr-1200"><a href="#Corr-1200"><span class="linenos">1200</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">y</span>
</span><span id="Corr-1201"><a href="#Corr-1201"><span class="linenos">1201</span></a>
</span><span id="Corr-1202"><a href="#Corr-1202"><span class="linenos">1202</span></a>    <span class="k">def</span> <span class="fm">__rtruediv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
</span><span id="Corr-1203"><a href="#Corr-1203"><span class="linenos">1203</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">/</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Corr-1204"><a href="#Corr-1204"><span class="linenos">1204</span></a>
</span><span id="Corr-1205"><a href="#Corr-1205"><span class="linenos">1205</span></a>    <span class="nd">@property</span>
</span><span id="Corr-1206"><a href="#Corr-1206"><span class="linenos">1206</span></a>    <span class="k">def</span> <span class="nf">real</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1207"><a href="#Corr-1207"><span class="linenos">1207</span></a>        <span class="k">def</span> <span class="nf">return_real</span><span class="p">(</span><span class="n">obs_OR_cobs</span><span class="p">):</span>
</span><span id="Corr-1208"><a href="#Corr-1208"><span class="linenos">1208</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs_OR_cobs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">):</span>
</span><span id="Corr-1209"><a href="#Corr-1209"><span class="linenos">1209</span></a>                <span class="k">return</span> <span class="n">obs_OR_cobs</span><span class="o">.</span><span class="n">real</span>
</span><span id="Corr-1210"><a href="#Corr-1210"><span class="linenos">1210</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1211"><a href="#Corr-1211"><span class="linenos">1211</span></a>                <span class="k">return</span> <span class="n">obs_OR_cobs</span>
</span><span id="Corr-1212"><a href="#Corr-1212"><span class="linenos">1212</span></a>
</span><span id="Corr-1213"><a href="#Corr-1213"><span class="linenos">1213</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">return_real</span><span class="p">)</span>
</span><span id="Corr-1214"><a href="#Corr-1214"><span class="linenos">1214</span></a>
</span><span id="Corr-1215"><a href="#Corr-1215"><span class="linenos">1215</span></a>    <span class="nd">@property</span>
</span><span id="Corr-1216"><a href="#Corr-1216"><span class="linenos">1216</span></a>    <span class="k">def</span> <span class="nf">imag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr-1217"><a href="#Corr-1217"><span class="linenos">1217</span></a>        <span class="k">def</span> <span class="nf">return_imag</span><span class="p">(</span><span class="n">obs_OR_cobs</span><span class="p">):</span>
</span><span id="Corr-1218"><a href="#Corr-1218"><span class="linenos">1218</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obs_OR_cobs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">):</span>
</span><span id="Corr-1219"><a href="#Corr-1219"><span class="linenos">1219</span></a>                <span class="k">return</span> <span class="n">obs_OR_cobs</span><span class="o">.</span><span class="n">imag</span>
</span><span id="Corr-1220"><a href="#Corr-1220"><span class="linenos">1220</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr-1221"><a href="#Corr-1221"><span class="linenos">1221</span></a>                <span class="k">return</span> <span class="n">obs_OR_cobs</span> <span class="o">*</span> <span class="mi">0</span>  <span class="c1"># So it stays the right type</span>
</span><span id="Corr-1222"><a href="#Corr-1222"><span class="linenos">1222</span></a>
</span><span id="Corr-1223"><a href="#Corr-1223"><span class="linenos">1223</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">return_imag</span><span class="p">)</span>
</span><span id="Corr-1224"><a href="#Corr-1224"><span class="linenos">1224</span></a>
</span><span id="Corr-1225"><a href="#Corr-1225"><span class="linenos">1225</span></a>    <span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ntrunc</span><span class="p">,</span> <span class="n">tproj</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">t0proj</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">basematrix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Corr-1226"><a href="#Corr-1226"><span class="linenos">1226</span></a>        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Project large correlation matrix to lowest states</span>
</span><span id="Corr-1227"><a href="#Corr-1227"><span class="linenos">1227</span></a>
</span><span id="Corr-1228"><a href="#Corr-1228"><span class="linenos">1228</span></a><span class="sd">        This method can be used to reduce the size of an (N x N) correlation matrix</span>
</span><span id="Corr-1229"><a href="#Corr-1229"><span class="linenos">1229</span></a><span class="sd">        to (Ntrunc x Ntrunc) by solving a GEVP at very early times where the noise</span>
</span><span id="Corr-1230"><a href="#Corr-1230"><span class="linenos">1230</span></a><span class="sd">        is still small.</span>
</span><span id="Corr-1231"><a href="#Corr-1231"><span class="linenos">1231</span></a>
</span><span id="Corr-1232"><a href="#Corr-1232"><span class="linenos">1232</span></a><span class="sd">        Parameters</span>
</span><span id="Corr-1233"><a href="#Corr-1233"><span class="linenos">1233</span></a><span class="sd">        ----------</span>
</span><span id="Corr-1234"><a href="#Corr-1234"><span class="linenos">1234</span></a><span class="sd">        Ntrunc: int</span>
</span><span id="Corr-1235"><a href="#Corr-1235"><span class="linenos">1235</span></a><span class="sd">            Rank of the target matrix.</span>
</span><span id="Corr-1236"><a href="#Corr-1236"><span class="linenos">1236</span></a><span class="sd">        tproj: int</span>
</span><span id="Corr-1237"><a href="#Corr-1237"><span class="linenos">1237</span></a><span class="sd">            Time where the eigenvectors are evaluated, corresponds to ts in the GEVP method.</span>
</span><span id="Corr-1238"><a href="#Corr-1238"><span class="linenos">1238</span></a><span class="sd">            The default value is 3.</span>
</span><span id="Corr-1239"><a href="#Corr-1239"><span class="linenos">1239</span></a><span class="sd">        t0proj: int</span>
</span><span id="Corr-1240"><a href="#Corr-1240"><span class="linenos">1240</span></a><span class="sd">            Time where the correlation matrix is inverted. Choosing t0proj=1 is strongly</span>
</span><span id="Corr-1241"><a href="#Corr-1241"><span class="linenos">1241</span></a><span class="sd">            discouraged for O(a) improved theories, since the correctness of the procedure</span>
</span><span id="Corr-1242"><a href="#Corr-1242"><span class="linenos">1242</span></a><span class="sd">            cannot be granted in this case. The default value is 2.</span>
</span><span id="Corr-1243"><a href="#Corr-1243"><span class="linenos">1243</span></a><span class="sd">        basematrix : Corr</span>
</span><span id="Corr-1244"><a href="#Corr-1244"><span class="linenos">1244</span></a><span class="sd">            Correlation matrix that is used to determine the eigenvectors of the</span>
</span><span id="Corr-1245"><a href="#Corr-1245"><span class="linenos">1245</span></a><span class="sd">            lowest states based on a GEVP. basematrix is taken to be the Corr itself if</span>
</span><span id="Corr-1246"><a href="#Corr-1246"><span class="linenos">1246</span></a><span class="sd">            is is not specified.</span>
</span><span id="Corr-1247"><a href="#Corr-1247"><span class="linenos">1247</span></a>
</span><span id="Corr-1248"><a href="#Corr-1248"><span class="linenos">1248</span></a><span class="sd">        Notes</span>
</span><span id="Corr-1249"><a href="#Corr-1249"><span class="linenos">1249</span></a><span class="sd">        -----</span>
</span><span id="Corr-1250"><a href="#Corr-1250"><span class="linenos">1250</span></a><span class="sd">        We have the basematrix $C(t)$ and the target matrix $G(t)$. We start by solving</span>
</span><span id="Corr-1251"><a href="#Corr-1251"><span class="linenos">1251</span></a><span class="sd">        the GEVP $$C(t) v_n(t, t_0) = \lambda_n(t, t_0) C(t_0) v_n(t, t_0)$$ where $t \equiv t_\mathrm{proj}$</span>
</span><span id="Corr-1252"><a href="#Corr-1252"><span class="linenos">1252</span></a><span class="sd">        and $t_0 \equiv t_{0, \mathrm{proj}}$. The target matrix is projected onto the subspace of the</span>
</span><span id="Corr-1253"><a href="#Corr-1253"><span class="linenos">1253</span></a><span class="sd">        resulting eigenvectors $v_n, n=1,\dots,N_\mathrm{trunc}$ via</span>
</span><span id="Corr-1254"><a href="#Corr-1254"><span class="linenos">1254</span></a><span class="sd">        $$G^\prime_{i, j}(t) = (v_i, G(t) v_j)$$. This allows to reduce the size of a large</span>
</span><span id="Corr-1255"><a href="#Corr-1255"><span class="linenos">1255</span></a><span class="sd">        correlation matrix and to remove some noise that is added by irrelevant operators.</span>
</span><span id="Corr-1256"><a href="#Corr-1256"><span class="linenos">1256</span></a><span class="sd">        This may allow to use the GEVP on $G(t)$ at late times such that the theoretically motivated</span>
</span><span id="Corr-1257"><a href="#Corr-1257"><span class="linenos">1257</span></a><span class="sd">        bound $t_0 \leq t/2$ holds, since the condition number of $G(t)$ is decreased, compared to $C(t)$.</span>
</span><span id="Corr-1258"><a href="#Corr-1258"><span class="linenos">1258</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Corr-1259"><a href="#Corr-1259"><span class="linenos">1259</span></a>
</span><span id="Corr-1260"><a href="#Corr-1260"><span class="linenos">1260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr-1261"><a href="#Corr-1261"><span class="linenos">1261</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Method cannot be applied to one-dimensional correlators.&#39;</span><span class="p">)</span>
</span><span id="Corr-1262"><a href="#Corr-1262"><span class="linenos">1262</span></a>        <span class="k">if</span> <span class="n">basematrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr-1263"><a href="#Corr-1263"><span class="linenos">1263</span></a>            <span class="n">basematrix</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Corr-1264"><a href="#Corr-1264"><span class="linenos">1264</span></a>        <span class="k">if</span> <span class="n">Ntrunc</span> <span class="o">&gt;=</span> <span class="n">basematrix</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
</span><span id="Corr-1265"><a href="#Corr-1265"><span class="linenos">1265</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Cannot truncate using Ntrunc &lt;= </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basematrix</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
</span><span id="Corr-1266"><a href="#Corr-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="n">basematrix</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
</span><span id="Corr-1267"><a href="#Corr-1267"><span class="linenos">1267</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;basematrix and targetmatrix have to be of the same size.&#39;</span><span class="p">)</span>
</span><span id="Corr-1268"><a href="#Corr-1268"><span class="linenos">1268</span></a>
</span><span id="Corr-1269"><a href="#Corr-1269"><span class="linenos">1269</span></a>        <span class="n">evecs</span> <span class="o">=</span> <span class="n">basematrix</span><span class="o">.</span><span class="n">GEVP</span><span class="p">(</span><span class="n">t0proj</span><span class="p">,</span> <span class="n">tproj</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">)[:</span><span class="n">Ntrunc</span><span class="p">]</span>
</span><span id="Corr-1270"><a href="#Corr-1270"><span class="linenos">1270</span></a>
</span><span id="Corr-1271"><a href="#Corr-1271"><span class="linenos">1271</span></a>        <span class="n">tmpmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Ntrunc</span><span class="p">,</span> <span class="n">Ntrunc</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="Corr-1272"><a href="#Corr-1272"><span class="linenos">1272</span></a>        <span class="n">rmat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr-1273"><a href="#Corr-1273"><span class="linenos">1273</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basematrix</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr-1274"><a href="#Corr-1274"><span class="linenos">1274</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ntrunc</span><span class="p">):</span>
</span><span id="Corr-1275"><a href="#Corr-1275"><span class="linenos">1275</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ntrunc</span><span class="p">):</span>
</span><span id="Corr-1276"><a href="#Corr-1276"><span class="linenos">1276</span></a>                    <span class="n">tmpmat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">evecs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">evecs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="Corr-1277"><a href="#Corr-1277"><span class="linenos">1277</span></a>            <span class="n">rmat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmpmat</span><span class="p">))</span>
</span><span id="Corr-1278"><a href="#Corr-1278"><span class="linenos">1278</span></a>
</span><span id="Corr-1279"><a href="#Corr-1279"><span class="linenos">1279</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">rmat</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)]</span>
</span><span id="Corr-1280"><a href="#Corr-1280"><span class="linenos">1280</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The class for a correlator (time dependent sequence of pe.Obs).</p>

<p>Everything, this class does, can be achieved using lists or arrays of Obs.
But it is simply more convenient to have a dedicated object for correlators.
One often wants to add or multiply correlators of the same length at every timeslice and it is inconvenient
to iterate over all timeslices for every operation. This is especially true, when dealing with matrices.</p>

<p>The correlator can have two types of content: An Obs at every timeslice OR a GEVP
matrix at every timeslice. Other dependency (eg. spatial) are not supported.</p>
</div>


                            <div id="Corr.__init__" class="classattr">
                                        <input id="Corr.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Corr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data_input</span>, </span><span class="param"><span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>, </span><span class="param"><span class="n">prange</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Corr.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.__init__-27"><a href="#Corr.__init__-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_input</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">prange</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.__init__-28"><a href="#Corr.__init__-28"><span class="linenos">28</span></a>        <span class="sd">&quot;&quot;&quot; Initialize a Corr object.</span>
</span><span id="Corr.__init__-29"><a href="#Corr.__init__-29"><span class="linenos">29</span></a>
</span><span id="Corr.__init__-30"><a href="#Corr.__init__-30"><span class="linenos">30</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.__init__-31"><a href="#Corr.__init__-31"><span class="linenos">31</span></a><span class="sd">        ----------</span>
</span><span id="Corr.__init__-32"><a href="#Corr.__init__-32"><span class="linenos">32</span></a><span class="sd">        data_input : list or array</span>
</span><span id="Corr.__init__-33"><a href="#Corr.__init__-33"><span class="linenos">33</span></a><span class="sd">            list of Obs or list of arrays of Obs or array of Corrs</span>
</span><span id="Corr.__init__-34"><a href="#Corr.__init__-34"><span class="linenos">34</span></a><span class="sd">        padding : list, optional</span>
</span><span id="Corr.__init__-35"><a href="#Corr.__init__-35"><span class="linenos">35</span></a><span class="sd">            List with two entries where the first labels the padding</span>
</span><span id="Corr.__init__-36"><a href="#Corr.__init__-36"><span class="linenos">36</span></a><span class="sd">            at the front of the correlator and the second the padding</span>
</span><span id="Corr.__init__-37"><a href="#Corr.__init__-37"><span class="linenos">37</span></a><span class="sd">            at the back.</span>
</span><span id="Corr.__init__-38"><a href="#Corr.__init__-38"><span class="linenos">38</span></a><span class="sd">        prange : list, optional</span>
</span><span id="Corr.__init__-39"><a href="#Corr.__init__-39"><span class="linenos">39</span></a><span class="sd">            List containing the first and last timeslice of the plateau</span>
</span><span id="Corr.__init__-40"><a href="#Corr.__init__-40"><span class="linenos">40</span></a><span class="sd">            region indentified for this correlator.</span>
</span><span id="Corr.__init__-41"><a href="#Corr.__init__-41"><span class="linenos">41</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.__init__-42"><a href="#Corr.__init__-42"><span class="linenos">42</span></a>
</span><span id="Corr.__init__-43"><a href="#Corr.__init__-43"><span class="linenos">43</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_input</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
</span><span id="Corr.__init__-44"><a href="#Corr.__init__-44"><span class="linenos">44</span></a>
</span><span id="Corr.__init__-45"><a href="#Corr.__init__-45"><span class="linenos">45</span></a>            <span class="c1"># This only works, if the array fulfills the conditions below</span>
</span><span id="Corr.__init__-46"><a href="#Corr.__init__-46"><span class="linenos">46</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Corr.__init__-47"><a href="#Corr.__init__-47"><span class="linenos">47</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Incompatible array shape&quot;</span><span class="p">)</span>
</span><span id="Corr.__init__-48"><a href="#Corr.__init__-48"><span class="linenos">48</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">Corr</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="Corr.__init__-49"><a href="#Corr.__init__-49"><span class="linenos">49</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;If the input is an array, its elements must be of type pe.Corr&quot;</span><span class="p">)</span>
</span><span id="Corr.__init__-50"><a href="#Corr.__init__-50"><span class="linenos">50</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="Corr.__init__-51"><a href="#Corr.__init__-51"><span class="linenos">51</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only construct matrix correlator from single valued correlators&quot;</span><span class="p">)</span>
</span><span id="Corr.__init__-52"><a href="#Corr.__init__-52"><span class="linenos">52</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.__init__-53"><a href="#Corr.__init__-53"><span class="linenos">53</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;All input Correlators must be defined over the same timeslices.&quot;</span><span class="p">)</span>
</span><span id="Corr.__init__-54"><a href="#Corr.__init__-54"><span class="linenos">54</span></a>
</span><span id="Corr.__init__-55"><a href="#Corr.__init__-55"><span class="linenos">55</span></a>            <span class="n">T</span> <span class="o">=</span> <span class="n">data_input</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr.__init__-56"><a href="#Corr.__init__-56"><span class="linenos">56</span></a>            <span class="n">N</span> <span class="o">=</span> <span class="n">data_input</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr.__init__-57"><a href="#Corr.__init__-57"><span class="linenos">57</span></a>            <span class="n">input_as_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.__init__-58"><a href="#Corr.__init__-58"><span class="linenos">58</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.__init__-59"><a href="#Corr.__init__-59"><span class="linenos">59</span></a>                <span class="k">if</span> <span class="nb">any</span><span class="p">([(</span><span class="n">item</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="Corr.__init__-60"><a href="#Corr.__init__-60"><span class="linenos">60</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([(</span><span class="n">item</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]):</span>
</span><span id="Corr.__init__-61"><a href="#Corr.__init__-61"><span class="linenos">61</span></a>                        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Input ill-defined at different timeslices. Conversion leads to data loss!&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr.__init__-62"><a href="#Corr.__init__-62"><span class="linenos">62</span></a>                    <span class="n">input_as_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.__init__-63"><a href="#Corr.__init__-63"><span class="linenos">63</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.__init__-64"><a href="#Corr.__init__-64"><span class="linenos">64</span></a>                    <span class="n">array_at_timeslace</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
</span><span id="Corr.__init__-65"><a href="#Corr.__init__-65"><span class="linenos">65</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.__init__-66"><a href="#Corr.__init__-66"><span class="linenos">66</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.__init__-67"><a href="#Corr.__init__-67"><span class="linenos">67</span></a>                            <span class="n">array_at_timeslace</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_input</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">][</span><span class="n">t</span><span class="p">]</span>
</span><span id="Corr.__init__-68"><a href="#Corr.__init__-68"><span class="linenos">68</span></a>                    <span class="n">input_as_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array_at_timeslace</span><span class="p">)</span>
</span><span id="Corr.__init__-69"><a href="#Corr.__init__-69"><span class="linenos">69</span></a>            <span class="n">data_input</span> <span class="o">=</span> <span class="n">input_as_list</span>
</span><span id="Corr.__init__-70"><a href="#Corr.__init__-70"><span class="linenos">70</span></a>
</span><span id="Corr.__init__-71"><a href="#Corr.__init__-71"><span class="linenos">71</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_input</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr.__init__-72"><a href="#Corr.__init__-72"><span class="linenos">72</span></a>
</span><span id="Corr.__init__-73"><a href="#Corr.__init__-73"><span class="linenos">73</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]):</span>
</span><span id="Corr.__init__-74"><a href="#Corr.__init__-74"><span class="linenos">74</span></a>                <span class="n">_assert_equal_properties</span><span class="p">(</span><span class="n">data_input</span><span class="p">)</span>
</span><span id="Corr.__init__-75"><a href="#Corr.__init__-75"><span class="linenos">75</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">item</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]</span>
</span><span id="Corr.__init__-76"><a href="#Corr.__init__-76"><span class="linenos">76</span></a>            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="p">(</span><span class="n">Obs</span><span class="p">,</span> <span class="n">CObs</span><span class="p">))</span> <span class="ow">or</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]):</span>
</span><span id="Corr.__init__-77"><a href="#Corr.__init__-77"><span class="linenos">77</span></a>                <span class="n">_assert_equal_properties</span><span class="p">([</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">data_input</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="Corr.__init__-78"><a href="#Corr.__init__-78"><span class="linenos">78</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">item</span><span class="p">])</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]</span>
</span><span id="Corr.__init__-79"><a href="#Corr.__init__-79"><span class="linenos">79</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="Corr.__init__-80"><a href="#Corr.__init__-80"><span class="linenos">80</span></a>
</span><span id="Corr.__init__-81"><a href="#Corr.__init__-81"><span class="linenos">81</span></a>            <span class="k">elif</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">])</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data_input</span><span class="p">]):</span>
</span><span id="Corr.__init__-82"><a href="#Corr.__init__-82"><span class="linenos">82</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">data_input</span>
</span><span id="Corr.__init__-83"><a href="#Corr.__init__-83"><span class="linenos">83</span></a>                <span class="n">noNull</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">a</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)]</span>  <span class="c1"># To check if the matrices are correct for all undefined elements</span>
</span><span id="Corr.__init__-84"><a href="#Corr.__init__-84"><span class="linenos">84</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr.__init__-85"><a href="#Corr.__init__-85"><span class="linenos">85</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Corr.__init__-86"><a href="#Corr.__init__-86"><span class="linenos">86</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Smearing matrices are not NxN&quot;</span><span class="p">)</span>
</span><span id="Corr.__init__-87"><a href="#Corr.__init__-87"><span class="linenos">87</span></a>                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">item</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">noNull</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">noNull</span><span class="p">])):</span>
</span><span id="Corr.__init__-88"><a href="#Corr.__init__-88"><span class="linenos">88</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Items in data_input are not of identical shape.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">noNull</span><span class="p">))</span>
</span><span id="Corr.__init__-89"><a href="#Corr.__init__-89"><span class="linenos">89</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.__init__-90"><a href="#Corr.__init__-90"><span class="linenos">90</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;data_input contains item of wrong type&quot;</span><span class="p">)</span>
</span><span id="Corr.__init__-91"><a href="#Corr.__init__-91"><span class="linenos">91</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.__init__-92"><a href="#Corr.__init__-92"><span class="linenos">92</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Data input was not given as list or correct array&quot;</span><span class="p">)</span>
</span><span id="Corr.__init__-93"><a href="#Corr.__init__-93"><span class="linenos">93</span></a>
</span><span id="Corr.__init__-94"><a href="#Corr.__init__-94"><span class="linenos">94</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr.__init__-95"><a href="#Corr.__init__-95"><span class="linenos">95</span></a>
</span><span id="Corr.__init__-96"><a href="#Corr.__init__-96"><span class="linenos">96</span></a>        <span class="c1"># An undefined timeslice is represented by the None object</span>
</span><span id="Corr.__init__-97"><a href="#Corr.__init__-97"><span class="linenos">97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Corr.__init__-98"><a href="#Corr.__init__-98"><span class="linenos">98</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</span><span id="Corr.__init__-99"><a href="#Corr.__init__-99"><span class="linenos">99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prange</span> <span class="o">=</span> <span class="n">prange</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a Corr object.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>data_input</strong> (list or array):
list of Obs or list of arrays of Obs or array of Corrs</li>
<li><strong>padding</strong> (list, optional):
List with two entries where the first labels the padding
at the front of the correlator and the second the padding
at the back.</li>
<li><strong>prange</strong> (list, optional):
List containing the first and last timeslice of the plateau
region indentified for this correlator.</li>
</ul>
</div>


                            </div>
                            <div id="Corr.gamma_method" class="classattr">
                                        <input id="Corr.gamma_method-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">gamma_method</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.gamma_method-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.gamma_method"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.gamma_method-120"><a href="#Corr.gamma_method-120"><span class="linenos">120</span></a>    <span class="k">def</span> <span class="nf">gamma_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr.gamma_method-121"><a href="#Corr.gamma_method-121"><span class="linenos">121</span></a>        <span class="sd">&quot;&quot;&quot;Apply the gamma method to the content of the Corr.&quot;&quot;&quot;</span>
</span><span id="Corr.gamma_method-122"><a href="#Corr.gamma_method-122"><span class="linenos">122</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="Corr.gamma_method-123"><a href="#Corr.gamma_method-123"><span class="linenos">123</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.gamma_method-124"><a href="#Corr.gamma_method-124"><span class="linenos">124</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.gamma_method-125"><a href="#Corr.gamma_method-125"><span class="linenos">125</span></a>                    <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Corr.gamma_method-126"><a href="#Corr.gamma_method-126"><span class="linenos">126</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.gamma_method-127"><a href="#Corr.gamma_method-127"><span class="linenos">127</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.gamma_method-128"><a href="#Corr.gamma_method-128"><span class="linenos">128</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.gamma_method-129"><a href="#Corr.gamma_method-129"><span class="linenos">129</span></a>                            <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Apply the gamma method to the content of the Corr.</p>
</div>


                            </div>
                            <div id="Corr.projected" class="classattr">
                                        <input id="Corr.projected-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">projected</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">vector_l</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">vector_r</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">normalize</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.projected-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.projected"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.projected-131"><a href="#Corr.projected-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">projected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vector_l</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vector_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Corr.projected-132"><a href="#Corr.projected-132"><span class="linenos">132</span></a>        <span class="sd">&quot;&quot;&quot;We need to project the Correlator with a Vector to get a single value at each timeslice.</span>
</span><span id="Corr.projected-133"><a href="#Corr.projected-133"><span class="linenos">133</span></a>
</span><span id="Corr.projected-134"><a href="#Corr.projected-134"><span class="linenos">134</span></a><span class="sd">        The method can use one or two vectors.</span>
</span><span id="Corr.projected-135"><a href="#Corr.projected-135"><span class="linenos">135</span></a><span class="sd">        If two are specified it returns v1@G@v2 (the order might be very important.)</span>
</span><span id="Corr.projected-136"><a href="#Corr.projected-136"><span class="linenos">136</span></a><span class="sd">        By default it will return the lowest source, which usually means unsmeared-unsmeared (0,0), but it does not have to</span>
</span><span id="Corr.projected-137"><a href="#Corr.projected-137"><span class="linenos">137</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.projected-138"><a href="#Corr.projected-138"><span class="linenos">138</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.projected-139"><a href="#Corr.projected-139"><span class="linenos">139</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Trying to project a Corr, that already has N=1.&quot;</span><span class="p">)</span>
</span><span id="Corr.projected-140"><a href="#Corr.projected-140"><span class="linenos">140</span></a>
</span><span id="Corr.projected-141"><a href="#Corr.projected-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="n">vector_l</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.projected-142"><a href="#Corr.projected-142"><span class="linenos">142</span></a>            <span class="n">vector_l</span><span class="p">,</span> <span class="n">vector_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="mf">1.</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="mf">0.</span><span class="p">])</span>
</span><span id="Corr.projected-143"><a href="#Corr.projected-143"><span class="linenos">143</span></a>        <span class="k">elif</span> <span class="p">(</span><span class="n">vector_r</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.projected-144"><a href="#Corr.projected-144"><span class="linenos">144</span></a>            <span class="n">vector_r</span> <span class="o">=</span> <span class="n">vector_l</span>
</span><span id="Corr.projected-145"><a href="#Corr.projected-145"><span class="linenos">145</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_l</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_r</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr.projected-146"><a href="#Corr.projected-146"><span class="linenos">146</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector_l</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="Corr.projected-147"><a href="#Corr.projected-147"><span class="linenos">147</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Length of vector list must be equal to T&quot;</span><span class="p">)</span>
</span><span id="Corr.projected-148"><a href="#Corr.projected-148"><span class="linenos">148</span></a>            <span class="n">vector_r</span> <span class="o">=</span> <span class="p">[</span><span class="n">vector_r</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr.projected-149"><a href="#Corr.projected-149"><span class="linenos">149</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_r</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_l</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr.projected-150"><a href="#Corr.projected-150"><span class="linenos">150</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vector_r</span><span class="p">)</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="Corr.projected-151"><a href="#Corr.projected-151"><span class="linenos">151</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Length of vector list must be equal to T&quot;</span><span class="p">)</span>
</span><span id="Corr.projected-152"><a href="#Corr.projected-152"><span class="linenos">152</span></a>            <span class="n">vector_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">vector_l</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr.projected-153"><a href="#Corr.projected-153"><span class="linenos">153</span></a>
</span><span id="Corr.projected-154"><a href="#Corr.projected-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vector_l</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr.projected-155"><a href="#Corr.projected-155"><span class="linenos">155</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">vector_l</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">vector_r</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,):</span>
</span><span id="Corr.projected-156"><a href="#Corr.projected-156"><span class="linenos">156</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Vectors are of wrong shape!&quot;</span><span class="p">)</span>
</span><span id="Corr.projected-157"><a href="#Corr.projected-157"><span class="linenos">157</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="Corr.projected-158"><a href="#Corr.projected-158"><span class="linenos">158</span></a>                <span class="n">vector_l</span><span class="p">,</span> <span class="n">vector_r</span> <span class="o">=</span> <span class="n">vector_l</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">vector_l</span> <span class="o">@</span> <span class="n">vector_l</span><span class="p">)),</span> <span class="n">vector_r</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vector_r</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">)</span>
</span><span id="Corr.projected-159"><a href="#Corr.projected-159"><span class="linenos">159</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">vector_l</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">item</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">])</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr.projected-160"><a href="#Corr.projected-160"><span class="linenos">160</span></a>
</span><span id="Corr.projected-161"><a href="#Corr.projected-161"><span class="linenos">161</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.projected-162"><a href="#Corr.projected-162"><span class="linenos">162</span></a>            <span class="c1"># There are no checks here yet. There are so many possible scenarios, where this can go wrong.</span>
</span><span id="Corr.projected-163"><a href="#Corr.projected-163"><span class="linenos">163</span></a>            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
</span><span id="Corr.projected-164"><a href="#Corr.projected-164"><span class="linenos">164</span></a>                <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.projected-165"><a href="#Corr.projected-165"><span class="linenos">165</span></a>                    <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">])),</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="Corr.projected-166"><a href="#Corr.projected-166"><span class="linenos">166</span></a>
</span><span id="Corr.projected-167"><a href="#Corr.projected-167"><span class="linenos">167</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="ow">or</span> <span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">vector_l</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">vector_r</span><span class="p">[</span><span class="n">t</span><span class="p">]])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)]</span>
</span><span id="Corr.projected-168"><a href="#Corr.projected-168"><span class="linenos">168</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>We need to project the Correlator with a Vector to get a single value at each timeslice.</p>

<p>The method can use one or two vectors.
If two are specified it returns v1@G@v2 (the order might be very important.)
By default it will return the lowest source, which usually means unsmeared-unsmeared (0,0), but it does not have to</p>
</div>


                            </div>
                            <div id="Corr.item" class="classattr">
                                        <input id="Corr.item-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">item</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">i</span>, </span><span class="param"><span class="n">j</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.item-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.item"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.item-170"><a href="#Corr.item-170"><span class="linenos">170</span></a>    <span class="k">def</span> <span class="nf">item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
</span><span id="Corr.item-171"><a href="#Corr.item-171"><span class="linenos">171</span></a>        <span class="sd">&quot;&quot;&quot;Picks the element [i,j] from every matrix and returns a correlator containing one Obs per timeslice.</span>
</span><span id="Corr.item-172"><a href="#Corr.item-172"><span class="linenos">172</span></a>
</span><span id="Corr.item-173"><a href="#Corr.item-173"><span class="linenos">173</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.item-174"><a href="#Corr.item-174"><span class="linenos">174</span></a><span class="sd">        ----------</span>
</span><span id="Corr.item-175"><a href="#Corr.item-175"><span class="linenos">175</span></a><span class="sd">        i : int</span>
</span><span id="Corr.item-176"><a href="#Corr.item-176"><span class="linenos">176</span></a><span class="sd">            First index to be picked.</span>
</span><span id="Corr.item-177"><a href="#Corr.item-177"><span class="linenos">177</span></a><span class="sd">        j : int</span>
</span><span id="Corr.item-178"><a href="#Corr.item-178"><span class="linenos">178</span></a><span class="sd">            Second index to be picked.</span>
</span><span id="Corr.item-179"><a href="#Corr.item-179"><span class="linenos">179</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.item-180"><a href="#Corr.item-180"><span class="linenos">180</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.item-181"><a href="#Corr.item-181"><span class="linenos">181</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Trying to pick item from projected Corr&quot;</span><span class="p">)</span>
</span><span id="Corr.item-182"><a href="#Corr.item-182"><span class="linenos">182</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">item</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr.item-183"><a href="#Corr.item-183"><span class="linenos">183</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Picks the element [i,j] from every matrix and returns a correlator containing one Obs per timeslice.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>i</strong> (int):
First index to be picked.</li>
<li><strong>j</strong> (int):
Second index to be picked.</li>
</ul>
</div>


                            </div>
                            <div id="Corr.plottable" class="classattr">
                                        <input id="Corr.plottable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plottable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.plottable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.plottable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.plottable-185"><a href="#Corr.plottable-185"><span class="linenos">185</span></a>    <span class="k">def</span> <span class="nf">plottable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.plottable-186"><a href="#Corr.plottable-186"><span class="linenos">186</span></a>        <span class="sd">&quot;&quot;&quot;Outputs the correlator in a plotable format.</span>
</span><span id="Corr.plottable-187"><a href="#Corr.plottable-187"><span class="linenos">187</span></a>
</span><span id="Corr.plottable-188"><a href="#Corr.plottable-188"><span class="linenos">188</span></a><span class="sd">        Outputs three lists containing the timeslice index, the value on each</span>
</span><span id="Corr.plottable-189"><a href="#Corr.plottable-189"><span class="linenos">189</span></a><span class="sd">        timeslice and the error on each timeslice.</span>
</span><span id="Corr.plottable-190"><a href="#Corr.plottable-190"><span class="linenos">190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.plottable-191"><a href="#Corr.plottable-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.plottable-192"><a href="#Corr.plottable-192"><span class="linenos">192</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only make Corr[N=1] plottable&quot;</span><span class="p">)</span>
</span><span id="Corr.plottable-193"><a href="#Corr.plottable-193"><span class="linenos">193</span></a>        <span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr.plottable-194"><a href="#Corr.plottable-194"><span class="linenos">194</span></a>        <span class="n">y_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr.plottable-195"><a href="#Corr.plottable-195"><span class="linenos">195</span></a>        <span class="n">y_err_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr.plottable-196"><a href="#Corr.plottable-196"><span class="linenos">196</span></a>
</span><span id="Corr.plottable-197"><a href="#Corr.plottable-197"><span class="linenos">197</span></a>        <span class="k">return</span> <span class="n">x_list</span><span class="p">,</span> <span class="n">y_list</span><span class="p">,</span> <span class="n">y_err_list</span>
</span></pre></div>


            <div class="docstring"><p>Outputs the correlator in a plotable format.</p>

<p>Outputs three lists containing the timeslice index, the value on each
timeslice and the error on each timeslice.</p>
</div>


                            </div>
                            <div id="Corr.symmetric" class="classattr">
                                        <input id="Corr.symmetric-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">symmetric</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.symmetric-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.symmetric"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.symmetric-199"><a href="#Corr.symmetric-199"><span class="linenos">199</span></a>    <span class="k">def</span> <span class="nf">symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.symmetric-200"><a href="#Corr.symmetric-200"><span class="linenos">200</span></a>        <span class="sd">&quot;&quot;&quot; Symmetrize the correlator around x0=0.&quot;&quot;&quot;</span>
</span><span id="Corr.symmetric-201"><a href="#Corr.symmetric-201"><span class="linenos">201</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.symmetric-202"><a href="#Corr.symmetric-202"><span class="linenos">202</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;symmetric cannot be safely applied to multi-dimensional correlators.&#39;</span><span class="p">)</span>
</span><span id="Corr.symmetric-203"><a href="#Corr.symmetric-203"><span class="linenos">203</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr.symmetric-204"><a href="#Corr.symmetric-204"><span class="linenos">204</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can not symmetrize odd T&quot;</span><span class="p">)</span>
</span><span id="Corr.symmetric-205"><a href="#Corr.symmetric-205"><span class="linenos">205</span></a>
</span><span id="Corr.symmetric-206"><a href="#Corr.symmetric-206"><span class="linenos">206</span></a>        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr.symmetric-207"><a href="#Corr.symmetric-207"><span class="linenos">207</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Correlator does not seem to be symmetric around x0=0.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr.symmetric-208"><a href="#Corr.symmetric-208"><span class="linenos">208</span></a>
</span><span id="Corr.symmetric-209"><a href="#Corr.symmetric-209"><span class="linenos">209</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Corr.symmetric-210"><a href="#Corr.symmetric-210"><span class="linenos">210</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.symmetric-211"><a href="#Corr.symmetric-211"><span class="linenos">211</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.symmetric-212"><a href="#Corr.symmetric-212"><span class="linenos">212</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.symmetric-213"><a href="#Corr.symmetric-213"><span class="linenos">213</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.symmetric-214"><a href="#Corr.symmetric-214"><span class="linenos">214</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]))</span>
</span><span id="Corr.symmetric-215"><a href="#Corr.symmetric-215"><span class="linenos">215</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.symmetric-216"><a href="#Corr.symmetric-216"><span class="linenos">216</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Corr could not be symmetrized: No redundant values&quot;</span><span class="p">)</span>
</span><span id="Corr.symmetric-217"><a href="#Corr.symmetric-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Symmetrize the correlator around x0=0.</p>
</div>


                            </div>
                            <div id="Corr.anti_symmetric" class="classattr">
                                        <input id="Corr.anti_symmetric-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">anti_symmetric</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.anti_symmetric-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.anti_symmetric"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.anti_symmetric-219"><a href="#Corr.anti_symmetric-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">anti_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.anti_symmetric-220"><a href="#Corr.anti_symmetric-220"><span class="linenos">220</span></a>        <span class="sd">&quot;&quot;&quot;Anti-symmetrize the correlator around x0=0.&quot;&quot;&quot;</span>
</span><span id="Corr.anti_symmetric-221"><a href="#Corr.anti_symmetric-221"><span class="linenos">221</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.anti_symmetric-222"><a href="#Corr.anti_symmetric-222"><span class="linenos">222</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;anti_symmetric cannot be safely applied to multi-dimensional correlators.&#39;</span><span class="p">)</span>
</span><span id="Corr.anti_symmetric-223"><a href="#Corr.anti_symmetric-223"><span class="linenos">223</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr.anti_symmetric-224"><a href="#Corr.anti_symmetric-224"><span class="linenos">224</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can not symmetrize odd T&quot;</span><span class="p">)</span>
</span><span id="Corr.anti_symmetric-225"><a href="#Corr.anti_symmetric-225"><span class="linenos">225</span></a>
</span><span id="Corr.anti_symmetric-226"><a href="#Corr.anti_symmetric-226"><span class="linenos">226</span></a>        <span class="n">test</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="bp">self</span>
</span><span id="Corr.anti_symmetric-227"><a href="#Corr.anti_symmetric-227"><span class="linenos">227</span></a>        <span class="n">test</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr.anti_symmetric-228"><a href="#Corr.anti_symmetric-228"><span class="linenos">228</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">is_zero_within_error</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">test</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]):</span>
</span><span id="Corr.anti_symmetric-229"><a href="#Corr.anti_symmetric-229"><span class="linenos">229</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Correlator does not seem to be anti-symmetric around x0=0.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr.anti_symmetric-230"><a href="#Corr.anti_symmetric-230"><span class="linenos">230</span></a>
</span><span id="Corr.anti_symmetric-231"><a href="#Corr.anti_symmetric-231"><span class="linenos">231</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</span><span id="Corr.anti_symmetric-232"><a href="#Corr.anti_symmetric-232"><span class="linenos">232</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.anti_symmetric-233"><a href="#Corr.anti_symmetric-233"><span class="linenos">233</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.anti_symmetric-234"><a href="#Corr.anti_symmetric-234"><span class="linenos">234</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.anti_symmetric-235"><a href="#Corr.anti_symmetric-235"><span class="linenos">235</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.anti_symmetric-236"><a href="#Corr.anti_symmetric-236"><span class="linenos">236</span></a>                <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="n">t</span><span class="p">]))</span>
</span><span id="Corr.anti_symmetric-237"><a href="#Corr.anti_symmetric-237"><span class="linenos">237</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.anti_symmetric-238"><a href="#Corr.anti_symmetric-238"><span class="linenos">238</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Corr could not be symmetrized: No redundant values&quot;</span><span class="p">)</span>
</span><span id="Corr.anti_symmetric-239"><a href="#Corr.anti_symmetric-239"><span class="linenos">239</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Anti-symmetrize the correlator around x0=0.</p>
</div>


                            </div>
                            <div id="Corr.is_matrix_symmetric" class="classattr">
                                        <input id="Corr.is_matrix_symmetric-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">is_matrix_symmetric</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.is_matrix_symmetric-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.is_matrix_symmetric"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.is_matrix_symmetric-241"><a href="#Corr.is_matrix_symmetric-241"><span class="linenos">241</span></a>    <span class="k">def</span> <span class="nf">is_matrix_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.is_matrix_symmetric-242"><a href="#Corr.is_matrix_symmetric-242"><span class="linenos">242</span></a>        <span class="sd">&quot;&quot;&quot;Checks whether a correlator matrices is symmetric on every timeslice.&quot;&quot;&quot;</span>
</span><span id="Corr.is_matrix_symmetric-243"><a href="#Corr.is_matrix_symmetric-243"><span class="linenos">243</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.is_matrix_symmetric-244"><a href="#Corr.is_matrix_symmetric-244"><span class="linenos">244</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only works for correlator matrices.&quot;</span><span class="p">)</span>
</span><span id="Corr.is_matrix_symmetric-245"><a href="#Corr.is_matrix_symmetric-245"><span class="linenos">245</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.is_matrix_symmetric-246"><a href="#Corr.is_matrix_symmetric-246"><span class="linenos">246</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.is_matrix_symmetric-247"><a href="#Corr.is_matrix_symmetric-247"><span class="linenos">247</span></a>                <span class="k">continue</span>
</span><span id="Corr.is_matrix_symmetric-248"><a href="#Corr.is_matrix_symmetric-248"><span class="linenos">248</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.is_matrix_symmetric-249"><a href="#Corr.is_matrix_symmetric-249"><span class="linenos">249</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.is_matrix_symmetric-250"><a href="#Corr.is_matrix_symmetric-250"><span class="linenos">250</span></a>                    <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]:</span>
</span><span id="Corr.is_matrix_symmetric-251"><a href="#Corr.is_matrix_symmetric-251"><span class="linenos">251</span></a>                        <span class="k">continue</span>
</span><span id="Corr.is_matrix_symmetric-252"><a href="#Corr.is_matrix_symmetric-252"><span class="linenos">252</span></a>                    <span class="k">if</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]):</span>
</span><span id="Corr.is_matrix_symmetric-253"><a href="#Corr.is_matrix_symmetric-253"><span class="linenos">253</span></a>                        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Corr.is_matrix_symmetric-254"><a href="#Corr.is_matrix_symmetric-254"><span class="linenos">254</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Checks whether a correlator matrices is symmetric on every timeslice.</p>
</div>


                            </div>
                            <div id="Corr.matrix_symmetric" class="classattr">
                                        <input id="Corr.matrix_symmetric-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">matrix_symmetric</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.matrix_symmetric-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.matrix_symmetric"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.matrix_symmetric-256"><a href="#Corr.matrix_symmetric-256"><span class="linenos">256</span></a>    <span class="k">def</span> <span class="nf">matrix_symmetric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.matrix_symmetric-257"><a href="#Corr.matrix_symmetric-257"><span class="linenos">257</span></a>        <span class="sd">&quot;&quot;&quot;Symmetrizes the correlator matrices on every timeslice.&quot;&quot;&quot;</span>
</span><span id="Corr.matrix_symmetric-258"><a href="#Corr.matrix_symmetric-258"><span class="linenos">258</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.matrix_symmetric-259"><a href="#Corr.matrix_symmetric-259"><span class="linenos">259</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Trying to symmetrize a correlator matrix, that already has N=1.&quot;</span><span class="p">)</span>
</span><span id="Corr.matrix_symmetric-260"><a href="#Corr.matrix_symmetric-260"><span class="linenos">260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_matrix_symmetric</span><span class="p">():</span>
</span><span id="Corr.matrix_symmetric-261"><a href="#Corr.matrix_symmetric-261"><span class="linenos">261</span></a>            <span class="k">return</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="bp">self</span>
</span><span id="Corr.matrix_symmetric-262"><a href="#Corr.matrix_symmetric-262"><span class="linenos">262</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.matrix_symmetric-263"><a href="#Corr.matrix_symmetric-263"><span class="linenos">263</span></a>            <span class="n">transposed</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">G</span><span class="p">)</span> <span class="k">else</span> <span class="n">G</span><span class="o">.</span><span class="n">T</span> <span class="k">for</span> <span class="n">G</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr.matrix_symmetric-264"><a href="#Corr.matrix_symmetric-264"><span class="linenos">264</span></a>            <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">transposed</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Symmetrizes the correlator matrices on every timeslice.</p>
</div>


                            </div>
                            <div id="Corr.GEVP" class="classattr">
                                        <input id="Corr.GEVP-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">GEVP</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t0</span>, </span><span class="param"><span class="n">ts</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">sort</span><span class="o">=</span><span class="s1">&#39;Eigenvalue&#39;</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.GEVP-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.GEVP"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.GEVP-266"><a href="#Corr.GEVP-266"><span class="linenos">266</span></a>    <span class="k">def</span> <span class="nf">GEVP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;Eigenvalue&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr.GEVP-267"><a href="#Corr.GEVP-267"><span class="linenos">267</span></a>        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Solve the generalized eigenvalue problem on the correlator matrix and returns the corresponding eigenvectors.</span>
</span><span id="Corr.GEVP-268"><a href="#Corr.GEVP-268"><span class="linenos">268</span></a>
</span><span id="Corr.GEVP-269"><a href="#Corr.GEVP-269"><span class="linenos">269</span></a><span class="sd">        The eigenvectors are sorted according to the descending eigenvalues, the zeroth eigenvector(s) correspond to the</span>
</span><span id="Corr.GEVP-270"><a href="#Corr.GEVP-270"><span class="linenos">270</span></a><span class="sd">        largest eigenvalue(s). The eigenvector(s) for the individual states can be accessed via slicing</span>
</span><span id="Corr.GEVP-271"><a href="#Corr.GEVP-271"><span class="linenos">271</span></a><span class="sd">        ```python</span>
</span><span id="Corr.GEVP-272"><a href="#Corr.GEVP-272"><span class="linenos">272</span></a><span class="sd">        C.GEVP(t0=2)[0]  # Ground state vector(s)</span>
</span><span id="Corr.GEVP-273"><a href="#Corr.GEVP-273"><span class="linenos">273</span></a><span class="sd">        C.GEVP(t0=2)[:3]  # Vectors for the lowest three states</span>
</span><span id="Corr.GEVP-274"><a href="#Corr.GEVP-274"><span class="linenos">274</span></a><span class="sd">        ```</span>
</span><span id="Corr.GEVP-275"><a href="#Corr.GEVP-275"><span class="linenos">275</span></a>
</span><span id="Corr.GEVP-276"><a href="#Corr.GEVP-276"><span class="linenos">276</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.GEVP-277"><a href="#Corr.GEVP-277"><span class="linenos">277</span></a><span class="sd">        ----------</span>
</span><span id="Corr.GEVP-278"><a href="#Corr.GEVP-278"><span class="linenos">278</span></a><span class="sd">        t0 : int</span>
</span><span id="Corr.GEVP-279"><a href="#Corr.GEVP-279"><span class="linenos">279</span></a><span class="sd">            The time t0 for the right hand side of the GEVP according to $G(t)v_i=\lambda_i G(t_0)v_i$</span>
</span><span id="Corr.GEVP-280"><a href="#Corr.GEVP-280"><span class="linenos">280</span></a><span class="sd">        ts : int</span>
</span><span id="Corr.GEVP-281"><a href="#Corr.GEVP-281"><span class="linenos">281</span></a><span class="sd">            fixed time $G(t_s)v_i=\lambda_i G(t_0)v_i$ if sort=None.</span>
</span><span id="Corr.GEVP-282"><a href="#Corr.GEVP-282"><span class="linenos">282</span></a><span class="sd">            If sort=&quot;Eigenvector&quot; it gives a reference point for the sorting method.</span>
</span><span id="Corr.GEVP-283"><a href="#Corr.GEVP-283"><span class="linenos">283</span></a><span class="sd">        sort : string</span>
</span><span id="Corr.GEVP-284"><a href="#Corr.GEVP-284"><span class="linenos">284</span></a><span class="sd">            If this argument is set, a list of self.T vectors per state is returned. If it is set to None, only one vector is returned.</span>
</span><span id="Corr.GEVP-285"><a href="#Corr.GEVP-285"><span class="linenos">285</span></a><span class="sd">            - &quot;Eigenvalue&quot;: The eigenvector is chosen according to which eigenvalue it belongs individually on every timeslice.</span>
</span><span id="Corr.GEVP-286"><a href="#Corr.GEVP-286"><span class="linenos">286</span></a><span class="sd">            - &quot;Eigenvector&quot;: Use the method described in arXiv:2004.10472 to find the set of v(t) belonging to the state.</span>
</span><span id="Corr.GEVP-287"><a href="#Corr.GEVP-287"><span class="linenos">287</span></a><span class="sd">              The reference state is identified by its eigenvalue at $t=t_s$.</span>
</span><span id="Corr.GEVP-288"><a href="#Corr.GEVP-288"><span class="linenos">288</span></a>
</span><span id="Corr.GEVP-289"><a href="#Corr.GEVP-289"><span class="linenos">289</span></a><span class="sd">        Other Parameters</span>
</span><span id="Corr.GEVP-290"><a href="#Corr.GEVP-290"><span class="linenos">290</span></a><span class="sd">        ----------------</span>
</span><span id="Corr.GEVP-291"><a href="#Corr.GEVP-291"><span class="linenos">291</span></a><span class="sd">        state : int</span>
</span><span id="Corr.GEVP-292"><a href="#Corr.GEVP-292"><span class="linenos">292</span></a><span class="sd">           Returns only the vector(s) for a specified state. The lowest state is zero.</span>
</span><span id="Corr.GEVP-293"><a href="#Corr.GEVP-293"><span class="linenos">293</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Corr.GEVP-294"><a href="#Corr.GEVP-294"><span class="linenos">294</span></a>
</span><span id="Corr.GEVP-295"><a href="#Corr.GEVP-295"><span class="linenos">295</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.GEVP-296"><a href="#Corr.GEVP-296"><span class="linenos">296</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;GEVP methods only works on correlator matrices and not single correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr.GEVP-297"><a href="#Corr.GEVP-297"><span class="linenos">297</span></a>        <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.GEVP-298"><a href="#Corr.GEVP-298"><span class="linenos">298</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="o">&lt;=</span> <span class="n">t0</span><span class="p">):</span>
</span><span id="Corr.GEVP-299"><a href="#Corr.GEVP-299"><span class="linenos">299</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ts has to be larger than t0.&quot;</span><span class="p">)</span>
</span><span id="Corr.GEVP-300"><a href="#Corr.GEVP-300"><span class="linenos">300</span></a>
</span><span id="Corr.GEVP-301"><a href="#Corr.GEVP-301"><span class="linenos">301</span></a>        <span class="k">if</span> <span class="s2">&quot;sorted_list&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Corr.GEVP-302"><a href="#Corr.GEVP-302"><span class="linenos">302</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Argument &#39;sorted_list&#39; is deprecated, use &#39;sort&#39; instead.&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
</span><span id="Corr.GEVP-303"><a href="#Corr.GEVP-303"><span class="linenos">303</span></a>            <span class="n">sort</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sorted_list&quot;</span><span class="p">)</span>
</span><span id="Corr.GEVP-304"><a href="#Corr.GEVP-304"><span class="linenos">304</span></a>
</span><span id="Corr.GEVP-305"><a href="#Corr.GEVP-305"><span class="linenos">305</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_matrix_symmetric</span><span class="p">():</span>
</span><span id="Corr.GEVP-306"><a href="#Corr.GEVP-306"><span class="linenos">306</span></a>            <span class="n">symmetric_corr</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Corr.GEVP-307"><a href="#Corr.GEVP-307"><span class="linenos">307</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.GEVP-308"><a href="#Corr.GEVP-308"><span class="linenos">308</span></a>            <span class="n">symmetric_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matrix_symmetric</span><span class="p">()</span>
</span><span id="Corr.GEVP-309"><a href="#Corr.GEVP-309"><span class="linenos">309</span></a>
</span><span id="Corr.GEVP-310"><a href="#Corr.GEVP-310"><span class="linenos">310</span></a>        <span class="k">if</span> <span class="n">sort</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.GEVP-311"><a href="#Corr.GEVP-311"><span class="linenos">311</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.GEVP-312"><a href="#Corr.GEVP-312"><span class="linenos">312</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ts is required if sort=None.&quot;</span><span class="p">)</span>
</span><span id="Corr.GEVP-313"><a href="#Corr.GEVP-313"><span class="linenos">313</span></a>            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">ts</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.GEVP-314"><a href="#Corr.GEVP-314"><span class="linenos">314</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Corr not defined at t0/ts.&quot;</span><span class="p">)</span>
</span><span id="Corr.GEVP-315"><a href="#Corr.GEVP-315"><span class="linenos">315</span></a>            <span class="n">G0</span><span class="p">,</span> <span class="n">Gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">)</span>
</span><span id="Corr.GEVP-316"><a href="#Corr.GEVP-316"><span class="linenos">316</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.GEVP-317"><a href="#Corr.GEVP-317"><span class="linenos">317</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.GEVP-318"><a href="#Corr.GEVP-318"><span class="linenos">318</span></a>                    <span class="n">G0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">t0</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="Corr.GEVP-319"><a href="#Corr.GEVP-319"><span class="linenos">319</span></a>                    <span class="n">Gt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">ts</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="Corr.GEVP-320"><a href="#Corr.GEVP-320"><span class="linenos">320</span></a>
</span><span id="Corr.GEVP-321"><a href="#Corr.GEVP-321"><span class="linenos">321</span></a>            <span class="n">reordered_vecs</span> <span class="o">=</span> <span class="n">_GEVP_solver</span><span class="p">(</span><span class="n">Gt</span><span class="p">,</span> <span class="n">G0</span><span class="p">)</span>
</span><span id="Corr.GEVP-322"><a href="#Corr.GEVP-322"><span class="linenos">322</span></a>
</span><span id="Corr.GEVP-323"><a href="#Corr.GEVP-323"><span class="linenos">323</span></a>        <span class="k">elif</span> <span class="n">sort</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Eigenvalue&quot;</span><span class="p">,</span> <span class="s2">&quot;Eigenvector&quot;</span><span class="p">]:</span>
</span><span id="Corr.GEVP-324"><a href="#Corr.GEVP-324"><span class="linenos">324</span></a>            <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;Eigenvalue&quot;</span> <span class="ow">and</span> <span class="n">ts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.GEVP-325"><a href="#Corr.GEVP-325"><span class="linenos">325</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;ts has no effect when sorting by eigenvalue is chosen.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr.GEVP-326"><a href="#Corr.GEVP-326"><span class="linenos">326</span></a>            <span class="n">all_vecs</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Corr.GEVP-327"><a href="#Corr.GEVP-327"><span class="linenos">327</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.GEVP-328"><a href="#Corr.GEVP-328"><span class="linenos">328</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Corr.GEVP-329"><a href="#Corr.GEVP-329"><span class="linenos">329</span></a>                    <span class="n">G0</span><span class="p">,</span> <span class="n">Gt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">)</span>
</span><span id="Corr.GEVP-330"><a href="#Corr.GEVP-330"><span class="linenos">330</span></a>                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.GEVP-331"><a href="#Corr.GEVP-331"><span class="linenos">331</span></a>                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.GEVP-332"><a href="#Corr.GEVP-332"><span class="linenos">332</span></a>                            <span class="n">G0</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">t0</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="Corr.GEVP-333"><a href="#Corr.GEVP-333"><span class="linenos">333</span></a>                            <span class="n">Gt</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">symmetric_corr</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
</span><span id="Corr.GEVP-334"><a href="#Corr.GEVP-334"><span class="linenos">334</span></a>
</span><span id="Corr.GEVP-335"><a href="#Corr.GEVP-335"><span class="linenos">335</span></a>                    <span class="n">all_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_GEVP_solver</span><span class="p">(</span><span class="n">Gt</span><span class="p">,</span> <span class="n">G0</span><span class="p">))</span>
</span><span id="Corr.GEVP-336"><a href="#Corr.GEVP-336"><span class="linenos">336</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="Corr.GEVP-337"><a href="#Corr.GEVP-337"><span class="linenos">337</span></a>                    <span class="n">all_vecs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.GEVP-338"><a href="#Corr.GEVP-338"><span class="linenos">338</span></a>            <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;Eigenvector&quot;</span><span class="p">:</span>
</span><span id="Corr.GEVP-339"><a href="#Corr.GEVP-339"><span class="linenos">339</span></a>                <span class="k">if</span> <span class="p">(</span><span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.GEVP-340"><a href="#Corr.GEVP-340"><span class="linenos">340</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ts is required for the Eigenvector sorting method.&quot;</span><span class="p">)</span>
</span><span id="Corr.GEVP-341"><a href="#Corr.GEVP-341"><span class="linenos">341</span></a>                <span class="n">all_vecs</span> <span class="o">=</span> <span class="n">_sort_vectors</span><span class="p">(</span><span class="n">all_vecs</span><span class="p">,</span> <span class="n">ts</span><span class="p">)</span>
</span><span id="Corr.GEVP-342"><a href="#Corr.GEVP-342"><span class="linenos">342</span></a>
</span><span id="Corr.GEVP-343"><a href="#Corr.GEVP-343"><span class="linenos">343</span></a>            <span class="n">reordered_vecs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">v</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">all_vecs</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)]</span>
</span><span id="Corr.GEVP-344"><a href="#Corr.GEVP-344"><span class="linenos">344</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.GEVP-345"><a href="#Corr.GEVP-345"><span class="linenos">345</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unkown value for &#39;sort&#39;.&quot;</span><span class="p">)</span>
</span><span id="Corr.GEVP-346"><a href="#Corr.GEVP-346"><span class="linenos">346</span></a>
</span><span id="Corr.GEVP-347"><a href="#Corr.GEVP-347"><span class="linenos">347</span></a>        <span class="k">if</span> <span class="s2">&quot;state&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Corr.GEVP-348"><a href="#Corr.GEVP-348"><span class="linenos">348</span></a>            <span class="k">return</span> <span class="n">reordered_vecs</span><span class="p">[</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)]</span>
</span><span id="Corr.GEVP-349"><a href="#Corr.GEVP-349"><span class="linenos">349</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.GEVP-350"><a href="#Corr.GEVP-350"><span class="linenos">350</span></a>            <span class="k">return</span> <span class="n">reordered_vecs</span>
</span></pre></div>


            <div class="docstring"><p>Solve the generalized eigenvalue problem on the correlator matrix and returns the corresponding eigenvectors.</p>

<p>The eigenvectors are sorted according to the descending eigenvalues, the zeroth eigenvector(s) correspond to the
largest eigenvalue(s). The eigenvector(s) for the individual states can be accessed via slicing</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">C</span><span class="o">.</span><span class="n">GEVP</span><span class="p">(</span><span class="n">t0</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Ground state vector(s)</span>
<span class="n">C</span><span class="o">.</span><span class="n">GEVP</span><span class="p">(</span><span class="n">t0</span><span class="o">=</span><span class="mi">2</span><span class="p">)[:</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># Vectors for the lowest three states</span>
</code></pre>
</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>t0</strong> (int):
The time t0 for the right hand side of the GEVP according to $G(t)v_i=\lambda_i G(t_0)v_i$</li>
<li><strong>ts</strong> (int):
fixed time $G(t_s)v_i=\lambda_i G(t_0)v_i$ if sort=None.
If sort="Eigenvector" it gives a reference point for the sorting method.</li>
<li><strong>sort</strong> (string):
If this argument is set, a list of self.T vectors per state is returned. If it is set to None, only one vector is returned.
<ul>
<li>"Eigenvalue": The eigenvector is chosen according to which eigenvalue it belongs individually on every timeslice.</li>
<li>"Eigenvector": Use the method described in arXiv:2004.10472 to find the set of v(t) belonging to the state.
The reference state is identified by its eigenvalue at $t=t_s$.</li>
</ul></li>
</ul>

<h6 id="other-parameters">Other Parameters</h6>

<ul>
<li><strong>state</strong> (int):
Returns only the vector(s) for a specified state. The lowest state is zero.</li>
</ul>
</div>


                            </div>
                            <div id="Corr.Eigenvalue" class="classattr">
                                        <input id="Corr.Eigenvalue-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">Eigenvalue</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">t0</span>, </span><span class="param"><span class="n">ts</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">state</span><span class="o">=</span><span class="mi">0</span>, </span><span class="param"><span class="n">sort</span><span class="o">=</span><span class="s1">&#39;Eigenvalue&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.Eigenvalue-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.Eigenvalue"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.Eigenvalue-352"><a href="#Corr.Eigenvalue-352"><span class="linenos">352</span></a>    <span class="k">def</span> <span class="nf">Eigenvalue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s2">&quot;Eigenvalue&quot;</span><span class="p">):</span>
</span><span id="Corr.Eigenvalue-353"><a href="#Corr.Eigenvalue-353"><span class="linenos">353</span></a>        <span class="sd">&quot;&quot;&quot;Determines the eigenvalue of the GEVP by solving and projecting the correlator</span>
</span><span id="Corr.Eigenvalue-354"><a href="#Corr.Eigenvalue-354"><span class="linenos">354</span></a>
</span><span id="Corr.Eigenvalue-355"><a href="#Corr.Eigenvalue-355"><span class="linenos">355</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.Eigenvalue-356"><a href="#Corr.Eigenvalue-356"><span class="linenos">356</span></a><span class="sd">        ----------</span>
</span><span id="Corr.Eigenvalue-357"><a href="#Corr.Eigenvalue-357"><span class="linenos">357</span></a><span class="sd">        state : int</span>
</span><span id="Corr.Eigenvalue-358"><a href="#Corr.Eigenvalue-358"><span class="linenos">358</span></a><span class="sd">            The state one is interested in ordered by energy. The lowest state is zero.</span>
</span><span id="Corr.Eigenvalue-359"><a href="#Corr.Eigenvalue-359"><span class="linenos">359</span></a>
</span><span id="Corr.Eigenvalue-360"><a href="#Corr.Eigenvalue-360"><span class="linenos">360</span></a><span class="sd">        All other parameters are identical to the ones of Corr.GEVP.</span>
</span><span id="Corr.Eigenvalue-361"><a href="#Corr.Eigenvalue-361"><span class="linenos">361</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.Eigenvalue-362"><a href="#Corr.Eigenvalue-362"><span class="linenos">362</span></a>        <span class="n">vec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GEVP</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">ts</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="n">sort</span><span class="p">)[</span><span class="n">state</span><span class="p">]</span>
</span><span id="Corr.Eigenvalue-363"><a href="#Corr.Eigenvalue-363"><span class="linenos">363</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">projected</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Determines the eigenvalue of the GEVP by solving and projecting the correlator</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>state</strong> (int):
The state one is interested in ordered by energy. The lowest state is zero.</li>
<li><strong>All other parameters are identical to the ones of <a href="#Corr.GEVP">Corr.GEVP</a>.</strong></li>
</ul>
</div>


                            </div>
                            <div id="Corr.Hankel" class="classattr">
                                        <input id="Corr.Hankel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">Hankel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">N</span>, </span><span class="param"><span class="n">periodic</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.Hankel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.Hankel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.Hankel-365"><a href="#Corr.Hankel-365"><span class="linenos">365</span></a>    <span class="k">def</span> <span class="nf">Hankel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">periodic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Corr.Hankel-366"><a href="#Corr.Hankel-366"><span class="linenos">366</span></a>        <span class="sd">&quot;&quot;&quot;Constructs an NxN Hankel matrix</span>
</span><span id="Corr.Hankel-367"><a href="#Corr.Hankel-367"><span class="linenos">367</span></a>
</span><span id="Corr.Hankel-368"><a href="#Corr.Hankel-368"><span class="linenos">368</span></a><span class="sd">        C(t) c(t+1) ... c(t+n-1)</span>
</span><span id="Corr.Hankel-369"><a href="#Corr.Hankel-369"><span class="linenos">369</span></a><span class="sd">        C(t+1) c(t+2) ... c(t+n)</span>
</span><span id="Corr.Hankel-370"><a href="#Corr.Hankel-370"><span class="linenos">370</span></a><span class="sd">        .................</span>
</span><span id="Corr.Hankel-371"><a href="#Corr.Hankel-371"><span class="linenos">371</span></a><span class="sd">        C(t+(n-1)) c(t+n) ... c(t+2(n-1))</span>
</span><span id="Corr.Hankel-372"><a href="#Corr.Hankel-372"><span class="linenos">372</span></a>
</span><span id="Corr.Hankel-373"><a href="#Corr.Hankel-373"><span class="linenos">373</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.Hankel-374"><a href="#Corr.Hankel-374"><span class="linenos">374</span></a><span class="sd">        ----------</span>
</span><span id="Corr.Hankel-375"><a href="#Corr.Hankel-375"><span class="linenos">375</span></a><span class="sd">        N : int</span>
</span><span id="Corr.Hankel-376"><a href="#Corr.Hankel-376"><span class="linenos">376</span></a><span class="sd">            Dimension of the Hankel matrix</span>
</span><span id="Corr.Hankel-377"><a href="#Corr.Hankel-377"><span class="linenos">377</span></a><span class="sd">        periodic : bool, optional</span>
</span><span id="Corr.Hankel-378"><a href="#Corr.Hankel-378"><span class="linenos">378</span></a><span class="sd">            determines whether the matrix is extended periodically</span>
</span><span id="Corr.Hankel-379"><a href="#Corr.Hankel-379"><span class="linenos">379</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.Hankel-380"><a href="#Corr.Hankel-380"><span class="linenos">380</span></a>
</span><span id="Corr.Hankel-381"><a href="#Corr.Hankel-381"><span class="linenos">381</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.Hankel-382"><a href="#Corr.Hankel-382"><span class="linenos">382</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Multi-operator Prony not implemented!&quot;</span><span class="p">)</span>
</span><span id="Corr.Hankel-383"><a href="#Corr.Hankel-383"><span class="linenos">383</span></a>
</span><span id="Corr.Hankel-384"><a href="#Corr.Hankel-384"><span class="linenos">384</span></a>        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">([</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">)</span>
</span><span id="Corr.Hankel-385"><a href="#Corr.Hankel-385"><span class="linenos">385</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.Hankel-386"><a href="#Corr.Hankel-386"><span class="linenos">386</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.Hankel-387"><a href="#Corr.Hankel-387"><span class="linenos">387</span></a>            <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>
</span><span id="Corr.Hankel-388"><a href="#Corr.Hankel-388"><span class="linenos">388</span></a>
</span><span id="Corr.Hankel-389"><a href="#Corr.Hankel-389"><span class="linenos">389</span></a>        <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="Corr.Hankel-390"><a href="#Corr.Hankel-390"><span class="linenos">390</span></a>            <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="Corr.Hankel-391"><a href="#Corr.Hankel-391"><span class="linenos">391</span></a>                <span class="n">i</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr.Hankel-392"><a href="#Corr.Hankel-392"><span class="linenos">392</span></a>            <span class="k">return</span> <span class="n">i</span>
</span><span id="Corr.Hankel-393"><a href="#Corr.Hankel-393"><span class="linenos">393</span></a>
</span><span id="Corr.Hankel-394"><a href="#Corr.Hankel-394"><span class="linenos">394</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.Hankel-395"><a href="#Corr.Hankel-395"><span class="linenos">395</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.Hankel-396"><a href="#Corr.Hankel-396"><span class="linenos">396</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
</span><span id="Corr.Hankel-397"><a href="#Corr.Hankel-397"><span class="linenos">397</span></a>                    <span class="k">if</span> <span class="n">periodic</span><span class="p">:</span>
</span><span id="Corr.Hankel-398"><a href="#Corr.Hankel-398"><span class="linenos">398</span></a>                        <span class="n">new_content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">wrap</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr.Hankel-399"><a href="#Corr.Hankel-399"><span class="linenos">399</span></a>                    <span class="k">elif</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
</span><span id="Corr.Hankel-400"><a href="#Corr.Hankel-400"><span class="linenos">400</span></a>                        <span class="n">new_content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr.Hankel-401"><a href="#Corr.Hankel-401"><span class="linenos">401</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.Hankel-402"><a href="#Corr.Hankel-402"><span class="linenos">402</span></a>                        <span class="n">new_content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr.Hankel-403"><a href="#Corr.Hankel-403"><span class="linenos">403</span></a>
</span><span id="Corr.Hankel-404"><a href="#Corr.Hankel-404"><span class="linenos">404</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Constructs an NxN Hankel matrix</p>

<p>C(t) c(t+1) ... c(t+n-1)
C(t+1) c(t+2) ... c(t+n)
.................
C(t+(n-1)) c(t+n) ... c(t+2(n-1))</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>N</strong> (int):
Dimension of the Hankel matrix</li>
<li><strong>periodic</strong> (bool, optional):
determines whether the matrix is extended periodically</li>
</ul>
</div>


                            </div>
                            <div id="Corr.roll" class="classattr">
                                        <input id="Corr.roll-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">roll</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">dt</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.roll-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.roll"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.roll-406"><a href="#Corr.roll-406"><span class="linenos">406</span></a>    <span class="k">def</span> <span class="nf">roll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dt</span><span class="p">):</span>
</span><span id="Corr.roll-407"><a href="#Corr.roll-407"><span class="linenos">407</span></a>        <span class="sd">&quot;&quot;&quot;Periodically shift the correlator by dt timeslices</span>
</span><span id="Corr.roll-408"><a href="#Corr.roll-408"><span class="linenos">408</span></a>
</span><span id="Corr.roll-409"><a href="#Corr.roll-409"><span class="linenos">409</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.roll-410"><a href="#Corr.roll-410"><span class="linenos">410</span></a><span class="sd">        ----------</span>
</span><span id="Corr.roll-411"><a href="#Corr.roll-411"><span class="linenos">411</span></a><span class="sd">        dt : int</span>
</span><span id="Corr.roll-412"><a href="#Corr.roll-412"><span class="linenos">412</span></a><span class="sd">            number of timeslices</span>
</span><span id="Corr.roll-413"><a href="#Corr.roll-413"><span class="linenos">413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.roll-414"><a href="#Corr.roll-414"><span class="linenos">414</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">),</span> <span class="n">dt</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Periodically shift the correlator by dt timeslices</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>dt</strong> (int):
number of timeslices</li>
</ul>
</div>


                            </div>
                            <div id="Corr.reverse" class="classattr">
                                        <input id="Corr.reverse-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reverse</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.reverse-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.reverse"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.reverse-416"><a href="#Corr.reverse-416"><span class="linenos">416</span></a>    <span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.reverse-417"><a href="#Corr.reverse-417"><span class="linenos">417</span></a>        <span class="sd">&quot;&quot;&quot;Reverse the time ordering of the Corr&quot;&quot;&quot;</span>
</span><span id="Corr.reverse-418"><a href="#Corr.reverse-418"><span class="linenos">418</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[::</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Reverse the time ordering of the Corr</p>
</div>


                            </div>
                            <div id="Corr.thin" class="classattr">
                                        <input id="Corr.thin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">thin</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">spacing</span><span class="o">=</span><span class="mi">2</span>, </span><span class="param"><span class="n">offset</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.thin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.thin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.thin-420"><a href="#Corr.thin-420"><span class="linenos">420</span></a>    <span class="k">def</span> <span class="nf">thin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="Corr.thin-421"><a href="#Corr.thin-421"><span class="linenos">421</span></a>        <span class="sd">&quot;&quot;&quot;Thin out a correlator to suppress correlations</span>
</span><span id="Corr.thin-422"><a href="#Corr.thin-422"><span class="linenos">422</span></a>
</span><span id="Corr.thin-423"><a href="#Corr.thin-423"><span class="linenos">423</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.thin-424"><a href="#Corr.thin-424"><span class="linenos">424</span></a><span class="sd">        ----------</span>
</span><span id="Corr.thin-425"><a href="#Corr.thin-425"><span class="linenos">425</span></a><span class="sd">        spacing : int</span>
</span><span id="Corr.thin-426"><a href="#Corr.thin-426"><span class="linenos">426</span></a><span class="sd">            Keep only every &#39;spacing&#39;th entry of the correlator</span>
</span><span id="Corr.thin-427"><a href="#Corr.thin-427"><span class="linenos">427</span></a><span class="sd">        offset : int</span>
</span><span id="Corr.thin-428"><a href="#Corr.thin-428"><span class="linenos">428</span></a><span class="sd">            Offset the equal spacing</span>
</span><span id="Corr.thin-429"><a href="#Corr.thin-429"><span class="linenos">429</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.thin-430"><a href="#Corr.thin-430"><span class="linenos">430</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.thin-431"><a href="#Corr.thin-431"><span class="linenos">431</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.thin-432"><a href="#Corr.thin-432"><span class="linenos">432</span></a>            <span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">+</span> <span class="n">t</span><span class="p">)</span> <span class="o">%</span> <span class="n">spacing</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr.thin-433"><a href="#Corr.thin-433"><span class="linenos">433</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.thin-434"><a href="#Corr.thin-434"><span class="linenos">434</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.thin-435"><a href="#Corr.thin-435"><span class="linenos">435</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="Corr.thin-436"><a href="#Corr.thin-436"><span class="linenos">436</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Thin out a correlator to suppress correlations</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>spacing</strong> (int):
Keep only every 'spacing'th entry of the correlator</li>
<li><strong>offset</strong> (int):
Offset the equal spacing</li>
</ul>
</div>


                            </div>
                            <div id="Corr.correlate" class="classattr">
                                        <input id="Corr.correlate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">correlate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">partner</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.correlate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.correlate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.correlate-438"><a href="#Corr.correlate-438"><span class="linenos">438</span></a>    <span class="k">def</span> <span class="nf">correlate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partner</span><span class="p">):</span>
</span><span id="Corr.correlate-439"><a href="#Corr.correlate-439"><span class="linenos">439</span></a>        <span class="sd">&quot;&quot;&quot;Correlate the correlator with another correlator or Obs</span>
</span><span id="Corr.correlate-440"><a href="#Corr.correlate-440"><span class="linenos">440</span></a>
</span><span id="Corr.correlate-441"><a href="#Corr.correlate-441"><span class="linenos">441</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.correlate-442"><a href="#Corr.correlate-442"><span class="linenos">442</span></a><span class="sd">        ----------</span>
</span><span id="Corr.correlate-443"><a href="#Corr.correlate-443"><span class="linenos">443</span></a><span class="sd">        partner : Obs or Corr</span>
</span><span id="Corr.correlate-444"><a href="#Corr.correlate-444"><span class="linenos">444</span></a><span class="sd">            partner to correlate the correlator with.</span>
</span><span id="Corr.correlate-445"><a href="#Corr.correlate-445"><span class="linenos">445</span></a><span class="sd">            Can either be an Obs which is correlated with all entries of the</span>
</span><span id="Corr.correlate-446"><a href="#Corr.correlate-446"><span class="linenos">446</span></a><span class="sd">            correlator or a Corr of same length.</span>
</span><span id="Corr.correlate-447"><a href="#Corr.correlate-447"><span class="linenos">447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.correlate-448"><a href="#Corr.correlate-448"><span class="linenos">448</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.correlate-449"><a href="#Corr.correlate-449"><span class="linenos">449</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only one-dimensional correlators can be safely correlated.&quot;</span><span class="p">)</span>
</span><span id="Corr.correlate-450"><a href="#Corr.correlate-450"><span class="linenos">450</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.correlate-451"><a href="#Corr.correlate-451"><span class="linenos">451</span></a>        <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">t_slice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
</span><span id="Corr.correlate-452"><a href="#Corr.correlate-452"><span class="linenos">452</span></a>            <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_slice</span><span class="p">):</span>
</span><span id="Corr.correlate-453"><a href="#Corr.correlate-453"><span class="linenos">453</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.correlate-454"><a href="#Corr.correlate-454"><span class="linenos">454</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.correlate-455"><a href="#Corr.correlate-455"><span class="linenos">455</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="Corr.correlate-456"><a href="#Corr.correlate-456"><span class="linenos">456</span></a>                    <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x0</span><span class="p">]):</span>
</span><span id="Corr.correlate-457"><a href="#Corr.correlate-457"><span class="linenos">457</span></a>                        <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.correlate-458"><a href="#Corr.correlate-458"><span class="linenos">458</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.correlate-459"><a href="#Corr.correlate-459"><span class="linenos">459</span></a>                        <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">correlate</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">t_slice</span><span class="p">]))</span>
</span><span id="Corr.correlate-460"><a href="#Corr.correlate-460"><span class="linenos">460</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">Obs</span><span class="p">):</span>  <span class="c1"># Should this include CObs?</span>
</span><span id="Corr.correlate-461"><a href="#Corr.correlate-461"><span class="linenos">461</span></a>                    <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">correlate</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">t_slice</span><span class="p">]))</span>
</span><span id="Corr.correlate-462"><a href="#Corr.correlate-462"><span class="linenos">462</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.correlate-463"><a href="#Corr.correlate-463"><span class="linenos">463</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Can only correlate with an Obs or a Corr.&quot;</span><span class="p">)</span>
</span><span id="Corr.correlate-464"><a href="#Corr.correlate-464"><span class="linenos">464</span></a>
</span><span id="Corr.correlate-465"><a href="#Corr.correlate-465"><span class="linenos">465</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Correlate the correlator with another correlator or Obs</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>partner</strong> (Obs or Corr):
partner to correlate the correlator with.
Can either be an Obs which is correlated with all entries of the
correlator or a Corr of same length.</li>
</ul>
</div>


                            </div>
                            <div id="Corr.reweight" class="classattr">
                                        <input id="Corr.reweight-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reweight</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">weight</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.reweight-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.reweight"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.reweight-467"><a href="#Corr.reweight-467"><span class="linenos">467</span></a>    <span class="k">def</span> <span class="nf">reweight</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr.reweight-468"><a href="#Corr.reweight-468"><span class="linenos">468</span></a>        <span class="sd">&quot;&quot;&quot;Reweight the correlator.</span>
</span><span id="Corr.reweight-469"><a href="#Corr.reweight-469"><span class="linenos">469</span></a>
</span><span id="Corr.reweight-470"><a href="#Corr.reweight-470"><span class="linenos">470</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.reweight-471"><a href="#Corr.reweight-471"><span class="linenos">471</span></a><span class="sd">        ----------</span>
</span><span id="Corr.reweight-472"><a href="#Corr.reweight-472"><span class="linenos">472</span></a><span class="sd">        weight : Obs</span>
</span><span id="Corr.reweight-473"><a href="#Corr.reweight-473"><span class="linenos">473</span></a><span class="sd">            Reweighting factor. An Observable that has to be defined on a superset of the</span>
</span><span id="Corr.reweight-474"><a href="#Corr.reweight-474"><span class="linenos">474</span></a><span class="sd">            configurations in obs[i].idl for all i.</span>
</span><span id="Corr.reweight-475"><a href="#Corr.reweight-475"><span class="linenos">475</span></a><span class="sd">        all_configs : bool</span>
</span><span id="Corr.reweight-476"><a href="#Corr.reweight-476"><span class="linenos">476</span></a><span class="sd">            if True, the reweighted observables are normalized by the average of</span>
</span><span id="Corr.reweight-477"><a href="#Corr.reweight-477"><span class="linenos">477</span></a><span class="sd">            the reweighting factor on all configurations in weight.idl and not</span>
</span><span id="Corr.reweight-478"><a href="#Corr.reweight-478"><span class="linenos">478</span></a><span class="sd">            on the configurations in obs[i].idl.</span>
</span><span id="Corr.reweight-479"><a href="#Corr.reweight-479"><span class="linenos">479</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.reweight-480"><a href="#Corr.reweight-480"><span class="linenos">480</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.reweight-481"><a href="#Corr.reweight-481"><span class="linenos">481</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Reweighting only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr.reweight-482"><a href="#Corr.reweight-482"><span class="linenos">482</span></a>        <span class="n">new_content</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.reweight-483"><a href="#Corr.reweight-483"><span class="linenos">483</span></a>        <span class="k">for</span> <span class="n">t_slice</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
</span><span id="Corr.reweight-484"><a href="#Corr.reweight-484"><span class="linenos">484</span></a>            <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t_slice</span><span class="p">):</span>
</span><span id="Corr.reweight-485"><a href="#Corr.reweight-485"><span class="linenos">485</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.reweight-486"><a href="#Corr.reweight-486"><span class="linenos">486</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.reweight-487"><a href="#Corr.reweight-487"><span class="linenos">487</span></a>                <span class="n">new_content</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reweight</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">t_slice</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)))</span>
</span><span id="Corr.reweight-488"><a href="#Corr.reweight-488"><span class="linenos">488</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">new_content</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Reweight the correlator.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>weight</strong> (Obs):
Reweighting factor. An Observable that has to be defined on a superset of the
configurations in obs[i].idl for all i.</li>
<li><strong>all_configs</strong> (bool):
if True, the reweighted observables are normalized by the average of
the reweighting factor on all configurations in weight.idl and not
on the configurations in obs[i].idl.</li>
</ul>
</div>


                            </div>
                            <div id="Corr.T_symmetry" class="classattr">
                                        <input id="Corr.T_symmetry-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">T_symmetry</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">partner</span>, </span><span class="param"><span class="n">parity</span><span class="o">=</span><span class="mi">1</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.T_symmetry-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.T_symmetry"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.T_symmetry-490"><a href="#Corr.T_symmetry-490"><span class="linenos">490</span></a>    <span class="k">def</span> <span class="nf">T_symmetry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">partner</span><span class="p">,</span> <span class="n">parity</span><span class="o">=+</span><span class="mi">1</span><span class="p">):</span>
</span><span id="Corr.T_symmetry-491"><a href="#Corr.T_symmetry-491"><span class="linenos">491</span></a>        <span class="sd">&quot;&quot;&quot;Return the time symmetry average of the correlator and its partner</span>
</span><span id="Corr.T_symmetry-492"><a href="#Corr.T_symmetry-492"><span class="linenos">492</span></a>
</span><span id="Corr.T_symmetry-493"><a href="#Corr.T_symmetry-493"><span class="linenos">493</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.T_symmetry-494"><a href="#Corr.T_symmetry-494"><span class="linenos">494</span></a><span class="sd">        ----------</span>
</span><span id="Corr.T_symmetry-495"><a href="#Corr.T_symmetry-495"><span class="linenos">495</span></a><span class="sd">        partner : Corr</span>
</span><span id="Corr.T_symmetry-496"><a href="#Corr.T_symmetry-496"><span class="linenos">496</span></a><span class="sd">            Time symmetry partner of the Corr</span>
</span><span id="Corr.T_symmetry-497"><a href="#Corr.T_symmetry-497"><span class="linenos">497</span></a><span class="sd">        partity : int</span>
</span><span id="Corr.T_symmetry-498"><a href="#Corr.T_symmetry-498"><span class="linenos">498</span></a><span class="sd">            Parity quantum number of the correlator, can be +1 or -1</span>
</span><span id="Corr.T_symmetry-499"><a href="#Corr.T_symmetry-499"><span class="linenos">499</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.T_symmetry-500"><a href="#Corr.T_symmetry-500"><span class="linenos">500</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.T_symmetry-501"><a href="#Corr.T_symmetry-501"><span class="linenos">501</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;T_symmetry only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr.T_symmetry-502"><a href="#Corr.T_symmetry-502"><span class="linenos">502</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="n">Corr</span><span class="p">):</span>
</span><span id="Corr.T_symmetry-503"><a href="#Corr.T_symmetry-503"><span class="linenos">503</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;T partner has to be a Corr object.&quot;</span><span class="p">)</span>
</span><span id="Corr.T_symmetry-504"><a href="#Corr.T_symmetry-504"><span class="linenos">504</span></a>        <span class="k">if</span> <span class="n">parity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="Corr.T_symmetry-505"><a href="#Corr.T_symmetry-505"><span class="linenos">505</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Parity has to be +1 or -1.&quot;</span><span class="p">)</span>
</span><span id="Corr.T_symmetry-506"><a href="#Corr.T_symmetry-506"><span class="linenos">506</span></a>        <span class="n">T_partner</span> <span class="o">=</span> <span class="n">parity</span> <span class="o">*</span> <span class="n">partner</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
</span><span id="Corr.T_symmetry-507"><a href="#Corr.T_symmetry-507"><span class="linenos">507</span></a>
</span><span id="Corr.T_symmetry-508"><a href="#Corr.T_symmetry-508"><span class="linenos">508</span></a>        <span class="n">t_slices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.T_symmetry-509"><a href="#Corr.T_symmetry-509"><span class="linenos">509</span></a>        <span class="n">test</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span> <span class="o">-</span> <span class="n">T_partner</span><span class="p">)</span>
</span><span id="Corr.T_symmetry-510"><a href="#Corr.T_symmetry-510"><span class="linenos">510</span></a>        <span class="n">test</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr.T_symmetry-511"><a href="#Corr.T_symmetry-511"><span class="linenos">511</span></a>        <span class="k">for</span> <span class="n">x0</span><span class="p">,</span> <span class="n">t_slice</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">content</span><span class="p">):</span>
</span><span id="Corr.T_symmetry-512"><a href="#Corr.T_symmetry-512"><span class="linenos">512</span></a>            <span class="k">if</span> <span class="n">t_slice</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.T_symmetry-513"><a href="#Corr.T_symmetry-513"><span class="linenos">513</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">t_slice</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">is_zero_within_error</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span><span id="Corr.T_symmetry-514"><a href="#Corr.T_symmetry-514"><span class="linenos">514</span></a>                    <span class="n">t_slices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
</span><span id="Corr.T_symmetry-515"><a href="#Corr.T_symmetry-515"><span class="linenos">515</span></a>        <span class="k">if</span> <span class="n">t_slices</span><span class="p">:</span>
</span><span id="Corr.T_symmetry-516"><a href="#Corr.T_symmetry-516"><span class="linenos">516</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;T symmetry partners do not agree within 5 sigma on time slices &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">t_slices</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="ne">RuntimeWarning</span><span class="p">)</span>
</span><span id="Corr.T_symmetry-517"><a href="#Corr.T_symmetry-517"><span class="linenos">517</span></a>
</span><span id="Corr.T_symmetry-518"><a href="#Corr.T_symmetry-518"><span class="linenos">518</span></a>        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">+</span> <span class="n">T_partner</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span></pre></div>


            <div class="docstring"><p>Return the time symmetry average of the correlator and its partner</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>partner</strong> (Corr):
Time symmetry partner of the Corr</li>
<li><strong>partity</strong> (int):
Parity quantum number of the correlator, can be +1 or -1</li>
</ul>
</div>


                            </div>
                            <div id="Corr.deriv" class="classattr">
                                        <input id="Corr.deriv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">deriv</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">variant</span><span class="o">=</span><span class="s1">&#39;symmetric&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.deriv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.deriv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.deriv-520"><a href="#Corr.deriv-520"><span class="linenos">520</span></a>    <span class="k">def</span> <span class="nf">deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;symmetric&quot;</span><span class="p">):</span>
</span><span id="Corr.deriv-521"><a href="#Corr.deriv-521"><span class="linenos">521</span></a>        <span class="sd">&quot;&quot;&quot;Return the first derivative of the correlator with respect to x0.</span>
</span><span id="Corr.deriv-522"><a href="#Corr.deriv-522"><span class="linenos">522</span></a>
</span><span id="Corr.deriv-523"><a href="#Corr.deriv-523"><span class="linenos">523</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.deriv-524"><a href="#Corr.deriv-524"><span class="linenos">524</span></a><span class="sd">        ----------</span>
</span><span id="Corr.deriv-525"><a href="#Corr.deriv-525"><span class="linenos">525</span></a><span class="sd">        variant : str</span>
</span><span id="Corr.deriv-526"><a href="#Corr.deriv-526"><span class="linenos">526</span></a><span class="sd">            decides which definition of the finite differences derivative is used.</span>
</span><span id="Corr.deriv-527"><a href="#Corr.deriv-527"><span class="linenos">527</span></a><span class="sd">            Available choice: symmetric, forward, backward, improved, log, default: symmetric</span>
</span><span id="Corr.deriv-528"><a href="#Corr.deriv-528"><span class="linenos">528</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.deriv-529"><a href="#Corr.deriv-529"><span class="linenos">529</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.deriv-530"><a href="#Corr.deriv-530"><span class="linenos">530</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;deriv only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr.deriv-531"><a href="#Corr.deriv-531"><span class="linenos">531</span></a>        <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;symmetric&quot;</span><span class="p">:</span>
</span><span id="Corr.deriv-532"><a href="#Corr.deriv-532"><span class="linenos">532</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.deriv-533"><a href="#Corr.deriv-533"><span class="linenos">533</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr.deriv-534"><a href="#Corr.deriv-534"><span class="linenos">534</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.deriv-535"><a href="#Corr.deriv-535"><span class="linenos">535</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.deriv-536"><a href="#Corr.deriv-536"><span class="linenos">536</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.deriv-537"><a href="#Corr.deriv-537"><span class="linenos">537</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Corr.deriv-538"><a href="#Corr.deriv-538"><span class="linenos">538</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.deriv-539"><a href="#Corr.deriv-539"><span class="linenos">539</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Derivative is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr.deriv-540"><a href="#Corr.deriv-540"><span class="linenos">540</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr.deriv-541"><a href="#Corr.deriv-541"><span class="linenos">541</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;forward&quot;</span><span class="p">:</span>
</span><span id="Corr.deriv-542"><a href="#Corr.deriv-542"><span class="linenos">542</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.deriv-543"><a href="#Corr.deriv-543"><span class="linenos">543</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr.deriv-544"><a href="#Corr.deriv-544"><span class="linenos">544</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.deriv-545"><a href="#Corr.deriv-545"><span class="linenos">545</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.deriv-546"><a href="#Corr.deriv-546"><span class="linenos">546</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.deriv-547"><a href="#Corr.deriv-547"><span class="linenos">547</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
</span><span id="Corr.deriv-548"><a href="#Corr.deriv-548"><span class="linenos">548</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.deriv-549"><a href="#Corr.deriv-549"><span class="linenos">549</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr.deriv-550"><a href="#Corr.deriv-550"><span class="linenos">550</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr.deriv-551"><a href="#Corr.deriv-551"><span class="linenos">551</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;backward&quot;</span><span class="p">:</span>
</span><span id="Corr.deriv-552"><a href="#Corr.deriv-552"><span class="linenos">552</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.deriv-553"><a href="#Corr.deriv-553"><span class="linenos">553</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.deriv-554"><a href="#Corr.deriv-554"><span class="linenos">554</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.deriv-555"><a href="#Corr.deriv-555"><span class="linenos">555</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.deriv-556"><a href="#Corr.deriv-556"><span class="linenos">556</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.deriv-557"><a href="#Corr.deriv-557"><span class="linenos">557</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr.deriv-558"><a href="#Corr.deriv-558"><span class="linenos">558</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.deriv-559"><a href="#Corr.deriv-559"><span class="linenos">559</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr.deriv-560"><a href="#Corr.deriv-560"><span class="linenos">560</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="Corr.deriv-561"><a href="#Corr.deriv-561"><span class="linenos">561</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;improved&quot;</span><span class="p">:</span>
</span><span id="Corr.deriv-562"><a href="#Corr.deriv-562"><span class="linenos">562</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.deriv-563"><a href="#Corr.deriv-563"><span class="linenos">563</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="Corr.deriv-564"><a href="#Corr.deriv-564"><span class="linenos">564</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.deriv-565"><a href="#Corr.deriv-565"><span class="linenos">565</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.deriv-566"><a href="#Corr.deriv-566"><span class="linenos">566</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.deriv-567"><a href="#Corr.deriv-567"><span class="linenos">567</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]))</span>
</span><span id="Corr.deriv-568"><a href="#Corr.deriv-568"><span class="linenos">568</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.deriv-569"><a href="#Corr.deriv-569"><span class="linenos">569</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Derivative is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr.deriv-570"><a href="#Corr.deriv-570"><span class="linenos">570</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Corr.deriv-571"><a href="#Corr.deriv-571"><span class="linenos">571</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
</span><span id="Corr.deriv-572"><a href="#Corr.deriv-572"><span class="linenos">572</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.deriv-573"><a href="#Corr.deriv-573"><span class="linenos">573</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.deriv-574"><a href="#Corr.deriv-574"><span class="linenos">574</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr.deriv-575"><a href="#Corr.deriv-575"><span class="linenos">575</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.deriv-576"><a href="#Corr.deriv-576"><span class="linenos">576</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.deriv-577"><a href="#Corr.deriv-577"><span class="linenos">577</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
</span><span id="Corr.deriv-578"><a href="#Corr.deriv-578"><span class="linenos">578</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.deriv-579"><a href="#Corr.deriv-579"><span class="linenos">579</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Log is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr.deriv-580"><a href="#Corr.deriv-580"><span class="linenos">580</span></a>            <span class="n">logcorr</span> <span class="o">=</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr.deriv-581"><a href="#Corr.deriv-581"><span class="linenos">581</span></a>            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="n">logcorr</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="s1">&#39;symmetric&#39;</span><span class="p">)</span>
</span><span id="Corr.deriv-582"><a href="#Corr.deriv-582"><span class="linenos">582</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.deriv-583"><a href="#Corr.deriv-583"><span class="linenos">583</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown variant.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the first derivative of the correlator with respect to x0.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>variant</strong> (str):
decides which definition of the finite differences derivative is used.
Available choice: symmetric, forward, backward, improved, log, default: symmetric</li>
</ul>
</div>


                            </div>
                            <div id="Corr.second_deriv" class="classattr">
                                        <input id="Corr.second_deriv-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">second_deriv</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">variant</span><span class="o">=</span><span class="s1">&#39;symmetric&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.second_deriv-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.second_deriv"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.second_deriv-585"><a href="#Corr.second_deriv-585"><span class="linenos">585</span></a>    <span class="k">def</span> <span class="nf">second_deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s2">&quot;symmetric&quot;</span><span class="p">):</span>
</span><span id="Corr.second_deriv-586"><a href="#Corr.second_deriv-586"><span class="linenos">586</span></a>        <span class="sd">&quot;&quot;&quot;Return the second derivative of the correlator with respect to x0.</span>
</span><span id="Corr.second_deriv-587"><a href="#Corr.second_deriv-587"><span class="linenos">587</span></a>
</span><span id="Corr.second_deriv-588"><a href="#Corr.second_deriv-588"><span class="linenos">588</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.second_deriv-589"><a href="#Corr.second_deriv-589"><span class="linenos">589</span></a><span class="sd">        ----------</span>
</span><span id="Corr.second_deriv-590"><a href="#Corr.second_deriv-590"><span class="linenos">590</span></a><span class="sd">        variant : str</span>
</span><span id="Corr.second_deriv-591"><a href="#Corr.second_deriv-591"><span class="linenos">591</span></a><span class="sd">            decides which definition of the finite differences derivative is used.</span>
</span><span id="Corr.second_deriv-592"><a href="#Corr.second_deriv-592"><span class="linenos">592</span></a><span class="sd">            Available choice: symmetric, improved, log, default: symmetric</span>
</span><span id="Corr.second_deriv-593"><a href="#Corr.second_deriv-593"><span class="linenos">593</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.second_deriv-594"><a href="#Corr.second_deriv-594"><span class="linenos">594</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.second_deriv-595"><a href="#Corr.second_deriv-595"><span class="linenos">595</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;second_deriv only implemented for one-dimensional correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr.second_deriv-596"><a href="#Corr.second_deriv-596"><span class="linenos">596</span></a>        <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;symmetric&quot;</span><span class="p">:</span>
</span><span id="Corr.second_deriv-597"><a href="#Corr.second_deriv-597"><span class="linenos">597</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.second_deriv-598"><a href="#Corr.second_deriv-598"><span class="linenos">598</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr.second_deriv-599"><a href="#Corr.second_deriv-599"><span class="linenos">599</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.second_deriv-600"><a href="#Corr.second_deriv-600"><span class="linenos">600</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.second_deriv-601"><a href="#Corr.second_deriv-601"><span class="linenos">601</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.second_deriv-602"><a href="#Corr.second_deriv-602"><span class="linenos">602</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Corr.second_deriv-603"><a href="#Corr.second_deriv-603"><span class="linenos">603</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.second_deriv-604"><a href="#Corr.second_deriv-604"><span class="linenos">604</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr.second_deriv-605"><a href="#Corr.second_deriv-605"><span class="linenos">605</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr.second_deriv-606"><a href="#Corr.second_deriv-606"><span class="linenos">606</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s2">&quot;improved&quot;</span><span class="p">:</span>
</span><span id="Corr.second_deriv-607"><a href="#Corr.second_deriv-607"><span class="linenos">607</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.second_deriv-608"><a href="#Corr.second_deriv-608"><span class="linenos">608</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
</span><span id="Corr.second_deriv-609"><a href="#Corr.second_deriv-609"><span class="linenos">609</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.second_deriv-610"><a href="#Corr.second_deriv-610"><span class="linenos">610</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.second_deriv-611"><a href="#Corr.second_deriv-611"><span class="linenos">611</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.second_deriv-612"><a href="#Corr.second_deriv-612"><span class="linenos">612</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">30</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]))</span>
</span><span id="Corr.second_deriv-613"><a href="#Corr.second_deriv-613"><span class="linenos">613</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.second_deriv-614"><a href="#Corr.second_deriv-614"><span class="linenos">614</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Derivative is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr.second_deriv-615"><a href="#Corr.second_deriv-615"><span class="linenos">615</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</span><span id="Corr.second_deriv-616"><a href="#Corr.second_deriv-616"><span class="linenos">616</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
</span><span id="Corr.second_deriv-617"><a href="#Corr.second_deriv-617"><span class="linenos">617</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.second_deriv-618"><a href="#Corr.second_deriv-618"><span class="linenos">618</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.second_deriv-619"><a href="#Corr.second_deriv-619"><span class="linenos">619</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr.second_deriv-620"><a href="#Corr.second_deriv-620"><span class="linenos">620</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.second_deriv-621"><a href="#Corr.second_deriv-621"><span class="linenos">621</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.second_deriv-622"><a href="#Corr.second_deriv-622"><span class="linenos">622</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
</span><span id="Corr.second_deriv-623"><a href="#Corr.second_deriv-623"><span class="linenos">623</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.second_deriv-624"><a href="#Corr.second_deriv-624"><span class="linenos">624</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Log is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr.second_deriv-625"><a href="#Corr.second_deriv-625"><span class="linenos">625</span></a>            <span class="n">logcorr</span> <span class="o">=</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span><span id="Corr.second_deriv-626"><a href="#Corr.second_deriv-626"><span class="linenos">626</span></a>            <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="p">(</span><span class="n">logcorr</span><span class="o">.</span><span class="n">second_deriv</span><span class="p">(</span><span class="s1">&#39;symmetric&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">logcorr</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="s1">&#39;symmetric&#39;</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Corr.second_deriv-627"><a href="#Corr.second_deriv-627"><span class="linenos">627</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.second_deriv-628"><a href="#Corr.second_deriv-628"><span class="linenos">628</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown variant.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the second derivative of the correlator with respect to x0.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>variant</strong> (str):
decides which definition of the finite differences derivative is used.
Available choice: symmetric, improved, log, default: symmetric</li>
</ul>
</div>


                            </div>
                            <div id="Corr.m_eff" class="classattr">
                                        <input id="Corr.m_eff-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">m_eff</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">variant</span><span class="o">=</span><span class="s1">&#39;log&#39;</span>, </span><span class="param"><span class="n">guess</span><span class="o">=</span><span class="mf">1.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.m_eff-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.m_eff"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.m_eff-630"><a href="#Corr.m_eff-630"><span class="linenos">630</span></a>    <span class="k">def</span> <span class="nf">m_eff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
</span><span id="Corr.m_eff-631"><a href="#Corr.m_eff-631"><span class="linenos">631</span></a>        <span class="sd">&quot;&quot;&quot;Returns the effective mass of the correlator as correlator object</span>
</span><span id="Corr.m_eff-632"><a href="#Corr.m_eff-632"><span class="linenos">632</span></a>
</span><span id="Corr.m_eff-633"><a href="#Corr.m_eff-633"><span class="linenos">633</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.m_eff-634"><a href="#Corr.m_eff-634"><span class="linenos">634</span></a><span class="sd">        ----------</span>
</span><span id="Corr.m_eff-635"><a href="#Corr.m_eff-635"><span class="linenos">635</span></a><span class="sd">        variant : str</span>
</span><span id="Corr.m_eff-636"><a href="#Corr.m_eff-636"><span class="linenos">636</span></a><span class="sd">            log : uses the standard effective mass log(C(t) / C(t+1))</span>
</span><span id="Corr.m_eff-637"><a href="#Corr.m_eff-637"><span class="linenos">637</span></a><span class="sd">            cosh, periodic : Use periodicitiy of the correlator by solving C(t) / C(t+1) = cosh(m * (t - T/2)) / cosh(m * (t + 1 - T/2)) for m.</span>
</span><span id="Corr.m_eff-638"><a href="#Corr.m_eff-638"><span class="linenos">638</span></a><span class="sd">            sinh : Use anti-periodicitiy of the correlator by solving C(t) / C(t+1) = sinh(m * (t - T/2)) / sinh(m * (t + 1 - T/2)) for m.</span>
</span><span id="Corr.m_eff-639"><a href="#Corr.m_eff-639"><span class="linenos">639</span></a><span class="sd">            See, e.g., arXiv:1205.5380</span>
</span><span id="Corr.m_eff-640"><a href="#Corr.m_eff-640"><span class="linenos">640</span></a><span class="sd">            arccosh : Uses the explicit form of the symmetrized correlator (not recommended)</span>
</span><span id="Corr.m_eff-641"><a href="#Corr.m_eff-641"><span class="linenos">641</span></a><span class="sd">            logsym: uses the symmetric effective mass log(C(t-1) / C(t+1))/2</span>
</span><span id="Corr.m_eff-642"><a href="#Corr.m_eff-642"><span class="linenos">642</span></a><span class="sd">        guess : float</span>
</span><span id="Corr.m_eff-643"><a href="#Corr.m_eff-643"><span class="linenos">643</span></a><span class="sd">            guess for the root finder, only relevant for the root variant</span>
</span><span id="Corr.m_eff-644"><a href="#Corr.m_eff-644"><span class="linenos">644</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.m_eff-645"><a href="#Corr.m_eff-645"><span class="linenos">645</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.m_eff-646"><a href="#Corr.m_eff-646"><span class="linenos">646</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Correlator must be projected before getting m_eff&#39;</span><span class="p">)</span>
</span><span id="Corr.m_eff-647"><a href="#Corr.m_eff-647"><span class="linenos">647</span></a>        <span class="k">if</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
</span><span id="Corr.m_eff-648"><a href="#Corr.m_eff-648"><span class="linenos">648</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.m_eff-649"><a href="#Corr.m_eff-649"><span class="linenos">649</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr.m_eff-650"><a href="#Corr.m_eff-650"><span class="linenos">650</span></a>                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr.m_eff-651"><a href="#Corr.m_eff-651"><span class="linenos">651</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.m_eff-652"><a href="#Corr.m_eff-652"><span class="linenos">652</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr.m_eff-653"><a href="#Corr.m_eff-653"><span class="linenos">653</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.m_eff-654"><a href="#Corr.m_eff-654"><span class="linenos">654</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.m_eff-655"><a href="#Corr.m_eff-655"><span class="linenos">655</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr.m_eff-656"><a href="#Corr.m_eff-656"><span class="linenos">656</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.m_eff-657"><a href="#Corr.m_eff-657"><span class="linenos">657</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;m_eff is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr.m_eff-658"><a href="#Corr.m_eff-658"><span class="linenos">658</span></a>
</span><span id="Corr.m_eff-659"><a href="#Corr.m_eff-659"><span class="linenos">659</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Corr.m_eff-660"><a href="#Corr.m_eff-660"><span class="linenos">660</span></a>
</span><span id="Corr.m_eff-661"><a href="#Corr.m_eff-661"><span class="linenos">661</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;logsym&#39;</span><span class="p">:</span>
</span><span id="Corr.m_eff-662"><a href="#Corr.m_eff-662"><span class="linenos">662</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.m_eff-663"><a href="#Corr.m_eff-663"><span class="linenos">663</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr.m_eff-664"><a href="#Corr.m_eff-664"><span class="linenos">664</span></a>                <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr.m_eff-665"><a href="#Corr.m_eff-665"><span class="linenos">665</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.m_eff-666"><a href="#Corr.m_eff-666"><span class="linenos">666</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr.m_eff-667"><a href="#Corr.m_eff-667"><span class="linenos">667</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.m_eff-668"><a href="#Corr.m_eff-668"><span class="linenos">668</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.m_eff-669"><a href="#Corr.m_eff-669"><span class="linenos">669</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr.m_eff-670"><a href="#Corr.m_eff-670"><span class="linenos">670</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.m_eff-671"><a href="#Corr.m_eff-671"><span class="linenos">671</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;m_eff is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr.m_eff-672"><a href="#Corr.m_eff-672"><span class="linenos">672</span></a>
</span><span id="Corr.m_eff-673"><a href="#Corr.m_eff-673"><span class="linenos">673</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="Corr.m_eff-674"><a href="#Corr.m_eff-674"><span class="linenos">674</span></a>
</span><span id="Corr.m_eff-675"><a href="#Corr.m_eff-675"><span class="linenos">675</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">,</span> <span class="s1">&#39;sinh&#39;</span><span class="p">]:</span>
</span><span id="Corr.m_eff-676"><a href="#Corr.m_eff-676"><span class="linenos">676</span></a>            <span class="k">if</span> <span class="n">variant</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;periodic&#39;</span><span class="p">,</span> <span class="s1">&#39;cosh&#39;</span><span class="p">]:</span>
</span><span id="Corr.m_eff-677"><a href="#Corr.m_eff-677"><span class="linenos">677</span></a>                <span class="n">func</span> <span class="o">=</span> <span class="n">anp</span><span class="o">.</span><span class="n">cosh</span>
</span><span id="Corr.m_eff-678"><a href="#Corr.m_eff-678"><span class="linenos">678</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.m_eff-679"><a href="#Corr.m_eff-679"><span class="linenos">679</span></a>                <span class="n">func</span> <span class="o">=</span> <span class="n">anp</span><span class="o">.</span><span class="n">sinh</span>
</span><span id="Corr.m_eff-680"><a href="#Corr.m_eff-680"><span class="linenos">680</span></a>
</span><span id="Corr.m_eff-681"><a href="#Corr.m_eff-681"><span class="linenos">681</span></a>            <span class="k">def</span> <span class="nf">root_function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
</span><span id="Corr.m_eff-682"><a href="#Corr.m_eff-682"><span class="linenos">682</span></a>                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">/</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">d</span>
</span><span id="Corr.m_eff-683"><a href="#Corr.m_eff-683"><span class="linenos">683</span></a>
</span><span id="Corr.m_eff-684"><a href="#Corr.m_eff-684"><span class="linenos">684</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.m_eff-685"><a href="#Corr.m_eff-685"><span class="linenos">685</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr.m_eff-686"><a href="#Corr.m_eff-686"><span class="linenos">686</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr.m_eff-687"><a href="#Corr.m_eff-687"><span class="linenos">687</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.m_eff-688"><a href="#Corr.m_eff-688"><span class="linenos">688</span></a>                <span class="c1"># Fill the two timeslices in the middle of the lattice with their predecessors</span>
</span><span id="Corr.m_eff-689"><a href="#Corr.m_eff-689"><span class="linenos">689</span></a>                <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;sinh&#39;</span> <span class="ow">and</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
</span><span id="Corr.m_eff-690"><a href="#Corr.m_eff-690"><span class="linenos">690</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newcontent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Corr.m_eff-691"><a href="#Corr.m_eff-691"><span class="linenos">691</span></a>                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Corr.m_eff-692"><a href="#Corr.m_eff-692"><span class="linenos">692</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.m_eff-693"><a href="#Corr.m_eff-693"><span class="linenos">693</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.m_eff-694"><a href="#Corr.m_eff-694"><span class="linenos">694</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">find_root</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">root_function</span><span class="p">,</span> <span class="n">guess</span><span class="o">=</span><span class="n">guess</span><span class="p">)))</span>
</span><span id="Corr.m_eff-695"><a href="#Corr.m_eff-695"><span class="linenos">695</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.m_eff-696"><a href="#Corr.m_eff-696"><span class="linenos">696</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;m_eff is undefined at all timeslices&#39;</span><span class="p">)</span>
</span><span id="Corr.m_eff-697"><a href="#Corr.m_eff-697"><span class="linenos">697</span></a>
</span><span id="Corr.m_eff-698"><a href="#Corr.m_eff-698"><span class="linenos">698</span></a>            <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
</span><span id="Corr.m_eff-699"><a href="#Corr.m_eff-699"><span class="linenos">699</span></a>
</span><span id="Corr.m_eff-700"><a href="#Corr.m_eff-700"><span class="linenos">700</span></a>        <span class="k">elif</span> <span class="n">variant</span> <span class="o">==</span> <span class="s1">&#39;arccosh&#39;</span><span class="p">:</span>
</span><span id="Corr.m_eff-701"><a href="#Corr.m_eff-701"><span class="linenos">701</span></a>            <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.m_eff-702"><a href="#Corr.m_eff-702"><span class="linenos">702</span></a>            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Corr.m_eff-703"><a href="#Corr.m_eff-703"><span class="linenos">703</span></a>                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
</span><span id="Corr.m_eff-704"><a href="#Corr.m_eff-704"><span class="linenos">704</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
</span><span id="Corr.m_eff-705"><a href="#Corr.m_eff-705"><span class="linenos">705</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.m_eff-706"><a href="#Corr.m_eff-706"><span class="linenos">706</span></a>                    <span class="n">newcontent</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]))</span>
</span><span id="Corr.m_eff-707"><a href="#Corr.m_eff-707"><span class="linenos">707</span></a>            <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">newcontent</span><span class="p">])):</span>
</span><span id="Corr.m_eff-708"><a href="#Corr.m_eff-708"><span class="linenos">708</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;m_eff is undefined at all timeslices&quot;</span><span class="p">)</span>
</span><span id="Corr.m_eff-709"><a href="#Corr.m_eff-709"><span class="linenos">709</span></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arccosh</span><span class="p">(</span><span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>
</span><span id="Corr.m_eff-710"><a href="#Corr.m_eff-710"><span class="linenos">710</span></a>
</span><span id="Corr.m_eff-711"><a href="#Corr.m_eff-711"><span class="linenos">711</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.m_eff-712"><a href="#Corr.m_eff-712"><span class="linenos">712</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unknown variant.&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns the effective mass of the correlator as correlator object</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>variant</strong> (str):
log : uses the standard effective mass log(C(t) / C(t+1))
cosh, periodic : Use periodicitiy of the correlator by solving C(t) / C(t+1) = cosh(m * (t - T/2)) / cosh(m * (t + 1 - T/2)) for m.
sinh : Use anti-periodicitiy of the correlator by solving C(t) / C(t+1) = sinh(m * (t - T/2)) / sinh(m * (t + 1 - T/2)) for m.
See, e.g., arXiv:1205.5380
arccosh : Uses the explicit form of the symmetrized correlator (not recommended)
logsym: uses the symmetric effective mass log(C(t-1) / C(t+1))/2</li>
<li><strong>guess</strong> (float):
guess for the root finder, only relevant for the root variant</li>
</ul>
</div>


                            </div>
                            <div id="Corr.fit" class="classattr">
                                        <input id="Corr.fit-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">fit</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">function</span>, </span><span class="param"><span class="n">fitrange</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">silent</span><span class="o">=</span><span class="kc">False</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.fit-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.fit"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.fit-714"><a href="#Corr.fit-714"><span class="linenos">714</span></a>    <span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">fitrange</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr.fit-715"><a href="#Corr.fit-715"><span class="linenos">715</span></a>        <span class="sa">r</span><span class="sd">&#39;&#39;&#39;Fits function to the data</span>
</span><span id="Corr.fit-716"><a href="#Corr.fit-716"><span class="linenos">716</span></a>
</span><span id="Corr.fit-717"><a href="#Corr.fit-717"><span class="linenos">717</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.fit-718"><a href="#Corr.fit-718"><span class="linenos">718</span></a><span class="sd">        ----------</span>
</span><span id="Corr.fit-719"><a href="#Corr.fit-719"><span class="linenos">719</span></a><span class="sd">        function : obj</span>
</span><span id="Corr.fit-720"><a href="#Corr.fit-720"><span class="linenos">720</span></a><span class="sd">            function to fit to the data. See fits.least_squares for details.</span>
</span><span id="Corr.fit-721"><a href="#Corr.fit-721"><span class="linenos">721</span></a><span class="sd">        fitrange : list</span>
</span><span id="Corr.fit-722"><a href="#Corr.fit-722"><span class="linenos">722</span></a><span class="sd">            Two element list containing the timeslices on which the fit is supposed to start and stop.</span>
</span><span id="Corr.fit-723"><a href="#Corr.fit-723"><span class="linenos">723</span></a><span class="sd">            Caution: This range is inclusive as opposed to standard python indexing.</span>
</span><span id="Corr.fit-724"><a href="#Corr.fit-724"><span class="linenos">724</span></a><span class="sd">            `fitrange=[4, 6]` corresponds to the three entries 4, 5 and 6.</span>
</span><span id="Corr.fit-725"><a href="#Corr.fit-725"><span class="linenos">725</span></a><span class="sd">            If not specified, self.prange or all timeslices are used.</span>
</span><span id="Corr.fit-726"><a href="#Corr.fit-726"><span class="linenos">726</span></a><span class="sd">        silent : bool</span>
</span><span id="Corr.fit-727"><a href="#Corr.fit-727"><span class="linenos">727</span></a><span class="sd">            Decides whether output is printed to the standard output.</span>
</span><span id="Corr.fit-728"><a href="#Corr.fit-728"><span class="linenos">728</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Corr.fit-729"><a href="#Corr.fit-729"><span class="linenos">729</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.fit-730"><a href="#Corr.fit-730"><span class="linenos">730</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator must be projected before fitting&quot;</span><span class="p">)</span>
</span><span id="Corr.fit-731"><a href="#Corr.fit-731"><span class="linenos">731</span></a>
</span><span id="Corr.fit-732"><a href="#Corr.fit-732"><span class="linenos">732</span></a>        <span class="k">if</span> <span class="n">fitrange</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.fit-733"><a href="#Corr.fit-733"><span class="linenos">733</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">:</span>
</span><span id="Corr.fit-734"><a href="#Corr.fit-734"><span class="linenos">734</span></a>                <span class="n">fitrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span>
</span><span id="Corr.fit-735"><a href="#Corr.fit-735"><span class="linenos">735</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.fit-736"><a href="#Corr.fit-736"><span class="linenos">736</span></a>                <span class="n">fitrange</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Corr.fit-737"><a href="#Corr.fit-737"><span class="linenos">737</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.fit-738"><a href="#Corr.fit-738"><span class="linenos">738</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fitrange</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr.fit-739"><a href="#Corr.fit-739"><span class="linenos">739</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;fitrange has to be a list with two elements&quot;</span><span class="p">)</span>
</span><span id="Corr.fit-740"><a href="#Corr.fit-740"><span class="linenos">740</span></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fitrange</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Corr.fit-741"><a href="#Corr.fit-741"><span class="linenos">741</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;fitrange has to have exactly two elements [fit_start, fit_stop]&quot;</span><span class="p">)</span>
</span><span id="Corr.fit-742"><a href="#Corr.fit-742"><span class="linenos">742</span></a>
</span><span id="Corr.fit-743"><a href="#Corr.fit-743"><span class="linenos">743</span></a>        <span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fitrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fitrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr.fit-744"><a href="#Corr.fit-744"><span class="linenos">744</span></a>        <span class="n">ys</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fitrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fitrange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr.fit-745"><a href="#Corr.fit-745"><span class="linenos">745</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="n">silent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Corr.fit-746"><a href="#Corr.fit-746"><span class="linenos">746</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Fits function to the data</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>function</strong> (obj):
function to fit to the data. See fits.least_squares for details.</li>
<li><strong>fitrange</strong> (list):
Two element list containing the timeslices on which the fit is supposed to start and stop.
Caution: This range is inclusive as opposed to standard python indexing.
<code>fitrange=[4, 6]</code> corresponds to the three entries 4, 5 and 6.
If not specified, self.prange or all timeslices are used.</li>
<li><strong>silent</strong> (bool):
Decides whether output is printed to the standard output.</li>
</ul>
</div>


                            </div>
                            <div id="Corr.plateau" class="classattr">
                                        <input id="Corr.plateau-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">plateau</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">plateau_range</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">method</span><span class="o">=</span><span class="s1">&#39;fit&#39;</span>, </span><span class="param"><span class="n">auto_gamma</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.plateau-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.plateau"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.plateau-748"><a href="#Corr.plateau-748"><span class="linenos">748</span></a>    <span class="k">def</span> <span class="nf">plateau</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plateau_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;fit&quot;</span><span class="p">,</span> <span class="n">auto_gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="Corr.plateau-749"><a href="#Corr.plateau-749"><span class="linenos">749</span></a>        <span class="sd">&quot;&quot;&quot; Extract a plateau value from a Corr object</span>
</span><span id="Corr.plateau-750"><a href="#Corr.plateau-750"><span class="linenos">750</span></a>
</span><span id="Corr.plateau-751"><a href="#Corr.plateau-751"><span class="linenos">751</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.plateau-752"><a href="#Corr.plateau-752"><span class="linenos">752</span></a><span class="sd">        ----------</span>
</span><span id="Corr.plateau-753"><a href="#Corr.plateau-753"><span class="linenos">753</span></a><span class="sd">        plateau_range : list</span>
</span><span id="Corr.plateau-754"><a href="#Corr.plateau-754"><span class="linenos">754</span></a><span class="sd">            list with two entries, indicating the first and the last timeslice</span>
</span><span id="Corr.plateau-755"><a href="#Corr.plateau-755"><span class="linenos">755</span></a><span class="sd">            of the plateau region.</span>
</span><span id="Corr.plateau-756"><a href="#Corr.plateau-756"><span class="linenos">756</span></a><span class="sd">        method : str</span>
</span><span id="Corr.plateau-757"><a href="#Corr.plateau-757"><span class="linenos">757</span></a><span class="sd">            method to extract the plateau.</span>
</span><span id="Corr.plateau-758"><a href="#Corr.plateau-758"><span class="linenos">758</span></a><span class="sd">                &#39;fit&#39; fits a constant to the plateau region</span>
</span><span id="Corr.plateau-759"><a href="#Corr.plateau-759"><span class="linenos">759</span></a><span class="sd">                &#39;avg&#39;, &#39;average&#39; or &#39;mean&#39; just average over the given timeslices.</span>
</span><span id="Corr.plateau-760"><a href="#Corr.plateau-760"><span class="linenos">760</span></a><span class="sd">        auto_gamma : bool</span>
</span><span id="Corr.plateau-761"><a href="#Corr.plateau-761"><span class="linenos">761</span></a><span class="sd">            apply gamma_method with default parameters to the Corr. Defaults to None</span>
</span><span id="Corr.plateau-762"><a href="#Corr.plateau-762"><span class="linenos">762</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.plateau-763"><a href="#Corr.plateau-763"><span class="linenos">763</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">plateau_range</span><span class="p">:</span>
</span><span id="Corr.plateau-764"><a href="#Corr.plateau-764"><span class="linenos">764</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">:</span>
</span><span id="Corr.plateau-765"><a href="#Corr.plateau-765"><span class="linenos">765</span></a>                <span class="n">plateau_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span>
</span><span id="Corr.plateau-766"><a href="#Corr.plateau-766"><span class="linenos">766</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.plateau-767"><a href="#Corr.plateau-767"><span class="linenos">767</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;no plateau range provided&quot;</span><span class="p">)</span>
</span><span id="Corr.plateau-768"><a href="#Corr.plateau-768"><span class="linenos">768</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.plateau-769"><a href="#Corr.plateau-769"><span class="linenos">769</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator must be projected before getting a plateau.&quot;</span><span class="p">)</span>
</span><span id="Corr.plateau-770"><a href="#Corr.plateau-770"><span class="linenos">770</span></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">plateau_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">plateau_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])):</span>
</span><span id="Corr.plateau-771"><a href="#Corr.plateau-771"><span class="linenos">771</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;plateau is undefined at all timeslices in plateaurange.&quot;</span><span class="p">)</span>
</span><span id="Corr.plateau-772"><a href="#Corr.plateau-772"><span class="linenos">772</span></a>        <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="Corr.plateau-773"><a href="#Corr.plateau-773"><span class="linenos">773</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr.plateau-774"><a href="#Corr.plateau-774"><span class="linenos">774</span></a>        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;fit&quot;</span><span class="p">:</span>
</span><span id="Corr.plateau-775"><a href="#Corr.plateau-775"><span class="linenos">775</span></a>            <span class="k">def</span> <span class="nf">const_func</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
</span><span id="Corr.plateau-776"><a href="#Corr.plateau-776"><span class="linenos">776</span></a>                <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr.plateau-777"><a href="#Corr.plateau-777"><span class="linenos">777</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">const_func</span><span class="p">,</span> <span class="n">plateau_range</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="Corr.plateau-778"><a href="#Corr.plateau-778"><span class="linenos">778</span></a>        <span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">]:</span>
</span><span id="Corr.plateau-779"><a href="#Corr.plateau-779"><span class="linenos">779</span></a>            <span class="n">returnvalue</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">plateau_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">plateau_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="Corr.plateau-780"><a href="#Corr.plateau-780"><span class="linenos">780</span></a>            <span class="k">return</span> <span class="n">returnvalue</span>
</span><span id="Corr.plateau-781"><a href="#Corr.plateau-781"><span class="linenos">781</span></a>
</span><span id="Corr.plateau-782"><a href="#Corr.plateau-782"><span class="linenos">782</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.plateau-783"><a href="#Corr.plateau-783"><span class="linenos">783</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unsupported plateau method: &quot;</span> <span class="o">+</span> <span class="n">method</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Extract a plateau value from a Corr object</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>plateau_range</strong> (list):
list with two entries, indicating the first and the last timeslice
of the plateau region.</li>
<li><strong>method</strong> (str):
method to extract the plateau.
    'fit' fits a constant to the plateau region
    'avg', 'average' or 'mean' just average over the given timeslices.</li>
<li><strong>auto_gamma</strong> (bool):
apply gamma_method with default parameters to the Corr. Defaults to None</li>
</ul>
</div>


                            </div>
                            <div id="Corr.set_prange" class="classattr">
                                        <input id="Corr.set_prange-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_prange</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">prange</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.set_prange-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.set_prange"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.set_prange-785"><a href="#Corr.set_prange-785"><span class="linenos">785</span></a>    <span class="k">def</span> <span class="nf">set_prange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prange</span><span class="p">):</span>
</span><span id="Corr.set_prange-786"><a href="#Corr.set_prange-786"><span class="linenos">786</span></a>        <span class="sd">&quot;&quot;&quot;Sets the attribute prange of the Corr object.&quot;&quot;&quot;</span>
</span><span id="Corr.set_prange-787"><a href="#Corr.set_prange-787"><span class="linenos">787</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">prange</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Corr.set_prange-788"><a href="#Corr.set_prange-788"><span class="linenos">788</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;prange must be a list or array with two values&quot;</span><span class="p">)</span>
</span><span id="Corr.set_prange-789"><a href="#Corr.set_prange-789"><span class="linenos">789</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">))):</span>
</span><span id="Corr.set_prange-790"><a href="#Corr.set_prange-790"><span class="linenos">790</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Start and end point must be integers&quot;</span><span class="p">)</span>
</span><span id="Corr.set_prange-791"><a href="#Corr.set_prange-791"><span class="linenos">791</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="ow">and</span> <span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="Corr.set_prange-792"><a href="#Corr.set_prange-792"><span class="linenos">792</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Start and end point must define a range in the interval 0,T&quot;</span><span class="p">)</span>
</span><span id="Corr.set_prange-793"><a href="#Corr.set_prange-793"><span class="linenos">793</span></a>
</span><span id="Corr.set_prange-794"><a href="#Corr.set_prange-794"><span class="linenos">794</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">prange</span> <span class="o">=</span> <span class="n">prange</span>
</span><span id="Corr.set_prange-795"><a href="#Corr.set_prange-795"><span class="linenos">795</span></a>        <span class="k">return</span>
</span></pre></div>


            <div class="docstring"><p>Sets the attribute prange of the Corr object.</p>
</div>


                            </div>
                            <div id="Corr.show" class="classattr">
                                        <input id="Corr.show-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">show</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">x_range</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">comp</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">y_range</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">logscale</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">plateau</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">fit_res</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">save</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">auto_gamma</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">hide_sigma</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">references</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">title</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.show-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.show"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.show-797"><a href="#Corr.show-797"><span class="linenos">797</span></a>    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comp</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plateau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fit_res</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">auto_gamma</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hide_sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">references</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.show-798"><a href="#Corr.show-798"><span class="linenos">798</span></a>        <span class="sd">&quot;&quot;&quot;Plots the correlator using the tag of the correlator as label if available.</span>
</span><span id="Corr.show-799"><a href="#Corr.show-799"><span class="linenos">799</span></a>
</span><span id="Corr.show-800"><a href="#Corr.show-800"><span class="linenos">800</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.show-801"><a href="#Corr.show-801"><span class="linenos">801</span></a><span class="sd">        ----------</span>
</span><span id="Corr.show-802"><a href="#Corr.show-802"><span class="linenos">802</span></a><span class="sd">        x_range : list</span>
</span><span id="Corr.show-803"><a href="#Corr.show-803"><span class="linenos">803</span></a><span class="sd">            list of two values, determining the range of the x-axis e.g. [4, 8].</span>
</span><span id="Corr.show-804"><a href="#Corr.show-804"><span class="linenos">804</span></a><span class="sd">        comp : Corr or list of Corr</span>
</span><span id="Corr.show-805"><a href="#Corr.show-805"><span class="linenos">805</span></a><span class="sd">            Correlator or list of correlators which are plotted for comparison.</span>
</span><span id="Corr.show-806"><a href="#Corr.show-806"><span class="linenos">806</span></a><span class="sd">            The tags of these correlators are used as labels if available.</span>
</span><span id="Corr.show-807"><a href="#Corr.show-807"><span class="linenos">807</span></a><span class="sd">        logscale : bool</span>
</span><span id="Corr.show-808"><a href="#Corr.show-808"><span class="linenos">808</span></a><span class="sd">            Sets y-axis to logscale.</span>
</span><span id="Corr.show-809"><a href="#Corr.show-809"><span class="linenos">809</span></a><span class="sd">        plateau : Obs</span>
</span><span id="Corr.show-810"><a href="#Corr.show-810"><span class="linenos">810</span></a><span class="sd">            Plateau value to be visualized in the figure.</span>
</span><span id="Corr.show-811"><a href="#Corr.show-811"><span class="linenos">811</span></a><span class="sd">        fit_res : Fit_result</span>
</span><span id="Corr.show-812"><a href="#Corr.show-812"><span class="linenos">812</span></a><span class="sd">            Fit_result object to be visualized.</span>
</span><span id="Corr.show-813"><a href="#Corr.show-813"><span class="linenos">813</span></a><span class="sd">        ylabel : str</span>
</span><span id="Corr.show-814"><a href="#Corr.show-814"><span class="linenos">814</span></a><span class="sd">            Label for the y-axis.</span>
</span><span id="Corr.show-815"><a href="#Corr.show-815"><span class="linenos">815</span></a><span class="sd">        save : str</span>
</span><span id="Corr.show-816"><a href="#Corr.show-816"><span class="linenos">816</span></a><span class="sd">            path to file in which the figure should be saved.</span>
</span><span id="Corr.show-817"><a href="#Corr.show-817"><span class="linenos">817</span></a><span class="sd">        auto_gamma : bool</span>
</span><span id="Corr.show-818"><a href="#Corr.show-818"><span class="linenos">818</span></a><span class="sd">            Apply the gamma method with standard parameters to all correlators and plateau values before plotting.</span>
</span><span id="Corr.show-819"><a href="#Corr.show-819"><span class="linenos">819</span></a><span class="sd">        hide_sigma : float</span>
</span><span id="Corr.show-820"><a href="#Corr.show-820"><span class="linenos">820</span></a><span class="sd">            Hides data points from the first value on which is consistent with zero within &#39;hide_sigma&#39; standard errors.</span>
</span><span id="Corr.show-821"><a href="#Corr.show-821"><span class="linenos">821</span></a><span class="sd">        references : list</span>
</span><span id="Corr.show-822"><a href="#Corr.show-822"><span class="linenos">822</span></a><span class="sd">            List of floating point values that are displayed as horizontal lines for reference.</span>
</span><span id="Corr.show-823"><a href="#Corr.show-823"><span class="linenos">823</span></a><span class="sd">        title : string</span>
</span><span id="Corr.show-824"><a href="#Corr.show-824"><span class="linenos">824</span></a><span class="sd">            Optional title of the figure.</span>
</span><span id="Corr.show-825"><a href="#Corr.show-825"><span class="linenos">825</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.show-826"><a href="#Corr.show-826"><span class="linenos">826</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.show-827"><a href="#Corr.show-827"><span class="linenos">827</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator must be projected before plotting&quot;</span><span class="p">)</span>
</span><span id="Corr.show-828"><a href="#Corr.show-828"><span class="linenos">828</span></a>
</span><span id="Corr.show-829"><a href="#Corr.show-829"><span class="linenos">829</span></a>        <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="Corr.show-830"><a href="#Corr.show-830"><span class="linenos">830</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr.show-831"><a href="#Corr.show-831"><span class="linenos">831</span></a>
</span><span id="Corr.show-832"><a href="#Corr.show-832"><span class="linenos">832</span></a>        <span class="k">if</span> <span class="n">x_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.show-833"><a href="#Corr.show-833"><span class="linenos">833</span></a>            <span class="n">x_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="Corr.show-834"><a href="#Corr.show-834"><span class="linenos">834</span></a>
</span><span id="Corr.show-835"><a href="#Corr.show-835"><span class="linenos">835</span></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Corr.show-836"><a href="#Corr.show-836"><span class="linenos">836</span></a>        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="Corr.show-837"><a href="#Corr.show-837"><span class="linenos">837</span></a>
</span><span id="Corr.show-838"><a href="#Corr.show-838"><span class="linenos">838</span></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plottable</span><span class="p">()</span>
</span><span id="Corr.show-839"><a href="#Corr.show-839"><span class="linenos">839</span></a>        <span class="k">if</span> <span class="n">hide_sigma</span><span class="p">:</span>
</span><span id="Corr.show-840"><a href="#Corr.show-840"><span class="linenos">840</span></a>            <span class="n">hide_from</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">((</span><span class="n">hide_sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_err</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Corr.show-841"><a href="#Corr.show-841"><span class="linenos">841</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.show-842"><a href="#Corr.show-842"><span class="linenos">842</span></a>            <span class="n">hide_from</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr.show-843"><a href="#Corr.show-843"><span class="linenos">843</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
</span><span id="Corr.show-844"><a href="#Corr.show-844"><span class="linenos">844</span></a>        <span class="k">if</span> <span class="n">logscale</span><span class="p">:</span>
</span><span id="Corr.show-845"><a href="#Corr.show-845"><span class="linenos">845</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span><span id="Corr.show-846"><a href="#Corr.show-846"><span class="linenos">846</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.show-847"><a href="#Corr.show-847"><span class="linenos">847</span></a>            <span class="k">if</span> <span class="n">y_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.show-848"><a href="#Corr.show-848"><span class="linenos">848</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="Corr.show-849"><a href="#Corr.show-849"><span class="linenos">849</span></a>                    <span class="n">y_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span>
</span><span id="Corr.show-850"><a href="#Corr.show-850"><span class="linenos">850</span></a>                    <span class="n">y_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="p">(</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">dvalue</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)])</span>
</span><span id="Corr.show-851"><a href="#Corr.show-851"><span class="linenos">851</span></a>                    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">y_min</span> <span class="o">-</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">),</span> <span class="n">y_max</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span><span class="p">)])</span>
</span><span id="Corr.show-852"><a href="#Corr.show-852"><span class="linenos">852</span></a>                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="Corr.show-853"><a href="#Corr.show-853"><span class="linenos">853</span></a>                    <span class="k">pass</span>
</span><span id="Corr.show-854"><a href="#Corr.show-854"><span class="linenos">854</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.show-855"><a href="#Corr.show-855"><span class="linenos">855</span></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_range</span><span class="p">)</span>
</span><span id="Corr.show-856"><a href="#Corr.show-856"><span class="linenos">856</span></a>        <span class="k">if</span> <span class="n">comp</span><span class="p">:</span>
</span><span id="Corr.show-857"><a href="#Corr.show-857"><span class="linenos">857</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="p">(</span><span class="n">Corr</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="Corr.show-858"><a href="#Corr.show-858"><span class="linenos">858</span></a>                <span class="k">for</span> <span class="n">corr</span> <span class="ow">in</span> <span class="n">comp</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">comp</span><span class="p">]:</span>
</span><span id="Corr.show-859"><a href="#Corr.show-859"><span class="linenos">859</span></a>                    <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="Corr.show-860"><a href="#Corr.show-860"><span class="linenos">860</span></a>                        <span class="n">corr</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr.show-861"><a href="#Corr.show-861"><span class="linenos">861</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">y_err</span> <span class="o">=</span> <span class="n">corr</span><span class="o">.</span><span class="n">plottable</span><span class="p">()</span>
</span><span id="Corr.show-862"><a href="#Corr.show-862"><span class="linenos">862</span></a>                    <span class="k">if</span> <span class="n">hide_sigma</span><span class="p">:</span>
</span><span id="Corr.show-863"><a href="#Corr.show-863"><span class="linenos">863</span></a>                        <span class="n">hide_from</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">((</span><span class="n">hide_sigma</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_err</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Corr.show-864"><a href="#Corr.show-864"><span class="linenos">864</span></a>                    <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.show-865"><a href="#Corr.show-865"><span class="linenos">865</span></a>                        <span class="n">hide_from</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Corr.show-866"><a href="#Corr.show-866"><span class="linenos">866</span></a>                    <span class="n">ax1</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">y_err</span><span class="p">[:</span><span class="n">hide_from</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">corr</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">])</span>
</span><span id="Corr.show-867"><a href="#Corr.show-867"><span class="linenos">867</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.show-868"><a href="#Corr.show-868"><span class="linenos">868</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;comp&#39; must be a correlator or a list of correlators.&quot;</span><span class="p">)</span>
</span><span id="Corr.show-869"><a href="#Corr.show-869"><span class="linenos">869</span></a>
</span><span id="Corr.show-870"><a href="#Corr.show-870"><span class="linenos">870</span></a>        <span class="k">if</span> <span class="n">plateau</span><span class="p">:</span>
</span><span id="Corr.show-871"><a href="#Corr.show-871"><span class="linenos">871</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plateau</span><span class="p">,</span> <span class="n">Obs</span><span class="p">):</span>
</span><span id="Corr.show-872"><a href="#Corr.show-872"><span class="linenos">872</span></a>                <span class="k">if</span> <span class="n">auto_gamma</span><span class="p">:</span>
</span><span id="Corr.show-873"><a href="#Corr.show-873"><span class="linenos">873</span></a>                    <span class="n">plateau</span><span class="o">.</span><span class="n">gamma_method</span><span class="p">()</span>
</span><span id="Corr.show-874"><a href="#Corr.show-874"><span class="linenos">874</span></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">plateau</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">plateau</span><span class="p">))</span>
</span><span id="Corr.show-875"><a href="#Corr.show-875"><span class="linenos">875</span></a>                <span class="n">ax1</span><span class="o">.</span><span class="n">axhspan</span><span class="p">(</span><span class="n">plateau</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="n">plateau</span><span class="o">.</span><span class="n">dvalue</span><span class="p">,</span> <span class="n">plateau</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">plateau</span><span class="o">.</span><span class="n">dvalue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
</span><span id="Corr.show-876"><a href="#Corr.show-876"><span class="linenos">876</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.show-877"><a href="#Corr.show-877"><span class="linenos">877</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;plateau&#39; must be an Obs&quot;</span><span class="p">)</span>
</span><span id="Corr.show-878"><a href="#Corr.show-878"><span class="linenos">878</span></a>
</span><span id="Corr.show-879"><a href="#Corr.show-879"><span class="linenos">879</span></a>        <span class="k">if</span> <span class="n">references</span><span class="p">:</span>
</span><span id="Corr.show-880"><a href="#Corr.show-880"><span class="linenos">880</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">references</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="Corr.show-881"><a href="#Corr.show-881"><span class="linenos">881</span></a>                <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">references</span><span class="p">:</span>
</span><span id="Corr.show-882"><a href="#Corr.show-882"><span class="linenos">882</span></a>                    <span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">ref</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;text.color&#39;</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
</span><span id="Corr.show-883"><a href="#Corr.show-883"><span class="linenos">883</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.show-884"><a href="#Corr.show-884"><span class="linenos">884</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;references&#39; must be a list of floating pint values.&quot;</span><span class="p">)</span>
</span><span id="Corr.show-885"><a href="#Corr.show-885"><span class="linenos">885</span></a>
</span><span id="Corr.show-886"><a href="#Corr.show-886"><span class="linenos">886</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">:</span>
</span><span id="Corr.show-887"><a href="#Corr.show-887"><span class="linenos">887</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="Corr.show-888"><a href="#Corr.show-888"><span class="linenos">888</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span id="Corr.show-889"><a href="#Corr.show-889"><span class="linenos">889</span></a>
</span><span id="Corr.show-890"><a href="#Corr.show-890"><span class="linenos">890</span></a>        <span class="k">if</span> <span class="n">fit_res</span><span class="p">:</span>
</span><span id="Corr.show-891"><a href="#Corr.show-891"><span class="linenos">891</span></a>            <span class="n">x_samples</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
</span><span id="Corr.show-892"><a href="#Corr.show-892"><span class="linenos">892</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_samples</span><span class="p">,</span>
</span><span id="Corr.show-893"><a href="#Corr.show-893"><span class="linenos">893</span></a>                     <span class="n">fit_res</span><span class="o">.</span><span class="n">fit_function</span><span class="p">([</span><span class="n">o</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">fit_res</span><span class="o">.</span><span class="n">fit_parameters</span><span class="p">],</span> <span class="n">x_samples</span><span class="p">),</span>
</span><span id="Corr.show-894"><a href="#Corr.show-894"><span class="linenos">894</span></a>                     <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span><span id="Corr.show-895"><a href="#Corr.show-895"><span class="linenos">895</span></a>
</span><span id="Corr.show-896"><a href="#Corr.show-896"><span class="linenos">896</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x_0 / a$&#39;</span><span class="p">)</span>
</span><span id="Corr.show-897"><a href="#Corr.show-897"><span class="linenos">897</span></a>        <span class="k">if</span> <span class="n">ylabel</span><span class="p">:</span>
</span><span id="Corr.show-898"><a href="#Corr.show-898"><span class="linenos">898</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
</span><span id="Corr.show-899"><a href="#Corr.show-899"><span class="linenos">899</span></a>        <span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">x_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">x_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">])</span>
</span><span id="Corr.show-900"><a href="#Corr.show-900"><span class="linenos">900</span></a>
</span><span id="Corr.show-901"><a href="#Corr.show-901"><span class="linenos">901</span></a>        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
</span><span id="Corr.show-902"><a href="#Corr.show-902"><span class="linenos">902</span></a>        <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
</span><span id="Corr.show-903"><a href="#Corr.show-903"><span class="linenos">903</span></a>            <span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</span><span id="Corr.show-904"><a href="#Corr.show-904"><span class="linenos">904</span></a>
</span><span id="Corr.show-905"><a href="#Corr.show-905"><span class="linenos">905</span></a>        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
</span><span id="Corr.show-906"><a href="#Corr.show-906"><span class="linenos">906</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span id="Corr.show-907"><a href="#Corr.show-907"><span class="linenos">907</span></a>
</span><span id="Corr.show-908"><a href="#Corr.show-908"><span class="linenos">908</span></a>        <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span><span id="Corr.show-909"><a href="#Corr.show-909"><span class="linenos">909</span></a>
</span><span id="Corr.show-910"><a href="#Corr.show-910"><span class="linenos">910</span></a>        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
</span><span id="Corr.show-911"><a href="#Corr.show-911"><span class="linenos">911</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Corr.show-912"><a href="#Corr.show-912"><span class="linenos">912</span></a>                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</span><span id="Corr.show-913"><a href="#Corr.show-913"><span class="linenos">913</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.show-914"><a href="#Corr.show-914"><span class="linenos">914</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;&#39;save&#39; has to be a string.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Plots the correlator using the tag of the correlator as label if available.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x_range</strong> (list):
list of two values, determining the range of the x-axis e.g. [4, 8].</li>
<li><strong>comp</strong> (Corr or list of Corr):
Correlator or list of correlators which are plotted for comparison.
The tags of these correlators are used as labels if available.</li>
<li><strong>logscale</strong> (bool):
Sets y-axis to logscale.</li>
<li><strong>plateau</strong> (Obs):
Plateau value to be visualized in the figure.</li>
<li><strong>fit_res</strong> (Fit_result):
Fit_result object to be visualized.</li>
<li><strong>ylabel</strong> (str):
Label for the y-axis.</li>
<li><strong>save</strong> (str):
path to file in which the figure should be saved.</li>
<li><strong>auto_gamma</strong> (bool):
Apply the gamma method with standard parameters to all correlators and plateau values before plotting.</li>
<li><strong>hide_sigma</strong> (float):
Hides data points from the first value on which is consistent with zero within 'hide_sigma' standard errors.</li>
<li><strong>references</strong> (list):
List of floating point values that are displayed as horizontal lines for reference.</li>
<li><strong>title</strong> (string):
Optional title of the figure.</li>
</ul>
</div>


                            </div>
                            <div id="Corr.spaghetti_plot" class="classattr">
                                        <input id="Corr.spaghetti_plot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">spaghetti_plot</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">logscale</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.spaghetti_plot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.spaghetti_plot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.spaghetti_plot-916"><a href="#Corr.spaghetti_plot-916"><span class="linenos">916</span></a>    <span class="k">def</span> <span class="nf">spaghetti_plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logscale</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Corr.spaghetti_plot-917"><a href="#Corr.spaghetti_plot-917"><span class="linenos">917</span></a>        <span class="sd">&quot;&quot;&quot;Produces a spaghetti plot of the correlator suited to monitor exceptional configurations.</span>
</span><span id="Corr.spaghetti_plot-918"><a href="#Corr.spaghetti_plot-918"><span class="linenos">918</span></a>
</span><span id="Corr.spaghetti_plot-919"><a href="#Corr.spaghetti_plot-919"><span class="linenos">919</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.spaghetti_plot-920"><a href="#Corr.spaghetti_plot-920"><span class="linenos">920</span></a><span class="sd">        ----------</span>
</span><span id="Corr.spaghetti_plot-921"><a href="#Corr.spaghetti_plot-921"><span class="linenos">921</span></a><span class="sd">        logscale : bool</span>
</span><span id="Corr.spaghetti_plot-922"><a href="#Corr.spaghetti_plot-922"><span class="linenos">922</span></a><span class="sd">            Determines whether the scale of the y-axis is logarithmic or standard.</span>
</span><span id="Corr.spaghetti_plot-923"><a href="#Corr.spaghetti_plot-923"><span class="linenos">923</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.spaghetti_plot-924"><a href="#Corr.spaghetti_plot-924"><span class="linenos">924</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.spaghetti_plot-925"><a href="#Corr.spaghetti_plot-925"><span class="linenos">925</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Correlator needs to be projected first.&quot;</span><span class="p">)</span>
</span><span id="Corr.spaghetti_plot-926"><a href="#Corr.spaghetti_plot-926"><span class="linenos">926</span></a>
</span><span id="Corr.spaghetti_plot-927"><a href="#Corr.spaghetti_plot-927"><span class="linenos">927</span></a>        <span class="n">mc_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="p">[</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mc_names</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]))</span>
</span><span id="Corr.spaghetti_plot-928"><a href="#Corr.spaghetti_plot-928"><span class="linenos">928</span></a>        <span class="n">x0_vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="Corr.spaghetti_plot-929"><a href="#Corr.spaghetti_plot-929"><span class="linenos">929</span></a>
</span><span id="Corr.spaghetti_plot-930"><a href="#Corr.spaghetti_plot-930"><span class="linenos">930</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">mc_names</span><span class="p">:</span>
</span><span id="Corr.spaghetti_plot-931"><a href="#Corr.spaghetti_plot-931"><span class="linenos">931</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">deltas</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">+</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">r_values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="k">if</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
</span><span id="Corr.spaghetti_plot-932"><a href="#Corr.spaghetti_plot-932"><span class="linenos">932</span></a>
</span><span id="Corr.spaghetti_plot-933"><a href="#Corr.spaghetti_plot-933"><span class="linenos">933</span></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
</span><span id="Corr.spaghetti_plot-934"><a href="#Corr.spaghetti_plot-934"><span class="linenos">934</span></a>            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span id="Corr.spaghetti_plot-935"><a href="#Corr.spaghetti_plot-935"><span class="linenos">935</span></a>            <span class="k">for</span> <span class="n">dat</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span id="Corr.spaghetti_plot-936"><a href="#Corr.spaghetti_plot-936"><span class="linenos">936</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x0_vals</span><span class="p">,</span> <span class="n">dat</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="Corr.spaghetti_plot-937"><a href="#Corr.spaghetti_plot-937"><span class="linenos">937</span></a>
</span><span id="Corr.spaghetti_plot-938"><a href="#Corr.spaghetti_plot-938"><span class="linenos">938</span></a>            <span class="k">if</span> <span class="n">logscale</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="Corr.spaghetti_plot-939"><a href="#Corr.spaghetti_plot-939"><span class="linenos">939</span></a>                <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</span><span id="Corr.spaghetti_plot-940"><a href="#Corr.spaghetti_plot-940"><span class="linenos">940</span></a>
</span><span id="Corr.spaghetti_plot-941"><a href="#Corr.spaghetti_plot-941"><span class="linenos">941</span></a>            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$x_0 / a$&#39;</span><span class="p">)</span>
</span><span id="Corr.spaghetti_plot-942"><a href="#Corr.spaghetti_plot-942"><span class="linenos">942</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Corr.spaghetti_plot-943"><a href="#Corr.spaghetti_plot-943"><span class="linenos">943</span></a>            <span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Produces a spaghetti plot of the correlator suited to monitor exceptional configurations.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>logscale</strong> (bool):
Determines whether the scale of the y-axis is logarithmic or standard.</li>
</ul>
</div>


                            </div>
                            <div id="Corr.dump" class="classattr">
                                        <input id="Corr.dump-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dump</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">filename</span>, </span><span class="param"><span class="n">datatype</span><span class="o">=</span><span class="s1">&#39;json.gz&#39;</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.dump-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.dump"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.dump-945"><a href="#Corr.dump-945"><span class="linenos">945</span></a>    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;json.gz&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="Corr.dump-946"><a href="#Corr.dump-946"><span class="linenos">946</span></a>        <span class="sd">&quot;&quot;&quot;Dumps the Corr into a file of chosen type</span>
</span><span id="Corr.dump-947"><a href="#Corr.dump-947"><span class="linenos">947</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.dump-948"><a href="#Corr.dump-948"><span class="linenos">948</span></a><span class="sd">        ----------</span>
</span><span id="Corr.dump-949"><a href="#Corr.dump-949"><span class="linenos">949</span></a><span class="sd">        filename : str</span>
</span><span id="Corr.dump-950"><a href="#Corr.dump-950"><span class="linenos">950</span></a><span class="sd">            Name of the file to be saved.</span>
</span><span id="Corr.dump-951"><a href="#Corr.dump-951"><span class="linenos">951</span></a><span class="sd">        datatype : str</span>
</span><span id="Corr.dump-952"><a href="#Corr.dump-952"><span class="linenos">952</span></a><span class="sd">            Format of the exported file. Supported formats include</span>
</span><span id="Corr.dump-953"><a href="#Corr.dump-953"><span class="linenos">953</span></a><span class="sd">            &quot;json.gz&quot; and &quot;pickle&quot;</span>
</span><span id="Corr.dump-954"><a href="#Corr.dump-954"><span class="linenos">954</span></a><span class="sd">        path : str</span>
</span><span id="Corr.dump-955"><a href="#Corr.dump-955"><span class="linenos">955</span></a><span class="sd">            specifies a custom path for the file (default &#39;.&#39;)</span>
</span><span id="Corr.dump-956"><a href="#Corr.dump-956"><span class="linenos">956</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Corr.dump-957"><a href="#Corr.dump-957"><span class="linenos">957</span></a>        <span class="k">if</span> <span class="n">datatype</span> <span class="o">==</span> <span class="s2">&quot;json.gz&quot;</span><span class="p">:</span>
</span><span id="Corr.dump-958"><a href="#Corr.dump-958"><span class="linenos">958</span></a>            <span class="kn">from</span> <span class="nn">.input.json</span> <span class="kn">import</span> <span class="n">dump_to_json</span>
</span><span id="Corr.dump-959"><a href="#Corr.dump-959"><span class="linenos">959</span></a>            <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="Corr.dump-960"><a href="#Corr.dump-960"><span class="linenos">960</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
</span><span id="Corr.dump-961"><a href="#Corr.dump-961"><span class="linenos">961</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.dump-962"><a href="#Corr.dump-962"><span class="linenos">962</span></a>                <span class="n">file_name</span> <span class="o">=</span> <span class="n">filename</span>
</span><span id="Corr.dump-963"><a href="#Corr.dump-963"><span class="linenos">963</span></a>            <span class="n">dump_to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span><span id="Corr.dump-964"><a href="#Corr.dump-964"><span class="linenos">964</span></a>        <span class="k">elif</span> <span class="n">datatype</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
</span><span id="Corr.dump-965"><a href="#Corr.dump-965"><span class="linenos">965</span></a>            <span class="n">dump_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="Corr.dump-966"><a href="#Corr.dump-966"><span class="linenos">966</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Corr.dump-967"><a href="#Corr.dump-967"><span class="linenos">967</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Unknown datatype &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">datatype</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Dumps the Corr into a file of chosen type</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>filename</strong> (str):
Name of the file to be saved.</li>
<li><strong>datatype</strong> (str):
Format of the exported file. Supported formats include
"json.gz" and "pickle"</li>
<li><strong>path</strong> (str):
specifies a custom path for the file (default '.')</li>
</ul>
</div>


                            </div>
                            <div id="Corr.print" class="classattr">
                                        <input id="Corr.print-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">print_range</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.print-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.print"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.print-969"><a href="#Corr.print-969"><span class="linenos">969</span></a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">print_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.print-970"><a href="#Corr.print-970"><span class="linenos">970</span></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="n">print_range</span><span class="p">))</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.sqrt" class="classattr">
                                        <input id="Corr.sqrt-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sqrt</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.sqrt-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.sqrt"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.sqrt-1134"><a href="#Corr.sqrt-1134"><span class="linenos">1134</span></a>    <span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.sqrt-1135"><a href="#Corr.sqrt-1135"><span class="linenos">1135</span></a>        <span class="k">return</span> <span class="bp">self</span> <span class="o">**</span> <span class="mf">0.5</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.log" class="classattr">
                                        <input id="Corr.log-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">log</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.log-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.log"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.log-1137"><a href="#Corr.log-1137"><span class="linenos">1137</span></a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.log-1138"><a href="#Corr.log-1138"><span class="linenos">1138</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr.log-1139"><a href="#Corr.log-1139"><span class="linenos">1139</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.exp" class="classattr">
                                        <input id="Corr.exp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">exp</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.exp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.exp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.exp-1141"><a href="#Corr.exp-1141"><span class="linenos">1141</span></a>    <span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.exp-1142"><a href="#Corr.exp-1142"><span class="linenos">1142</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="n">_check_for_none</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">]</span>
</span><span id="Corr.exp-1143"><a href="#Corr.exp-1143"><span class="linenos">1143</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">,</span> <span class="n">prange</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prange</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.sin" class="classattr">
                                        <input id="Corr.sin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sin</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.sin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.sin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.sin-1156"><a href="#Corr.sin-1156"><span class="linenos">1156</span></a>    <span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.sin-1157"><a href="#Corr.sin-1157"><span class="linenos">1157</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.cos" class="classattr">
                                        <input id="Corr.cos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cos</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.cos-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.cos"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.cos-1159"><a href="#Corr.cos-1159"><span class="linenos">1159</span></a>    <span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.cos-1160"><a href="#Corr.cos-1160"><span class="linenos">1160</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.tan" class="classattr">
                                        <input id="Corr.tan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tan</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.tan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.tan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.tan-1162"><a href="#Corr.tan-1162"><span class="linenos">1162</span></a>    <span class="k">def</span> <span class="nf">tan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.tan-1163"><a href="#Corr.tan-1163"><span class="linenos">1163</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.sinh" class="classattr">
                                        <input id="Corr.sinh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sinh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.sinh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.sinh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.sinh-1165"><a href="#Corr.sinh-1165"><span class="linenos">1165</span></a>    <span class="k">def</span> <span class="nf">sinh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.sinh-1166"><a href="#Corr.sinh-1166"><span class="linenos">1166</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.cosh" class="classattr">
                                        <input id="Corr.cosh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cosh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.cosh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.cosh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.cosh-1168"><a href="#Corr.cosh-1168"><span class="linenos">1168</span></a>    <span class="k">def</span> <span class="nf">cosh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.cosh-1169"><a href="#Corr.cosh-1169"><span class="linenos">1169</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cosh</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.tanh" class="classattr">
                                        <input id="Corr.tanh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tanh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.tanh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.tanh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.tanh-1171"><a href="#Corr.tanh-1171"><span class="linenos">1171</span></a>    <span class="k">def</span> <span class="nf">tanh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.tanh-1172"><a href="#Corr.tanh-1172"><span class="linenos">1172</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.arcsin" class="classattr">
                                        <input id="Corr.arcsin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arcsin</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.arcsin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.arcsin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.arcsin-1174"><a href="#Corr.arcsin-1174"><span class="linenos">1174</span></a>    <span class="k">def</span> <span class="nf">arcsin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.arcsin-1175"><a href="#Corr.arcsin-1175"><span class="linenos">1175</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.arccos" class="classattr">
                                        <input id="Corr.arccos-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arccos</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.arccos-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.arccos"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.arccos-1177"><a href="#Corr.arccos-1177"><span class="linenos">1177</span></a>    <span class="k">def</span> <span class="nf">arccos</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.arccos-1178"><a href="#Corr.arccos-1178"><span class="linenos">1178</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.arctan" class="classattr">
                                        <input id="Corr.arctan-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arctan</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.arctan-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.arctan"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.arctan-1180"><a href="#Corr.arctan-1180"><span class="linenos">1180</span></a>    <span class="k">def</span> <span class="nf">arctan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.arctan-1181"><a href="#Corr.arctan-1181"><span class="linenos">1181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.arcsinh" class="classattr">
                                        <input id="Corr.arcsinh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arcsinh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.arcsinh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.arcsinh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.arcsinh-1183"><a href="#Corr.arcsinh-1183"><span class="linenos">1183</span></a>    <span class="k">def</span> <span class="nf">arcsinh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.arcsinh-1184"><a href="#Corr.arcsinh-1184"><span class="linenos">1184</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.arccosh" class="classattr">
                                        <input id="Corr.arccosh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arccosh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.arccosh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.arccosh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.arccosh-1186"><a href="#Corr.arccosh-1186"><span class="linenos">1186</span></a>    <span class="k">def</span> <span class="nf">arccosh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.arccosh-1187"><a href="#Corr.arccosh-1187"><span class="linenos">1187</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccosh</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.arctanh" class="classattr">
                                        <input id="Corr.arctanh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">arctanh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.arctanh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.arctanh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.arctanh-1189"><a href="#Corr.arctanh-1189"><span class="linenos">1189</span></a>    <span class="k">def</span> <span class="nf">arctanh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Corr.arctanh-1190"><a href="#Corr.arctanh-1190"><span class="linenos">1190</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_func_to_corr</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctanh</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="Corr.prune" class="classattr">
                                        <input id="Corr.prune-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prune</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">Ntrunc</span>, </span><span class="param"><span class="n">tproj</span><span class="o">=</span><span class="mi">3</span>, </span><span class="param"><span class="n">t0proj</span><span class="o">=</span><span class="mi">2</span>, </span><span class="param"><span class="n">basematrix</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Corr.prune-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Corr.prune"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Corr.prune-1225"><a href="#Corr.prune-1225"><span class="linenos">1225</span></a>    <span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ntrunc</span><span class="p">,</span> <span class="n">tproj</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">t0proj</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">basematrix</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="Corr.prune-1226"><a href="#Corr.prune-1226"><span class="linenos">1226</span></a>        <span class="sa">r</span><span class="sd">&#39;&#39;&#39; Project large correlation matrix to lowest states</span>
</span><span id="Corr.prune-1227"><a href="#Corr.prune-1227"><span class="linenos">1227</span></a>
</span><span id="Corr.prune-1228"><a href="#Corr.prune-1228"><span class="linenos">1228</span></a><span class="sd">        This method can be used to reduce the size of an (N x N) correlation matrix</span>
</span><span id="Corr.prune-1229"><a href="#Corr.prune-1229"><span class="linenos">1229</span></a><span class="sd">        to (Ntrunc x Ntrunc) by solving a GEVP at very early times where the noise</span>
</span><span id="Corr.prune-1230"><a href="#Corr.prune-1230"><span class="linenos">1230</span></a><span class="sd">        is still small.</span>
</span><span id="Corr.prune-1231"><a href="#Corr.prune-1231"><span class="linenos">1231</span></a>
</span><span id="Corr.prune-1232"><a href="#Corr.prune-1232"><span class="linenos">1232</span></a><span class="sd">        Parameters</span>
</span><span id="Corr.prune-1233"><a href="#Corr.prune-1233"><span class="linenos">1233</span></a><span class="sd">        ----------</span>
</span><span id="Corr.prune-1234"><a href="#Corr.prune-1234"><span class="linenos">1234</span></a><span class="sd">        Ntrunc: int</span>
</span><span id="Corr.prune-1235"><a href="#Corr.prune-1235"><span class="linenos">1235</span></a><span class="sd">            Rank of the target matrix.</span>
</span><span id="Corr.prune-1236"><a href="#Corr.prune-1236"><span class="linenos">1236</span></a><span class="sd">        tproj: int</span>
</span><span id="Corr.prune-1237"><a href="#Corr.prune-1237"><span class="linenos">1237</span></a><span class="sd">            Time where the eigenvectors are evaluated, corresponds to ts in the GEVP method.</span>
</span><span id="Corr.prune-1238"><a href="#Corr.prune-1238"><span class="linenos">1238</span></a><span class="sd">            The default value is 3.</span>
</span><span id="Corr.prune-1239"><a href="#Corr.prune-1239"><span class="linenos">1239</span></a><span class="sd">        t0proj: int</span>
</span><span id="Corr.prune-1240"><a href="#Corr.prune-1240"><span class="linenos">1240</span></a><span class="sd">            Time where the correlation matrix is inverted. Choosing t0proj=1 is strongly</span>
</span><span id="Corr.prune-1241"><a href="#Corr.prune-1241"><span class="linenos">1241</span></a><span class="sd">            discouraged for O(a) improved theories, since the correctness of the procedure</span>
</span><span id="Corr.prune-1242"><a href="#Corr.prune-1242"><span class="linenos">1242</span></a><span class="sd">            cannot be granted in this case. The default value is 2.</span>
</span><span id="Corr.prune-1243"><a href="#Corr.prune-1243"><span class="linenos">1243</span></a><span class="sd">        basematrix : Corr</span>
</span><span id="Corr.prune-1244"><a href="#Corr.prune-1244"><span class="linenos">1244</span></a><span class="sd">            Correlation matrix that is used to determine the eigenvectors of the</span>
</span><span id="Corr.prune-1245"><a href="#Corr.prune-1245"><span class="linenos">1245</span></a><span class="sd">            lowest states based on a GEVP. basematrix is taken to be the Corr itself if</span>
</span><span id="Corr.prune-1246"><a href="#Corr.prune-1246"><span class="linenos">1246</span></a><span class="sd">            is is not specified.</span>
</span><span id="Corr.prune-1247"><a href="#Corr.prune-1247"><span class="linenos">1247</span></a>
</span><span id="Corr.prune-1248"><a href="#Corr.prune-1248"><span class="linenos">1248</span></a><span class="sd">        Notes</span>
</span><span id="Corr.prune-1249"><a href="#Corr.prune-1249"><span class="linenos">1249</span></a><span class="sd">        -----</span>
</span><span id="Corr.prune-1250"><a href="#Corr.prune-1250"><span class="linenos">1250</span></a><span class="sd">        We have the basematrix $C(t)$ and the target matrix $G(t)$. We start by solving</span>
</span><span id="Corr.prune-1251"><a href="#Corr.prune-1251"><span class="linenos">1251</span></a><span class="sd">        the GEVP $$C(t) v_n(t, t_0) = \lambda_n(t, t_0) C(t_0) v_n(t, t_0)$$ where $t \equiv t_\mathrm{proj}$</span>
</span><span id="Corr.prune-1252"><a href="#Corr.prune-1252"><span class="linenos">1252</span></a><span class="sd">        and $t_0 \equiv t_{0, \mathrm{proj}}$. The target matrix is projected onto the subspace of the</span>
</span><span id="Corr.prune-1253"><a href="#Corr.prune-1253"><span class="linenos">1253</span></a><span class="sd">        resulting eigenvectors $v_n, n=1,\dots,N_\mathrm{trunc}$ via</span>
</span><span id="Corr.prune-1254"><a href="#Corr.prune-1254"><span class="linenos">1254</span></a><span class="sd">        $$G^\prime_{i, j}(t) = (v_i, G(t) v_j)$$. This allows to reduce the size of a large</span>
</span><span id="Corr.prune-1255"><a href="#Corr.prune-1255"><span class="linenos">1255</span></a><span class="sd">        correlation matrix and to remove some noise that is added by irrelevant operators.</span>
</span><span id="Corr.prune-1256"><a href="#Corr.prune-1256"><span class="linenos">1256</span></a><span class="sd">        This may allow to use the GEVP on $G(t)$ at late times such that the theoretically motivated</span>
</span><span id="Corr.prune-1257"><a href="#Corr.prune-1257"><span class="linenos">1257</span></a><span class="sd">        bound $t_0 \leq t/2$ holds, since the condition number of $G(t)$ is decreased, compared to $C(t)$.</span>
</span><span id="Corr.prune-1258"><a href="#Corr.prune-1258"><span class="linenos">1258</span></a><span class="sd">        &#39;&#39;&#39;</span>
</span><span id="Corr.prune-1259"><a href="#Corr.prune-1259"><span class="linenos">1259</span></a>
</span><span id="Corr.prune-1260"><a href="#Corr.prune-1260"><span class="linenos">1260</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Corr.prune-1261"><a href="#Corr.prune-1261"><span class="linenos">1261</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Method cannot be applied to one-dimensional correlators.&#39;</span><span class="p">)</span>
</span><span id="Corr.prune-1262"><a href="#Corr.prune-1262"><span class="linenos">1262</span></a>        <span class="k">if</span> <span class="n">basematrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Corr.prune-1263"><a href="#Corr.prune-1263"><span class="linenos">1263</span></a>            <span class="n">basematrix</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="Corr.prune-1264"><a href="#Corr.prune-1264"><span class="linenos">1264</span></a>        <span class="k">if</span> <span class="n">Ntrunc</span> <span class="o">&gt;=</span> <span class="n">basematrix</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
</span><span id="Corr.prune-1265"><a href="#Corr.prune-1265"><span class="linenos">1265</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Cannot truncate using Ntrunc &lt;= </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">basematrix</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
</span><span id="Corr.prune-1266"><a href="#Corr.prune-1266"><span class="linenos">1266</span></a>        <span class="k">if</span> <span class="n">basematrix</span><span class="o">.</span><span class="n">N</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">:</span>
</span><span id="Corr.prune-1267"><a href="#Corr.prune-1267"><span class="linenos">1267</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;basematrix and targetmatrix have to be of the same size.&#39;</span><span class="p">)</span>
</span><span id="Corr.prune-1268"><a href="#Corr.prune-1268"><span class="linenos">1268</span></a>
</span><span id="Corr.prune-1269"><a href="#Corr.prune-1269"><span class="linenos">1269</span></a>        <span class="n">evecs</span> <span class="o">=</span> <span class="n">basematrix</span><span class="o">.</span><span class="n">GEVP</span><span class="p">(</span><span class="n">t0proj</span><span class="p">,</span> <span class="n">tproj</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">None</span><span class="p">)[:</span><span class="n">Ntrunc</span><span class="p">]</span>
</span><span id="Corr.prune-1270"><a href="#Corr.prune-1270"><span class="linenos">1270</span></a>
</span><span id="Corr.prune-1271"><a href="#Corr.prune-1271"><span class="linenos">1271</span></a>        <span class="n">tmpmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">Ntrunc</span><span class="p">,</span> <span class="n">Ntrunc</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</span><span id="Corr.prune-1272"><a href="#Corr.prune-1272"><span class="linenos">1272</span></a>        <span class="n">rmat</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Corr.prune-1273"><a href="#Corr.prune-1273"><span class="linenos">1273</span></a>        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">basematrix</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
</span><span id="Corr.prune-1274"><a href="#Corr.prune-1274"><span class="linenos">1274</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ntrunc</span><span class="p">):</span>
</span><span id="Corr.prune-1275"><a href="#Corr.prune-1275"><span class="linenos">1275</span></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ntrunc</span><span class="p">):</span>
</span><span id="Corr.prune-1276"><a href="#Corr.prune-1276"><span class="linenos">1276</span></a>                    <span class="n">tmpmat</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">evecs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="bp">self</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">@</span> <span class="n">evecs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
</span><span id="Corr.prune-1277"><a href="#Corr.prune-1277"><span class="linenos">1277</span></a>            <span class="n">rmat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tmpmat</span><span class="p">))</span>
</span><span id="Corr.prune-1278"><a href="#Corr.prune-1278"><span class="linenos">1278</span></a>
</span><span id="Corr.prune-1279"><a href="#Corr.prune-1279"><span class="linenos">1279</span></a>        <span class="n">newcontent</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="n">rmat</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)]</span>
</span><span id="Corr.prune-1280"><a href="#Corr.prune-1280"><span class="linenos">1280</span></a>        <span class="k">return</span> <span class="n">Corr</span><span class="p">(</span><span class="n">newcontent</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Project large correlation matrix to lowest states</p>

<p>This method can be used to reduce the size of an (N x N) correlation matrix
to (Ntrunc x Ntrunc) by solving a GEVP at very early times where the noise
is still small.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>Ntrunc</strong> (int):
Rank of the target matrix.</li>
<li><strong>tproj</strong> (int):
Time where the eigenvectors are evaluated, corresponds to ts in the GEVP method.
The default value is 3.</li>
<li><strong>t0proj</strong> (int):
Time where the correlation matrix is inverted. Choosing t0proj=1 is strongly
discouraged for O(a) improved theories, since the correctness of the procedure
cannot be granted in this case. The default value is 2.</li>
<li><strong>basematrix</strong> (Corr):
Correlation matrix that is used to determine the eigenvectors of the
lowest states based on a GEVP. basematrix is taken to be the Corr itself if
is is not specified.</li>
</ul>

<h6 id="notes">Notes</h6>

<p>We have the basematrix $C(t)$ and the target matrix $G(t)$. We start by solving
the GEVP $$C(t) v_n(t, t_0) = \lambda_n(t, t_0) C(t_0) v_n(t, t_0)$$ where $t \equiv t_\mathrm{proj}$
and $t_0 \equiv t_{0, \mathrm{proj}}$. The target matrix is projected onto the subspace of the
resulting eigenvectors $v_n, n=1,\dots,N_\mathrm{trunc}$ via
$$G^\prime_{i, j}(t) = (v_i, G(t) v_j)$$. This allows to reduce the size of a large
correlation matrix and to remove some noise that is added by irrelevant operators.
This may allow to use the GEVP on $G(t)$ at late times such that the theoretically motivated
bound $t_0 \leq t/2$ holds, since the condition number of $G(t)$ is decreased, compared to $C(t)$.</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>